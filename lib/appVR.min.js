!function(){"use strict";if(!e)var e=(new Date).getTime();if(window.Browser=function(e){void 0===e&&(e=window.navigator.userAgent),e=e.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(silk)/.exec(e)||/(android)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||/(playbook)/.exec(e)||/(bb)/.exec(e)||/(blackberry)/.exec(e)||[],n={},i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",versionNumber:t[4]||t[2]||"0",platform:r[0]||""};if(i.browser&&(n[i.browser]=!0,n.version=i.version,n.versionNumber=parseInt(i.versionNumber,10)),i.platform&&(n[i.platform]=!0),(n.android||n.bb||n.blackberry||n.ipad||n.iphone||n.ipod||n.kindle||n.playbook||n.silk||n["windows phone"])&&(n.mobile=!0),(n.cros||n.mac||n.linux||n.win)&&(n.desktop=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),n.rv||n.iemobile){i.browser="msie",n.msie=!0}if(n.edge){delete n.edge;i.browser="msedge",n.msedge=!0}if(n.safari&&n.blackberry){i.browser="blackberry",n.blackberry=!0}if(n.safari&&n.playbook){i.browser="playbook",n.playbook=!0}if(n.bb){var a="blackberry";i.browser=a,n[a]=!0}if(n.opr){i.browser="opera",n.opera=!0}if(n.safari&&n.android){i.browser="android",n.android=!0}if(n.safari&&n.kindle){i.browser="kindle",n.kindle=!0}if(n.safari&&n.silk){i.browser="silk",n.silk=!0}n.name=i.browser,n.platform=i.platform;var o=/micromessenger/.test(e),s=/line/.test(e),l=/fban/.test(e)||/fbav/.test(e);return o?n.app="weChat":s?n.app="Line":l&&(n.app="FB"),n}(window.navigator.userAgent),!t)var t=(new Date).getTime();t&&e&&console.log("processing time(uaMatch):",t-e)}(),function(){"use strict";function e(e){let t=atob(e).split("").map((function(e){return e.charCodeAt(0)})),r=new Uint8Array(t),n=pako.inflate(r),i=String.fromCharCode.apply(null,new Uint16Array(n));return JSON.parse(i)}window.parseUserData=function(e,t){let r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="json",r.onload=function(e){for(var t in r.response.data?window.file=r.response.data:window.file=r.response,window.file.scene_objs_v2)for(var n in window.file.scene_objs_v2[t].transform){var i=window.file.scene_objs_v2[t].transform[n].split(",");if(3!=i.length)return-1;var a=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])];window.file.scene_objs_v2[t].transform[n]=a}return window.file},r.send(),r.response},window.getARProjsByUserID=function(t,r,n){if(!t)return-1;r||(r="makarvr");let i=new XMLHttpRequest,a={user_id:r,cid:"20"};if("3.0.0"==serverVersion&&(console.log("%cnetWorkAgent.js: getARProjsByUserID: you shoudnt see this, Fei abandon this function in server V3","color:red"),getResByUserID(t,r,"","",(function(){console.log("netWorkAgent.js: getARProjsByUserID: getResByUserID: callback");let e=t+"get_ar_projs",r={ver:"3.0.0",cid:5,data:a},o=JSON.stringify(r);i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){let t;console.log("networkAgent.js: getARProjsByUserID,  onload xhr.response = ",i.response),i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",i.response.error)):i.response.data?(t=i.response.data,window.userARData,window.userARData=t,n&&n(t)):n&&n("networkAgent.js:error: no xhr.response.data")},i.send(o)}))),"2.0.0"==serverVersion){let r=JSON.stringify(a),o=new FormData;o.append("cmd","get_ar_projs"),o.append("data",r),i.open("POST",t,!0),i.responseType="json",i.onload=function(t){let r;if(console.log("networkAgent.js:getARProjsByUserID:",i.response),i.response.diaoyurar){let t=e(i.response.diaoyurar);t.error?(n&&n(t.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",t.error)):t.data?(r=t.data,window.userARData?(console.log("networkAgent.js: getARProjsByUserID: window.userARData already exist, replace it.."),window.userARData=r):window.userARData=r,n&&n(r)):n&&n("networkAgent.js:error: no jsonData.data")}else i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getARProjsByUserID: oops something wrong:",i.response.error)):i.response.data?(r=i.response.data,window.userARData,window.userARData=r,n&&n(r)):n&&n("networkAgent.js:error: no xhr.response.data")},i.send(o)}},window.getUserPublishProjsByUserID=function(e,t,r,n,i){if(!e)return-1;t||(t="makarvr"),r||(r=""),n||(n="");let a=new XMLHttpRequest,o={user_id:t};"3.0.0"==serverVersion&&getResByUserID(e,t,r,n,(function(s){getUsrOnlineRes(e,t,r,n,"",(function(t){let r=e+"get_usr_publish_projs",n={ver:"3.0.0",cid:5,data:o},l=JSON.stringify(n);a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.responseType="json",a.onload=function(e){let r;a.response.error?(i&&i(a.response.error),console.log("%cnetworkAgent.js: _getUserPublishProjs: oops something wrong: ","color:red",a.response.error)):a.response.data?(r=a.response.data,window.userPublishProjs,window.userPublishProjs=r,i&&i(r,s,t)):i&&i("networkAgent.js:error: no xhr.response.data")},a.send(l)}))}))},window.getNewestPublishProjs=function(e,t,r){if(!e)return-1;t||(t="ar");let n=new XMLHttpRequest;if("3.0.0"==serverVersion){let r=e+"get_newest_publish_projs",i={ver:"3.0.0",cid:5,data:{proj_type:t}},a=JSON.stringify(i);n.open("POST",r,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.onload=function(e){console.log("networkAgent.js: getNewestPublishProjs,  onload xhr.response = ",n.response)},console.log("networkAgent.js: getNewestPublishProjs, jsonReq=",a),n.send(a)}},window.getResByUserID=function(e,r,n,i,a){r||(r="fefe"),n||(n=""),i||(i="");let o=e+"get_res",s=new XMLHttpRequest,l={ver:"3.0.0",cid:5,data:{user_id:r,main_type:n,sub_type:i}},c=JSON.stringify(l);s.open("POST",o,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(e){s.response.error?console.log("%cnetworkAgent: _getResByUserID,  onload error ","color:red",s.response):(console.log("%cnetworkAgent: _getResByUserID,  onload save ","color:blue",s.response.data.list),s.response.data.list.length>0?t(s.response.data.list,(function(e){a&&a(e)})):a&&(console.log("networkAgent: _getResByUserID,  onload  use res is empty "),a("use res is empty")))},s.send(c)};var t=function(e,t){if(!e)return-1;let r={};for(let n=0;n<e.length;n++)r[e[n].res_id]=e[n],n==e.length-1&&(console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback",n,e.length),t&&t(r))};window.getUsrOnlineRes=function(e,t,n,i,a,o){t||(t="fefe"),n||(n=""),i||(i=""),a||(a="");let s=e+"get_usr_online_res",l=new XMLHttpRequest,c={ver:"3.0.0",cid:5,data:{user_id:t,main_type:n,sub_type:i,category:a}},u=JSON.stringify(c);l.open("POST",s,!0),l.setRequestHeader("Content-Type","application/json"),l.responseType="json",l.onload=function(e){console.log("networkAgentVR.js: _getUsrOnlineRes: res = ",l.response),l.response.error?console.log("networkAgent.js: _getUsrOnlineRes,  onload error ",l.response):(console.log("networkAgent.js: _getUsrOnlineRes,  onload save ",l.response),l.response.data.online_res_list.length>0?r(l.response.data.online_res_list,(function(e){o&&o(e)})):o&&(console.log("networkAgent: _getUsrOnlineRes,  onload  use res is empty "),o({})))},l.send(u)};var r=function(e,t){if(!e)return-1;let r={};for(let n=0;n<e.length;n++)r[e[n].res_id]=e[n],n==e.length-1&&(console.log("netWorkAgent.js: createProjResDictFromResList: i == userARResList.length, callback",n,e.length),t&&t(r))};window.getVRSceneByUserID=function(e,t,r){if(!e)return-1;t||(t="makarvr");let n=[];if(n.user_id=t,"3.0.0"==serverVersion){var i=function(t,i,a){if(console.log("networkAgent.js: getVRSceneByUserID: getUserPublishProjsByUserID: userPublishProjs=",t),"string"!=typeof t){let o=[];for(let e in t.proj_list)"vr"==t.proj_list[e].proj_type&&o.push(t.proj_list[e].proj_id);let s=new XMLHttpRequest,l=e+"get_vr_projs_by_proj_id",c={ver:"3.0.0",cid:5,data:{proj_id_list:o}},u=JSON.stringify(c);s.open("POST",l,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(t){let o=s.response.data;window.publishVRProjs=o;let l=0;if(o.result&&o.result.length)for(let t=0;t<o.result.length;t++){let s=new XMLHttpRequest,c={user_id:o.result[t].user_id,proj_id:o.result[t].proj_id},u=e+"get_vr_proj_scene",d={ver:"3.0.0",cid:5,data:c},h=JSON.stringify(d);s.open("POST",u,!0),s.setRequestHeader("Content-Type","application/json"),s.responseType="json",s.onload=function(e){l++,n[t]=s.response.data,l==o.result.length&&(window.VRSceneResult=n,window.userProjResDict=i,window.userOnlineResDict=a,r&&r(n))},s.send(h)}},s.send(u)}};searchUserIDByUserID(e,t,(function(n){for(let e in n.result)t.toLowerCase()===n.result[e].user_id.toLowerCase()&&(console.log("networkAgentVR.js: _searchUserIDByUserID: match, replace from [",t,"] to [",n.result[e].user_id,"]"),t=n.result[e].user_id);getPayInfoByUserID(e,t,(function(n){!function(e,t){var r,n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState&&(200===n.status||0==n.status)){let e=n.responseText;r=e,t&&t(r)}},n.send(null)}("https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/web_white_list/webVR_UserID_WhiteList.txt",(function(a){let o=JSON.parse(a).customizedUserID.list,s=[];for(let e=0;e<o.length;e++)s.push(o[e].name);let l=s.indexOf(t)>-1;n.data?(console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: userPayInfo =",n.data),window.allowedMakarIDUseWeb=n.data.web_ar||l,0==window.allowedMakarIDUseWeb&&r&&r("user not allow webVR"),getUserPublishProjsByUserID(e,t,"","",i)):(console.log("networkAgent.js:_getARSceneByUserID:_getPayInfoByUserID: error, userPayInfo=",n),r&&r("this ID have some problem "))}))}))}))}},window.getPayInfoByUserID=function(e,t,r){if(!e)return-1;if(!t)return-1;let n=e+"get_pay_info",i=new XMLHttpRequest,a={ver:"3.0.0",cid:5,data:{user_id:t}},o=JSON.stringify(a);i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){r&&r(i.response)},i.send(o)},window.getVRDataByUserID=function(t,r,n){if(!t)return-1;r||(r="makarvr");let i=new XMLHttpRequest,a={user_id:r,cid:"20"},o=JSON.stringify(a),s=new FormData;s.append("cmd","get_vr_projs"),s.append("data",o),i.open("POST",t,!0),i.responseType="json",i.onload=function(t){let r;if(i.response.diaoyurar){let t=e(i.response.diaoyurar);t.error?(n&&n(t.error),console.log("networkAgent.js: getVRDataByUserID: oops something wrong:",t.error)):t.data?(r=t.data,window.userVRData?(console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it.."),window.userVRData=r):(console.log("networkAgent.js: getVRDataByUserID: save window.userARData "),window.userVRData=r),n&&n(r)):n&&n("networkAgent.js:getVRDataByUserID:error: no jsonData.data")}else i.response.error?(n&&n(i.response.error),console.log("networkAgent.js: getVRDataByUserID: oops something wrong:",i.response.error)):i.response.data?(r=i.response.data).proj_list?(window.userVRData?(console.log("networkAgent.js: getVRDataByUserID: window.userARData already exist, replace it.."),window.userVRData=r):(console.log("networkAgent.js: getVRDataByUserID: save window.userARData =",r),window.userVRData=r),n&&n(r)):(console.log("%cnetworkAgent.js:getVRDataByUserID: onload, fail userVRData.proj_list is empty","color:red"),n&&n("the userVRData.proj_list is empty")):n&&n("networkAgent.js:getVRDataByUserID:error: no xhr.response.data")},i.send(s)},window.uploadDataToServer=function(e,t,r){if(!e)return-1;let n=new XMLHttpRequest,i={user_id:userARData.user_id,target_id:userARData.proj_list[t].target_id};if("3.0.0"==serverVersion){let t=e+"add_scan_times",r={ver:"3.0.0",cid:5,data:i},a=JSON.stringify(r);n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.responseType="json",n.onload=function(e){},n.send(a)}if("2.0.0"==serverVersion){let t=JSON.stringify(i),r=new FormData;r.append("cmd","add_scan_times"),r.append("data",t),n.open("POST",e,!0),n.responseType="json",n.onload=function(e){console.log("networkAgent: uploadDataToServer, xhr = ",n.response.data)},n.send(r)}},window.searchUserIDByUserID=function(e,t,r){if(!e)return-1;if(!t)return-1;let n=e+"get_many_usr_info_keyword",i=new XMLHttpRequest,a={ver:"3.0.0",cid:5,data:{keyword:t,search_keys:["user_id"]}},o=JSON.stringify(a);i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(e){console.log("networkAgent.js: _searchUserIDByUserID: xhr.response",i.response.data),r&&r(i.response.data)},i.send(o)},window.testPOST=function(e,t){let r=new XMLHttpRequest,n={ver:"3.0.0",cid:5,data:{user_id:"fefe"},length:8},i=JSON.stringify(n);console.log(" jsonReq ",i);let a=new FormData;a.append("cmd","add_scan_times"),a.append("data",i),r.open("POST","http://60.250.125.146:8081/Makar/get_usr_publish_projs",!0),r.setRequestHeader("Content-Type","application/json"),r.responseType="json",r.onload=function(e){console.log("networkAgent: testPOST,  onload xhr = ",r,r.response)},r.send(i)}}();var key,Module=void 0!==Module?Module:{},moduleOverrides={};for(key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);Module.arguments=[],Module.thisProgram="./this.program",Module.quit=function(e,t){throw t},Module.preRun=[],Module.postRun=[];var nodeFS,nodePath,ENVIRONMENT_IS_WEB=!1,ENVIRONMENT_IS_WORKER=!1,ENVIRONMENT_IS_NODE=!1,ENVIRONMENT_IS_SHELL=!1;if(Module.ENVIRONMENT)if("WEB"===Module.ENVIRONMENT)ENVIRONMENT_IS_WEB=!0;else if("WORKER"===Module.ENVIRONMENT)ENVIRONMENT_IS_WORKER=!0;else if("NODE"===Module.ENVIRONMENT)ENVIRONMENT_IS_NODE=!0;else{if("SHELL"!==Module.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");ENVIRONMENT_IS_SHELL=!0}else ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&"function"==typeof require&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;for(key in ENVIRONMENT_IS_NODE?(Module.read=function(e,t){var r;return(r=tryParseAsDataURI(e))||(nodeFS||(nodeFS=require("fs")),nodePath||(nodePath=require("path")),e=nodePath.normalize(e),r=nodeFS.readFileSync(e)),t?r:r.toString()},Module.readBinary=function(e){var t=Module.read(e,!0);return t.buffer||(t=new Uint8Array(t)),assert(t.buffer),t},process.argv.length>1&&(Module.thisProgram=process.argv[1].replace(/\\/g,"/")),Module.arguments=process.argv.slice(2),"undefined"!=typeof module&&(module.exports=Module),process.on("uncaughtException",(function(e){if(!(e instanceof ExitStatus))throw e})),process.on("unhandledRejection",(function(e,t){process.exit(1)})),Module.inspect=function(){return"[Emscripten Module object]"}):ENVIRONMENT_IS_SHELL?("undefined"!=typeof read&&(Module.read=function(e){var t=tryParseAsDataURI(e);return t?intArrayToString(t):read(e)}),Module.readBinary=function(e){var t;return(t=tryParseAsDataURI(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(assert("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?Module.arguments=scriptArgs:"undefined"!=typeof arguments&&(Module.arguments=arguments),"function"==typeof quit&&(Module.quit=function(e,t){quit(e)})):(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(Module.read=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var r=tryParseAsDataURI(e);if(r)return intArrayToString(r);throw t}},ENVIRONMENT_IS_WORKER&&(Module.readBinary=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var r=tryParseAsDataURI(e);if(r)return r;throw t}}),Module.readAsync=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var i=tryParseAsDataURI(e);i?t(i.buffer):r()}},n.onerror=r,n.send(null)},"undefined"!=typeof arguments&&(Module.arguments=arguments),Module.setWindowTitle=function(e){document.title=e}),Module.print="undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null,Module.printErr="undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||Module.print,Module.print=Module.print,Module.printErr=Module.printErr,moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);moduleOverrides=void 0;var STACK_ALIGN=16;function staticAlloc(e){assert(!staticSealed);var t=STATICTOP;return STATICTOP=STATICTOP+e+15&-16,t}function dynamicAlloc(e){assert(DYNAMICTOP_PTR);var t=HEAP32[DYNAMICTOP_PTR>>2],r=t+e+15&-16;return HEAP32[DYNAMICTOP_PTR>>2]=r,r>=TOTAL_MEMORY&&!enlargeMemory()?(HEAP32[DYNAMICTOP_PTR>>2]=t,0):t}function alignMemory(e,t){return t||(t=STACK_ALIGN),Math.ceil(e/t)*t}function getNativeTypeSize(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return 4;if("i"===e[0]){var t=parseInt(e.substr(1));return assert(t%8==0),t/8}return 0}}function warnOnce(e){warnOnce.shown||(warnOnce.shown={}),warnOnce.shown[e]||(warnOnce.shown[e]=1,Module.printErr(e))}var jsCallStartIndex=1,functionPointers=new Array(0);function addFunction(e,t){for(var r=0;r<0;r++)if(!functionPointers[r])return functionPointers[r]=e,jsCallStartIndex+r;throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}function removeFunction(e){functionPointers[e-jsCallStartIndex]=null}var funcWrappers={};function getFuncWrapper(e,t){if(e){assert(t),funcWrappers[t]||(funcWrappers[t]={});var r=funcWrappers[t];return r[e]||(1===t.length?r[e]=function(){return dynCall(t,e)}:2===t.length?r[e]=function(r){return dynCall(t,e,[r])}:r[e]=function(){return dynCall(t,e,Array.prototype.slice.call(arguments))}),r[e]}}function makeBigInt(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)}function dynCall(e,t,r){return r&&r.length?Module["dynCall_"+e].apply(null,[t].concat(r)):Module["dynCall_"+e].call(null,t)}var Runtime={dynCall:dynCall},GLOBAL_BASE=8,ABORT=0,EXITSTATUS=0;function assert(e,t){e||abort("Assertion failed: "+t)}var globalScope=this;function getCFunc(e){var t=Module["_"+e];return assert(t,"Cannot call unknown function "+e+", make sure it is exported"),t}var JSfuncs={stackSave:function(){stackSave()},stackRestore:function(){stackRestore()},arrayToC:function(e){var t=stackAlloc(e.length);return writeArrayToMemory(e,t),t},stringToC:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);stringToUTF8(e,t=stackAlloc(r),r)}return t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};function ccall(e,t,r,n,i){var a=getCFunc(e),o=[],s=0;if(n)for(var l=0;l<n.length;l++){var c=toC[r[l]];c?(0===s&&(s=stackSave()),o[l]=c(n[l])):o[l]=n[l]}var u=a.apply(null,o);return"string"===t&&(u=Pointer_stringify(u)),0!==s&&stackRestore(s),u}function cwrap(e,t,r){r=r||[];var n=getCFunc(e),i=r.every((function(e){return"number"===e}));return"string"!==t&&i?n:function(){return ccall(e,t,r,arguments)}}function setValue(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":HEAP8[e>>0]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(0|Math_min(+Math_floor(tempDouble/4294967296),4294967295))>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+r)}}function getValue(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return HEAP8[e>>0];case"i16":return HEAP16[e>>1];case"i32":case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for getValue: "+t)}return null}var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;function allocate(e,t,r,n){var i,a;"number"==typeof e?(i=!0,a=e):(i=!1,a=e.length);var o,s="string"==typeof t?t:null;if(o=r==ALLOC_NONE?n:["function"==typeof _malloc?_malloc:staticAlloc,stackAlloc,staticAlloc,dynamicAlloc][void 0===r?ALLOC_STATIC:r](Math.max(a,s?1:t.length)),i){var l;for(n=o,assert(0==(3&o)),l=o+(-4&a);n<l;n+=4)HEAP32[n>>2]=0;for(l=o+a;n<l;)HEAP8[n++>>0]=0;return o}if("i8"===s)return e.subarray||e.slice?HEAPU8.set(e,o):HEAPU8.set(new Uint8Array(e),o),o;for(var c,u,d,h=0;h<a;){var f=e[h];0!==(c=s||t[h])?("i64"==c&&(c="i32"),setValue(o+h,f,c),d!==c&&(u=getNativeTypeSize(c),d=c),h+=u):h++}return o}function getMemory(e){return staticSealed?runtimeInitialized?_malloc(e):dynamicAlloc(e):staticAlloc(e)}function Pointer_stringify(e,t){if(0===t||!e)return"";for(var r,n=0,i=0;n|=r=HEAPU8[e+i>>0],(0!=r||t)&&(i++,!t||i!=t););t||(t=i);var a="";if(n<128){for(var o;t>0;)o=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,1024))),a=a?a+o:o,e+=1024,t-=1024;return a}return UTF8ToString(e)}function AsciiToString(e){for(var t="";;){var r=HEAP8[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}}function stringToAscii(e,t){return writeAsciiToMemory(e,t,!1)}var UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(e,t){for(var r=t;e[r];)++r;if(r-t>16&&e.subarray&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(t,r));for(var n,i,a,o,s,l="";;){if(!(n=e[t++]))return l;if(128&n)if(i=63&e[t++],192!=(224&n))if(a=63&e[t++],224==(240&n)?n=(15&n)<<12|i<<6|a:(o=63&e[t++],240==(248&n)?n=(7&n)<<18|i<<12|a<<6|o:(s=63&e[t++],n=248==(252&n)?(3&n)<<24|i<<18|a<<12|o<<6|s:(1&n)<<30|i<<24|a<<18|o<<12|s<<6|63&e[t++])),n<65536)l+=String.fromCharCode(n);else{var c=n-65536;l+=String.fromCharCode(55296|c>>10,56320|1023&c)}else l+=String.fromCharCode((31&n)<<6|i);else l+=String.fromCharCode(n)}}function UTF8ToString(e){return UTF8ArrayToString(HEAPU8,e)}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=2097151){if(r+3>=a)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else if(s<=67108863){if(r+4>=a)break;t[r++]=248|s>>24,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+5>=a)break;t[r++]=252|s>>30,t[r++]=128|s>>24&63,t[r++]=128|s>>18&63,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:n<=2097151?4:n<=67108863?5:6}return t}var UTF16Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function UTF16ToString(e){for(var t=e,r=t>>1;HEAP16[r];)++r;if((t=r<<1)-e>32&&UTF16Decoder)return UTF16Decoder.decode(HEAPU8.subarray(e,t));for(var n=0,i="";;){var a=HEAP16[e+2*n>>1];if(0==a)return i;++n,i+=String.fromCharCode(a)}}function stringToUTF16(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,a=0;a<i;++a){var o=e.charCodeAt(a);HEAP16[t>>1]=o,t+=2}return HEAP16[t>>1]=0,t-n}function lengthBytesUTF16(e){return 2*e.length}function UTF32ToString(e){for(var t=0,r="";;){var n=HEAP32[e+4*t>>2];if(0==n)return r;if(++t,n>=65536){var i=n-65536;r+=String.fromCharCode(55296|i>>10,56320|1023&i)}else r+=String.fromCharCode(n)}}function stringToUTF32(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),HEAP32[t>>2]=o,(t+=4)+4>i)break}return HEAP32[t>>2]=0,t-n}function lengthBytesUTF32(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function allocateUTF8(e){var t=lengthBytesUTF8(e)+1,r=_malloc(t);return r&&stringToUTF8Array(e,HEAP8,r,t),r}function allocateUTF8OnStack(e){var t=lengthBytesUTF8(e)+1,r=stackAlloc(t);return stringToUTF8Array(e,HEAP8,r,t),r}function demangle(e){return e}function demangleAll(e){return e.replace(/__Z[\w\d_]+/g,(function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"}))}function jsStackTrace(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function stackTrace(){var e=jsStackTrace();return Module.extraStackTrace&&(e+="\n"+Module.extraStackTrace()),demangleAll(e)}var HEAP,buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE,STATICTOP,staticSealed,STACK_BASE,STACKTOP,STACK_MAX,DYNAMIC_BASE,DYNAMICTOP_PTR,PAGE_SIZE=16384,WASM_PAGE_SIZE=65536,ASMJS_PAGE_SIZE=16777216,MIN_TOTAL_MEMORY=16777216;function alignUp(e,t){return e%t>0&&(e+=t-e%t),e}function updateGlobalBuffer(e){Module.buffer=buffer=e}function updateGlobalBufferViews(){Module.HEAP8=HEAP8=new Int8Array(buffer),Module.HEAP16=HEAP16=new Int16Array(buffer),Module.HEAP32=HEAP32=new Int32Array(buffer),Module.HEAPU8=HEAPU8=new Uint8Array(buffer),Module.HEAPU16=HEAPU16=new Uint16Array(buffer),Module.HEAPU32=HEAPU32=new Uint32Array(buffer),Module.HEAPF32=HEAPF32=new Float32Array(buffer),Module.HEAPF64=HEAPF64=new Float64Array(buffer)}function abortOnCannotGrowMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+TOTAL_MEMORY+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or (4) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function enlargeMemory(){abortOnCannotGrowMemory()}STATIC_BASE=STATICTOP=STACK_BASE=STACKTOP=STACK_MAX=DYNAMIC_BASE=DYNAMICTOP_PTR=0,staticSealed=!1;var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216;function getTotalMemory(){return TOTAL_MEMORY}if(TOTAL_MEMORY<TOTAL_STACK&&Module.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+TOTAL_MEMORY+"! (TOTAL_STACK="+TOTAL_STACK+")"),Module.buffer?buffer=Module.buffer:(buffer=new ArrayBuffer(TOTAL_MEMORY),Module.buffer=buffer),updateGlobalBufferViews(),HEAP32[0]=1668509029,HEAP16[1]=25459,115!==HEAPU8[2]||99!==HEAPU8[3])throw"Runtime error: expected the system to be little-endian!";function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?Module.dynCall_v(r):Module.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__),runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPreMain(e){__ATMAIN__.unshift(e)}function addOnExit(e){__ATEXIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}function writeStringToMemory(e,t,r){var n,i;warnOnce("writeStringToMemory is deprecated and should not be called! Use stringToUTF8() instead!"),r&&(i=t+lengthBytesUTF8(e),n=HEAP8[i]),stringToUTF8(e,t,1/0),r&&(HEAP8[i]=n)}function writeArrayToMemory(e,t){HEAP8.set(e,t)}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function unSign(e,t,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,r){if(e<=0)return e;var n=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=n&&(t<=32||e>n)&&(e=-2*n+e),e}var Math_abs=Math.abs,Math_cos=Math.cos,Math_sin=Math.sin,Math_tan=Math.tan,Math_acos=Math.acos,Math_asin=Math.asin,Math_atan=Math.atan,Math_atan2=Math.atan2,Math_exp=Math.exp,Math_log=Math.log,Math_sqrt=Math.sqrt,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_imul=Math.imul,Math_fround=Math.fround,Math_round=Math.round,Math_min=Math.min,Math_max=Math.max,Math_clz32=Math.clz32,Math_trunc=Math.trunc,runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.preloadedImages={},Module.preloadedAudios={};var memoryInitializer=null,dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return String.prototype.startsWith?e.startsWith(dataURIPrefix):0===e.indexOf(dataURIPrefix)}var ASM_CONSTS=[function(e,t){if("undefined"!=typeof window){let e=arguments,t=new Uint8Array(Module.HEAPU8.buffer,e[0],e[1]),r=new TextDecoder("utf-8").decode(t);window.checkHost="yet";let n=new XMLHttpRequest;n.open("GET",r),n.responseType="json",n.onload=function(e){let t=n.response.customizedWebSites;if(void 0!==t){let e=t.list;if(void 0!==e)for(let t in e){if(e[t].name==location.hostname){window.checkHost="correct";break}t==e.length-1&&(window.checkHost="fail")}}},n.send()}}];function _emscripten_asm_const_iii(e,t,r){return ASM_CONSTS[e](t,r)}STATICTOP=(STATIC_BASE=GLOBAL_BASE)+3472,__ATINIT__.push({func:function(){__GLOBAL__sub_I_whiteList_cpp()}},{func:function(){__GLOBAL__sub_I_bind_cpp()}}),memoryInitializer="data:application/octet-stream;base64,jAEAAD8HAACMAQAAfgcAAIwBAAC8BwAAjAEAAAIIAACMAQAAPwgAAIwBAABeCAAAjAEAAH0IAACMAQAAnAgAAIwBAAC7CAAAjAEAANoIAACMAQAA+QgAAIwBAAA2CQAAjAEAAFUJAAD4AQAAaAkAAAAAAAABAAAAiAAAAAAAAACMAQAApwkAAPgBAADNCQAAAAAAAAEAAACIAAAAAAAAAPgBAAAMCgAAAAAAAAEAAACIAAAAAAAAALQBAAADCwAA0AAAAAAAAAC0AQAAsAoAAOAAAAAAAAAAjAEAANEKAAC0AQAA3goAAMAAAAAAAAAAtAEAACULAADQAAAAAAAAANwBAABNCwAA3AEAAE8LAADcAQAAUQsAANwBAABTCwAA3AEAAFULAADcAQAAVwsAANwBAABZCwAA3AEAAFsLAADcAQAAXQsAANwBAABfCwAA3AEAAGELAADcAQAAYwsAANwBAABlCwAAtAEAAGcLAADAAAAAAAAAAEABAAAAAAAAwAAAAAEAAAACAAAAAwAAAAQAAAABAAAAAQAAAAEAAAABAAAAAAAAAOgAAAABAAAABQAAAAMAAAAEAAAAAQAAAAIAAAACAAAAAgAAAAAAAAD4AAAAAQAAAAYAAAADAAAABAAAAAIAAAAAAAAAcAEAAAEAAAAHAAAAAwAAAAQAAAABAAAAAwAAAAMAAAADAAAAaHR0cHM6Ly9zMy1hcC1ub3J0aGVhc3QtMS5hbWF6b25hd3MuY29tL21ha2FyLndlYmFyLmRlZmF1bHRvYmplY3Qvd2ViX3doaXRlX2xpc3Qvd2ViU2l0ZUxpc3QudHh0AHsgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7IGxldCBhID0gYXJndW1lbnRzOyBsZXQgeSA9IG5ldyBVaW50OEFycmF5KCBNb2R1bGUuSEVBUFU4LmJ1ZmZlciwgYVswXSwgYVsxXSApOyBsZXQgbGlzdFVybCA9IG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoeSk7IHdpbmRvdy5jaGVja0hvc3QgPSAieWV0IjsgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyB4aHIub3BlbiggJ0dFVCcsIGxpc3RVcmwgKTsgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJzsgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsgbGV0IGN1c3RvbWl6ZWRXZWJTaXRlcyA9IHhoci5yZXNwb25zZS5jdXN0b21pemVkV2ViU2l0ZXM7IGlmICggdHlwZW9mKGN1c3RvbWl6ZWRXZWJTaXRlcykgIT0gInVuZGVmaW5lZCIgKXsgbGV0IGxpc3QgPSBjdXN0b21pemVkV2ViU2l0ZXMubGlzdCA7IGlmICggdHlwZW9mKGxpc3QpICE9ICJ1bmRlZmluZWQiICl7IGZvciAobGV0IGkgaW4gbGlzdCApeyBpZiAoIGxpc3RbaV0ubmFtZSA9PSBsb2NhdGlvbi5ob3N0bmFtZSl7IHdpbmRvdy5jaGVja0hvc3QgPSAiY29ycmVjdCI7IGJyZWFrOyB9IGlmICggaSA9PSBsaXN0Lmxlbmd0aCAtIDEgKXsgd2luZG93LmNoZWNrSG9zdCA9ICJmYWlsIjsgfSB9IH0gfSB9OyB4aHIuc2VuZCgpOyB9IH0AY2hlY2tNaWZseQBpaQB2b2lkAGJvb2wAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lkRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8ZmxvYXQ+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1bnNpZ25lZCBsb25nPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUAZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4ATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGNoYXI+AE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSXdOU18xMWNoYXJfdHJhaXRzSXdFRU5TXzlhbGxvY2F0b3JJd0VFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQBkb3VibGUAZmxvYXQAdW5zaWduZWQgbG9uZwBsb25nAHVuc2lnbmVkIGludABpbnQAdW5zaWduZWQgc2hvcnQAc2hvcnQAdW5zaWduZWQgY2hhcgBzaWduZWQgY2hhcgBjaGFyAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyM19fZnVuZGFtZW50YWxfdHlwZV9pbmZvRQB2AGIAYwBoAGEAcwB0AGkAagBsAG0AZgBkAE4xMF9fY3h4YWJpdjEyMV9fdm1pX2NsYXNzX3R5cGVfaW5mb0U=";var tempDoublePtr=STATICTOP;function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}STATICTOP+=16;var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||EXCEPTIONS.infos[e])return e;for(var t in EXCEPTIONS.infos)if(EXCEPTIONS.infos[t].adjusted===e)return t;return e},addRef:function(e){e&&EXCEPTIONS.infos[e].refcount++},decRef:function(e){if(e){var t=EXCEPTIONS.infos[e];assert(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&Module.dynCall_vi(t.destructor,e),delete EXCEPTIONS.infos[e],___cxa_free_exception(e))}},clearRef:function(e){e&&(EXCEPTIONS.infos[e].refcount=0)}};function ___resumeException(e){throw EXCEPTIONS.last||(EXCEPTIONS.last=e),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var e=EXCEPTIONS.last;if(!e)return 0|(setTempRet0(0),0);var t=EXCEPTIONS.infos[e],r=t.type;if(!r)return 0|(setTempRet0(0),e);var n=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(r),___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=e,e=___cxa_find_matching_catch.buffer;for(var i=0;i<n.length;i++)if(n[i]&&Module.___cxa_can_catch(n[i],r,e))return e=HEAP32[e>>2],t.adjusted=e,0|(setTempRet0(n[i]),e);return e=HEAP32[e>>2],0|(setTempRet0(r),e)}function ___gxx_personality_v0(){}function getShiftFromSize(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function embind_init_charCodes(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);embind_charCodes=e}var embind_charCodes=void 0;function readLatin1String(e){for(var t="",r=e;HEAPU8[r];)t+=embind_charCodes[HEAPU8[r++]];return t}var awaitingDependencies={},registeredTypes={},typeDependencies={},char_0=48,char_9=57;function makeLegalFunctionName(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=char_0&&t<=char_9?"_"+e:e}function createNamedFunction(e,t){return e=makeLegalFunctionName(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function extendError(e,t){var r=createNamedFunction(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var BindingError=void 0;function throwBindingError(e){throw new BindingError(e)}var InternalError=void 0;function throwInternalError(e){throw new InternalError(e)}function whenDependentTypesAreResolved(e,t,r){function n(t){var n=r(t);n.length!==e.length&&throwInternalError("Mismatched type converter count");for(var i=0;i<e.length;++i)registerType(e[i],n[i])}e.forEach((function(e){typeDependencies[e]=t}));var i=new Array(t.length),a=[],o=0;t.forEach((function(e,t){registeredTypes.hasOwnProperty(e)?i[t]=registeredTypes[e]:(a.push(e),awaitingDependencies.hasOwnProperty(e)||(awaitingDependencies[e]=[]),awaitingDependencies[e].push((function(){i[t]=registeredTypes[e],++o===a.length&&n(i)})))})),0===a.length&&n(i)}function registerType(e,t,r){if(r=r||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||throwBindingError('type "'+n+'" must have a positive integer typeid pointer'),registeredTypes.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;throwBindingError("Cannot register type '"+n+"' twice")}if(registeredTypes[e]=t,delete typeDependencies[e],awaitingDependencies.hasOwnProperty(e)){var i=awaitingDependencies[e];delete awaitingDependencies[e],i.forEach((function(e){e()}))}}function __embind_register_bool(e,t,r,n,i){var a=getShiftFromSize(r);registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=HEAP8;else if(2===r)n=HEAP16;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=HEAP32}return this.fromWireType(n[e>>a])},destructorFunction:null})}var emval_free_list=[],emval_handle_array=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function __emval_decref(e){e>4&&0==--emval_handle_array[e].refcount&&(emval_handle_array[e]=void 0,emval_free_list.push(e))}function count_emval_handles(){for(var e=0,t=5;t<emval_handle_array.length;++t)void 0!==emval_handle_array[t]&&++e;return e}function get_first_emval(){for(var e=5;e<emval_handle_array.length;++e)if(void 0!==emval_handle_array[e])return emval_handle_array[e];return null}function init_emval(){Module.count_emval_handles=count_emval_handles,Module.get_first_emval=get_first_emval}function __emval_register(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=emval_free_list.length?emval_free_list.pop():emval_handle_array.length;return emval_handle_array[t]={refcount:1,value:e},t}}function simpleReadValueFromPointer(e){return this.fromWireType(HEAPU32[e>>2])}function __embind_register_emval(e,t){registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){var t=emval_handle_array[e].value;return __emval_decref(e),t},toWireType:function(e,t){return __emval_register(t)},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:null})}function _embind_repr(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function floatReadValueFromPointer(e,t){switch(t){case 2:return function(e){return this.fromWireType(HEAPF32[e>>2])};case 3:return function(e){return this.fromWireType(HEAPF64[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function __embind_register_float(e,t,r){var n=getShiftFromSize(r);registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+_embind_repr(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:floatReadValueFromPointer(t,n),destructorFunction:null})}function new_(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=createNamedFunction(e.name||"unknownFunctionName",(function(){}));r.prototype=e.prototype;var n=new r,i=e.apply(n,t);return i instanceof Object?i:n}function runDestructors(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function craftInvokerFunction(e,t,r,n,i){var a=t.length;a<2&&throwBindingError("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==t[1]&&null!==r,s=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){s=!0;break}var c="void"!==t[0].name,u="",d="";for(l=0;l<a-2;++l)u+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var h="return function "+makeLegalFunctionName(e)+"("+u+") {\nif (arguments.length !== "+(a-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(a-2)+" args!');\n}\n";s&&(h+="var destructors = [];\n");var f=s?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[throwBindingError,n,i,runDestructors,t[0],t[1]];for(o&&(h+="var thisWired = classParam.toWireType("+f+", this);\n"),l=0;l<a-2;++l)h+="var arg"+l+"Wired = argType"+l+".toWireType("+f+", arg"+l+"); // "+t[l+2].name+"\n",p.push("argType"+l),m.push(t[l+2]);if(o&&(d="thisWired"+(d.length>0?", ":"")+d),h+=(c?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",s)h+="runDestructors(destructors);\n";else for(l=o?1:2;l<t.length;++l){var v=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(h+=v+"_dtor("+v+"); // "+t[l].name+"\n",p.push(v+"_dtor"),m.push(t[l].destructorFunction))}return c&&(h+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),h+="}\n",p.push(h),new_(Function,p).apply(null,m)}function ensureOverloadTable(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||throwBindingError("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function exposePublicSymbol(e,t,r){Module.hasOwnProperty(e)?((void 0===r||void 0!==Module[e].overloadTable&&void 0!==Module[e].overloadTable[r])&&throwBindingError("Cannot register public name '"+e+"' twice"),ensureOverloadTable(Module,e,e),Module.hasOwnProperty(r)&&throwBindingError("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),Module[e].overloadTable[r]=t):(Module[e]=t,void 0!==r&&(Module[e].numArguments=r))}function heap32VectorToArray(e,t){for(var r=[],n=0;n<e;n++)r.push(HEAP32[(t>>2)+n]);return r}function replacePublicSymbol(e,t,r){Module.hasOwnProperty(e)||throwInternalError("Replacing nonexistant public symbol"),void 0!==Module[e].overloadTable&&void 0!==r?Module[e].overloadTable[r]=t:(Module[e]=t,Module[e].argCount=r)}function embind__requireFunction(e,t){var r;if(e=readLatin1String(e),void 0!==Module["FUNCTION_TABLE_"+e])r=Module["FUNCTION_TABLE_"+e][t];else if("undefined"!=typeof FUNCTION_TABLE)r=FUNCTION_TABLE[t];else{var n=Module.asm["dynCall_"+e];void 0===n&&void 0===(n=Module.asm["dynCall_"+e.replace(/f/g,"d")])&&throwBindingError("No dynCall invoker for signature: "+e),r=function(r){for(var n=[],i=1;i<e.length;++i)n.push("a"+i);var a="return function dynCall_"+e+"_"+t+"("+n.join(", ")+") {\n";return a+="    return dynCall(rawFunction"+(n.length?", ":"")+n.join(", ")+");\n",a+="};\n",new Function("dynCall","rawFunction",a)(r,t)}(n)}return"function"!=typeof r&&throwBindingError("unknown function pointer with signature "+e+": "+t),r}var UnboundTypeError=void 0;function getTypeName(e){var t=___getTypeName(e),r=readLatin1String(t);return _free(t),r}function throwUnboundTypeError(e,t){var r=[],n={};throw t.forEach((function e(t){n[t]||registeredTypes[t]||(typeDependencies[t]?typeDependencies[t].forEach(e):(r.push(t),n[t]=!0))})),new UnboundTypeError(e+": "+r.map(getTypeName).join([", "]))}function __embind_register_function(e,t,r,n,i,a){var o=heap32VectorToArray(t,r);e=readLatin1String(e),i=embind__requireFunction(n,i),exposePublicSymbol(e,(function(){throwUnboundTypeError("Cannot call "+e+" due to unbound types",o)}),t-1),whenDependentTypesAreResolved([],o,(function(r){var n=[r[0],null].concat(r.slice(1));return replacePublicSymbol(e,craftInvokerFunction(e,n,null,i,a),t-1),[]}))}function integerReadValueFromPointer(e,t,r){switch(t){case 0:return r?function(e){return HEAP8[e]}:function(e){return HEAPU8[e]};case 1:return r?function(e){return HEAP16[e>>1]}:function(e){return HEAPU16[e>>1]};case 2:return r?function(e){return HEAP32[e>>2]}:function(e){return HEAPU32[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function __embind_register_integer(e,t,r,n,i){t=readLatin1String(t),-1===i&&(i=4294967295);var a=getShiftFromSize(r),o=function(e){return e};if(0===n){var s=32-8*r;o=function(e){return e<<s>>>s}}var l=-1!=t.indexOf("unsigned");registerType(e,{name:t,fromWireType:o,toWireType:function(e,r){if("number"!=typeof r&&"boolean"!=typeof r)throw new TypeError('Cannot convert "'+_embind_repr(r)+'" to '+this.name);if(r<n||r>i)throw new TypeError('Passing a number "'+_embind_repr(r)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+i+"]!");return l?r>>>0:0|r},argPackAdvance:8,readValueFromPointer:integerReadValueFromPointer(t,a,0!==n),destructorFunction:null})}function __embind_register_memory_view(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=HEAPU32,r=t[e>>=2],i=t[e+1];return new n(t.buffer,i,r)}registerType(e,{name:r=readLatin1String(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})}function __embind_register_std_string(e,t){registerType(e,{name:t=readLatin1String(t),fromWireType:function(e){for(var t=HEAPU32[e>>2],r=new Array(t),n=0;n<t;++n)r[n]=String.fromCharCode(HEAPU8[e+4+n]);return _free(e),r.join("")},toWireType:function(e,t){function r(e,t){return e[t]}var n;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array?n=r:t instanceof Uint8ClampedArray?n=r:t instanceof Int8Array?n=r:"string"==typeof t?n=function(e,t){return e.charCodeAt(t)}:throwBindingError("Cannot pass non-string to std::string");var i=t.length,a=_malloc(4+i);HEAPU32[a>>2]=i;for(var o=0;o<i;++o){var s=n(t,o);s>255&&(_free(a),throwBindingError("String has UTF-16 code units that do not fit in 8 bits")),HEAPU8[a+4+o]=s}return null!==e&&e.push(_free,a),a},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_std_wstring(e,t,r){var n,i;r=readLatin1String(r),2===t?(n=function(){return HEAPU16},i=1):4===t&&(n=function(){return HEAPU32},i=2),registerType(e,{name:r,fromWireType:function(e){for(var t=n(),r=HEAPU32[e>>2],a=new Array(r),o=e+4>>i,s=0;s<r;++s)a[s]=String.fromCharCode(t[o+s]);return _free(e),a.join("")},toWireType:function(e,r){var a=n(),o=r.length,s=_malloc(4+o*t);HEAPU32[s>>2]=o;for(var l=s+4>>i,c=0;c<o;++c)a[l+c]=r.charCodeAt(c);return null!==e&&e.push(_free,s),s},argPackAdvance:8,readValueFromPointer:simpleReadValueFromPointer,destructorFunction:function(e){_free(e)}})}function __embind_register_void(e,t){registerType(e,{isVoid:!0,name:t=readLatin1String(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})}var _emscripten_asm_const_int=!0;function _emscripten_memcpy_big(e,t,r){return HEAPU8.set(HEAPU8.subarray(t,t+r),e),e}function ___setErrNo(e){return Module.___errno_location&&(HEAP32[Module.___errno_location()>>2]=e),e}embind_init_charCodes(),BindingError=Module.BindingError=extendError(Error,"BindingError"),InternalError=Module.InternalError=extendError(Error,"InternalError"),init_emval(),UnboundTypeError=Module.UnboundTypeError=extendError(Error,"UnboundTypeError"),DYNAMICTOP_PTR=staticAlloc(4),STACK_BASE=STACKTOP=alignMemory(STATICTOP),DYNAMIC_BASE=alignMemory(STACK_MAX=STACK_BASE+TOTAL_STACK),HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE,staticSealed=!0;var ASSERTIONS=!1;function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,i=new Array(n),a=stringToUTF8Array(e,i,0,i.length);return t&&(i.length=a),i}function intArrayToString(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(ASSERTIONS&&assert(!1,"Character code "+n+" ("+String.fromCharCode(n)+")  at offset "+r+" not in 0x00-0xFF."),n&=255),t.push(String.fromCharCode(n))}return t.join("")}var decodeBase64="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(r)),64!==o&&(l+=String.fromCharCode(n))}while(c<e.length);return l};function intArrayFromBase64(e){if("boolean"==typeof ENVIRONMENT_IS_NODE&&ENVIRONMENT_IS_NODE){var t;try{t=Buffer.from(e,"base64")}catch(r){t=new Buffer(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var r=decodeBase64(e),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n}catch(e){throw new Error("Converting base64 string to bytes failed.")}}function tryParseAsDataURI(e){if(isDataURI(e))return intArrayFromBase64(e.slice(dataURIPrefix.length))}function invoke_i(e){try{return Module.dynCall_i(e)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_ii(e,t){try{return Module.dynCall_ii(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_iiii(e,t,r,n){try{return Module.dynCall_iiii(e,t,r,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_vi(e,t){try{Module.dynCall_vi(e,t)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiii(e,t,r,n,i){try{Module.dynCall_viiii(e,t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiii(e,t,r,n,i,a){try{Module.dynCall_viiiii(e,t,r,n,i,a)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}function invoke_viiiiii(e,t,r,n,i,a,o){try{Module.dynCall_viiiiii(e,t,r,n,i,a,o)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Module.setThrew(1,0)}}Module.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0},Module.asmLibraryArg={abort:abort,assert:assert,enlargeMemory:enlargeMemory,getTotalMemory:getTotalMemory,abortOnCannotGrowMemory:abortOnCannotGrowMemory,invoke_i:invoke_i,invoke_ii:invoke_ii,invoke_iiii:invoke_iiii,invoke_vi:invoke_vi,invoke_viiii:invoke_viiii,invoke_viiiii:invoke_viiiii,invoke_viiiiii:invoke_viiiiii,__ZSt18uncaught_exceptionv:__ZSt18uncaught_exceptionv,___cxa_find_matching_catch:___cxa_find_matching_catch,___gxx_personality_v0:___gxx_personality_v0,___resumeException:___resumeException,___setErrNo:___setErrNo,__embind_register_bool:__embind_register_bool,__embind_register_emval:__embind_register_emval,__embind_register_float:__embind_register_float,__embind_register_function:__embind_register_function,__embind_register_integer:__embind_register_integer,__embind_register_memory_view:__embind_register_memory_view,__embind_register_std_string:__embind_register_std_string,__embind_register_std_wstring:__embind_register_std_wstring,__embind_register_void:__embind_register_void,__emval_decref:__emval_decref,__emval_register:__emval_register,_embind_repr:_embind_repr,_emscripten_asm_const_iii:_emscripten_asm_const_iii,_emscripten_memcpy_big:_emscripten_memcpy_big,count_emval_handles:count_emval_handles,craftInvokerFunction:craftInvokerFunction,createNamedFunction:createNamedFunction,embind__requireFunction:embind__requireFunction,embind_init_charCodes:embind_init_charCodes,ensureOverloadTable:ensureOverloadTable,exposePublicSymbol:exposePublicSymbol,extendError:extendError,floatReadValueFromPointer:floatReadValueFromPointer,getShiftFromSize:getShiftFromSize,getTypeName:getTypeName,get_first_emval:get_first_emval,heap32VectorToArray:heap32VectorToArray,init_emval:init_emval,integerReadValueFromPointer:integerReadValueFromPointer,makeLegalFunctionName:makeLegalFunctionName,new_:new_,readLatin1String:readLatin1String,registerType:registerType,replacePublicSymbol:replacePublicSymbol,runDestructors:runDestructors,simpleReadValueFromPointer:simpleReadValueFromPointer,throwBindingError:throwBindingError,throwInternalError:throwInternalError,throwUnboundTypeError:throwUnboundTypeError,whenDependentTypesAreResolved:whenDependentTypesAreResolved,DYNAMICTOP_PTR:DYNAMICTOP_PTR,tempDoublePtr:tempDoublePtr,ABORT:ABORT,STACKTOP:STACKTOP,STACK_MAX:STACK_MAX};var initialStackTop,asm=function(e,t,r){"use asm";var n=new e.Int8Array(r);var i=new e.Int16Array(r);var a=new e.Int32Array(r);var o=new e.Uint8Array(r);var s=new e.Uint16Array(r);var l=new e.Uint32Array(r);var c=new e.Float32Array(r);var u=new e.Float64Array(r);var d=t.DYNAMICTOP_PTR|0;var h=t.tempDoublePtr|0;var f=t.ABORT|0;var p=t.STACKTOP|0;var m=t.STACK_MAX|0;var v=0;var g=0;var y=0;var b=0;var _=e.NaN,E=e.Infinity;var A=0,w=0,T=0,k=0,R=0.0;var x=0;var C=e.Math.floor;var S=e.Math.abs;var M=e.Math.sqrt;var I=e.Math.pow;var D=e.Math.cos;var N=e.Math.sin;var j=e.Math.tan;var H=e.Math.acos;var O=e.Math.asin;var P=e.Math.atan;var L=e.Math.atan2;var F=e.Math.exp;var V=e.Math.log;var B=e.Math.ceil;var U=e.Math.imul;var z=e.Math.min;var G=e.Math.max;var W=e.Math.clz32;var K=t.abort;var X=t.assert;var q=t.enlargeMemory;var Z=t.getTotalMemory;var Y=t.abortOnCannotGrowMemory;var J=t.invoke_i;var Q=t.invoke_ii;var $=t.invoke_iiii;var ee=t.invoke_vi;var te=t.invoke_viiii;var re=t.invoke_viiiii;var ne=t.invoke_viiiiii;var ie=t.__ZSt18uncaught_exceptionv;var ae=t.___cxa_find_matching_catch;var oe=t.___gxx_personality_v0;var se=t.___resumeException;var le=t.___setErrNo;var ce=t.__embind_register_bool;var ue=t.__embind_register_emval;var de=t.__embind_register_float;var he=t.__embind_register_function;var fe=t.__embind_register_integer;var pe=t.__embind_register_memory_view;var me=t.__embind_register_std_string;var ve=t.__embind_register_std_wstring;var ge=t.__embind_register_void;var ye=t.__emval_decref;var be=t.__emval_register;var _e=t._embind_repr;var Ee=t._emscripten_asm_const_iii;var Ae=t._emscripten_memcpy_big;var we=t.count_emval_handles;var Te=t.craftInvokerFunction;var ke=t.createNamedFunction;var Re=t.embind__requireFunction;var xe=t.embind_init_charCodes;var Ce=t.ensureOverloadTable;var Se=t.exposePublicSymbol;var Me=t.extendError;var Ie=t.floatReadValueFromPointer;var De=t.getShiftFromSize;var Ne=t.getTypeName;var je=t.get_first_emval;var He=t.heap32VectorToArray;var Oe=t.init_emval;var Pe=t.integerReadValueFromPointer;var Le=t.makeLegalFunctionName;var Fe=t.new_;var Ve=t.readLatin1String;var Be=t.registerType;var Ue=t.replacePublicSymbol;var ze=t.runDestructors;var Ge=t.simpleReadValueFromPointer;var We=t.throwBindingError;var Ke=t.throwInternalError;var Xe=t.throwUnboundTypeError;var qe=t.whenDependentTypesAreResolved;var Ze=0.0;function Ye(e){e=e|0;var t=0;t=p;p=p+e|0;p=p+15&-16;return t|0}function Je(){return p|0}function Qe(e){e=e|0;p=e}function $e(e,t){e=e|0;t=t|0;p=e;m=t}function et(e,t){e=e|0;t=t|0;if((v|0)==0){v=e;g=t}}function tt(e){e=e|0;x=e}function rt(){return x|0}function nt(){var e=0,t=0,r=0;r=p;e=Ee(0,536|0,96)|0;return 1}function it(){var e=0,t=0;t=p;nt()|0;return}function at(){var e=0,t=0;t=p;ot(0);return}function ot(e){e=e|0;var t=0,r=0;r=p;st(1307,1);return}function st(e,t){e=e|0;t=t|0;var r=0,n=0,i=0,a=0,o=0,s=0;s=p;p=p+16|0;r=s;n=ct(r)|0;i=ut(r)|0;a=ft()|0;he(e|0,n|0,i|0,a|0,1|0,t|0);p=s;return}function lt(e){e=e|0;var t=0,r=0,n=0,i=0,o=0;o=p;p=p+16|0;t=o;r=Gn[e&1]()|0;a[t>>2]=r;n=dt(t)|0;p=o;return n|0}function ct(e){e=e|0;var t=0,r=0;r=p;return 1}function ut(e){e=e|0;var t=0,r=0,n=0;n=p;t=ht()|0;return t|0}function dt(e){e=e|0;var t=0,r=0,n=0;n=p;t=a[e>>2]|0;return t|0}function ht(){var e=0,t=0;t=p;return 384|0}function ft(){var e=0,t=0;t=p;return 1318|0}function pt(){var e=0,t=0;t=p;it();at();return}function mt(){var e=0,t=0;t=p;vt();return}function vt(){var e=0,t=0;t=p;gt(0);return}function gt(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0,l=0;l=p;t=yt()|0;ge(t|0,1321|0);r=bt()|0;ce(r|0,1326|0,1,1,0);_t();Et();At();wt();Tt();kt();Rt();xt();Ct();St();Mt();n=It()|0;me(n|0,1331|0);i=Dt()|0;me(i|0,1343|0);a=Nt()|0;ve(a|0,4,1376|0);o=jt()|0;ue(o|0,1389|0);Ht();Ot(1405);Pt(1442);Lt(1481);Ft(1512);Vt(1552);Bt(1581);Ut();zt();Ot(1619);Pt(1651);Lt(1684);Ft(1717);Vt(1751);Bt(1784);Gt();Wt();Kt();return}function yt(){var e=0,t=0,r=0;r=p;e=Gr()|0;return e|0}function bt(){var e=0,t=0,r=0;r=p;e=zr()|0;return e|0}function _t(){var e=0,t=0,r=0;r=p;e=Br()|0;fe(e|0,2731|0,1,-128,127);return}function Et(){var e=0,t=0,r=0;r=p;e=Fr()|0;fe(e|0,2719|0,1,-128,127);return}function At(){var e=0,t=0,r=0;r=p;e=Pr()|0;fe(e|0,2705|0,1,0,255);return}function wt(){var e=0,t=0,r=0;r=p;e=Hr()|0;fe(e|0,2699|0,2,-32768,32767);return}function Tt(){var e=0,t=0,r=0;r=p;e=Nr()|0;fe(e|0,2684|0,2,0,65535);return}function kt(){var e=0,t=0,r=0;r=p;e=Ir()|0;fe(e|0,2680|0,4,-2147483648,2147483647);return}function Rt(){var e=0,t=0,r=0;r=p;e=Sr()|0;fe(e|0,2667|0,4,0,-1);return}function xt(){var e=0,t=0,r=0;r=p;e=xr()|0;fe(e|0,2662|0,4,-2147483648,2147483647);return}function Ct(){var e=0,t=0,r=0;r=p;e=kr()|0;fe(e|0,2648|0,4,0,-1);return}function St(){var e=0,t=0,r=0;r=p;e=wr()|0;de(e|0,2642|0,4);return}function Mt(){var e=0,t=0,r=0;r=p;e=Er()|0;de(e|0,2635|0,8);return}function It(){var e=0,t=0,r=0;r=p;e=_r()|0;return e|0}function Dt(){var e=0,t=0,r=0;r=p;e=br()|0;return e|0}function Nt(){var e=0,t=0,r=0;r=p;e=yr()|0;return e|0}function jt(){var e=0,t=0,r=0;r=p;e=gr()|0;return e|0}function Ht(){var e=0,t=0,r=0;r=p;e=mr()|0;pe(e|0,0,2328|0);return}function Ot(e){e=e|0;var t=0,r=0,n=0;n=p;t=fr()|0;pe(t|0,0,e|0);return}function Pt(e){e=e|0;var t=0,r=0,n=0;n=p;t=dr()|0;pe(t|0,1,e|0);return}function Lt(e){e=e|0;var t=0,r=0,n=0;n=p;t=cr()|0;pe(t|0,2,e|0);return}function Ft(e){e=e|0;var t=0,r=0,n=0;n=p;t=sr()|0;pe(t|0,3,e|0);return}function Vt(e){e=e|0;var t=0,r=0,n=0;n=p;t=ar()|0;pe(t|0,4,e|0);return}function Bt(e){e=e|0;var t=0,r=0,n=0;n=p;t=nr()|0;pe(t|0,5,e|0);return}function Ut(){var e=0,t=0,r=0;r=p;e=tr()|0;pe(e|0,4,2081|0);return}function zt(){var e=0,t=0,r=0;r=p;e=$t()|0;pe(e|0,5,2011|0);return}function Gt(){var e=0,t=0,r=0;r=p;e=Jt()|0;pe(e|0,6,1949|0);return}function Wt(){var e=0,t=0,r=0;r=p;e=Zt()|0;pe(e|0,7,1886|0);return}function Kt(){var e=0,t=0,r=0;r=p;e=Xt()|0;pe(e|0,7,1818|0);return}function Xt(){var e=0,t=0,r=0;r=p;e=qt()|0;return e|0}function qt(){var e=0,t=0;t=p;return 8|0}function Zt(){var e=0,t=0,r=0;r=p;e=Yt()|0;return e|0}function Yt(){var e=0,t=0;t=p;return 16|0}function Jt(){var e=0,t=0,r=0;r=p;e=Qt()|0;return e|0}function Qt(){var e=0,t=0;t=p;return 24|0}function $t(){var e=0,t=0,r=0;r=p;e=er()|0;return e|0}function er(){var e=0,t=0;t=p;return 32|0}function tr(){var e=0,t=0,r=0;r=p;e=rr()|0;return e|0}function rr(){var e=0,t=0;t=p;return 40|0}function nr(){var e=0,t=0,r=0;r=p;e=ir()|0;return e|0}function ir(){var e=0,t=0;t=p;return 48|0}function ar(){var e=0,t=0,r=0;r=p;e=or()|0;return e|0}function or(){var e=0,t=0;t=p;return 56|0}function sr(){var e=0,t=0,r=0;r=p;e=lr()|0;return e|0}function lr(){var e=0,t=0;t=p;return 64|0}function cr(){var e=0,t=0,r=0;r=p;e=ur()|0;return e|0}function ur(){var e=0,t=0;t=p;return 72|0}function dr(){var e=0,t=0,r=0;r=p;e=hr()|0;return e|0}function hr(){var e=0,t=0;t=p;return 80|0}function fr(){var e=0,t=0,r=0;r=p;e=pr()|0;return e|0}function pr(){var e=0,t=0;t=p;return 88|0}function mr(){var e=0,t=0,r=0;r=p;e=vr()|0;return e|0}function vr(){var e=0,t=0;t=p;return 96|0}function gr(){var e=0,t=0;t=p;return 104|0}function yr(){var e=0,t=0;t=p;return 112|0}function br(){var e=0,t=0;t=p;return 144|0}function _r(){var e=0,t=0;t=p;return 168|0}function Er(){var e=0,t=0,r=0;r=p;e=Ar()|0;return e|0}function Ar(){var e=0,t=0;t=p;return 360|0}function wr(){var e=0,t=0,r=0;r=p;e=Tr()|0;return e|0}function Tr(){var e=0,t=0;t=p;return 352|0}function kr(){var e=0,t=0,r=0;r=p;e=Rr()|0;return e|0}function Rr(){var e=0,t=0;t=p;return 344|0}function xr(){var e=0,t=0,r=0;r=p;e=Cr()|0;return e|0}function Cr(){var e=0,t=0;t=p;return 336|0}function Sr(){var e=0,t=0,r=0;r=p;e=Mr()|0;return e|0}function Mr(){var e=0,t=0;t=p;return 328|0}function Ir(){var e=0,t=0,r=0;r=p;e=Dr()|0;return e|0}function Dr(){var e=0,t=0;t=p;return 320|0}function Nr(){var e=0,t=0,r=0;r=p;e=jr()|0;return e|0}function jr(){var e=0,t=0;t=p;return 312|0}function Hr(){var e=0,t=0,r=0;r=p;e=Or()|0;return e|0}function Or(){var e=0,t=0;t=p;return 304|0}function Pr(){var e=0,t=0,r=0;r=p;e=Lr()|0;return e|0}function Lr(){var e=0,t=0;t=p;return 288|0}function Fr(){var e=0,t=0,r=0;r=p;e=Vr()|0;return e|0}function Vr(){var e=0,t=0;t=p;return 296|0}function Br(){var e=0,t=0,r=0;r=p;e=Ur()|0;return e|0}function Ur(){var e=0,t=0;t=p;return 280|0}function zr(){var e=0,t=0;t=p;return 272|0}function Gr(){var e=0,t=0;t=p;return 264|0}function Wr(e){e=e|0;var t=0,r=0,n=0,i=0,o=0;o=p;t=e+4|0;r=a[t>>2]|0;n=Yr(r)|0;return n|0}function Kr(e){e=e|0;var t=0,r=0,n=0,i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0;var w=0,T=0,k=0,R=0,x=0,C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0;var z=0,G=0,W=0,K=0,X=0,q=0,Z=0,Y=0,J=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0;var ce=0,ue=0,de=0,he=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,be=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,xe=0,Ce=0;var Se=0,Me=0,Ie=0,De=0,Ne=0,je=0,He=0,Oe=0,Pe=0,Le=0,Fe=0,Ve=0,Be=0,Ue=0,ze=0,Ge=0,We=0,Ke=0,Xe=0,qe=0;var Ze=0,Ye=0,Je=0,Qe=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,ut=0,dt=0,ht=0,ft=0,pt=0;var mt=0,vt=0,gt=0,yt=0,bt=0,_t=0,Et=0,At=0,wt=0,Tt=0,kt=0,Rt=0,xt=0,Ct=0,St=0,Mt=0,It=0,Dt=0,Nt=0,jt=0;var Ht=0,Ot=0,Pt=0,Lt=0,Ft=0,Vt=0,Bt=0,Ut=0,zt=0,Gt=0,Wt=0,Kt=0,Xt=0,qt=0,Zt=0,Yt=0,Jt=0,Qt=0,$t=0,er=0;var tr=0,rr=0,nr=0,ir=0,ar=0,or=0,sr=0,lr=0,cr=0,ur=0,dr=0,hr=0,fr=0,pr=0,mr=0,vr=0,gr=0,yr=0,br=0,_r=0;var Er=0,Ar=0,wr=0,Tr=0,kr=0,Rr=0,xr=0,Cr=0,Sr=0,Mr=0,Ir=0,Dr=0,Nr=0,jr=0,Hr=0,Or=0,Pr=0,Lr=0,Fr=0,Vr=0;var Br=0,Ur=0,zr=0,Gr=0,Wr=0,Kr=0,Xr=0,Zr=0,Yr=0,Jr=0,Qr=0,$r=0,en=0,tn=0,rn=0,nn=0,an=0,on=0,sn=0,ln=0;var cn=0,un=0,dn=0,hn=0,fn=0,pn=0,mn=0,vn=0,gn=0,yn=0,bn=0,_n=0,En=0,An=0,wn=0,Tn=0,kn=0,Rn=0,xn=0,Cn=0;var Mn=0,In=0,Dn=0,Nn=0,jn=0,Hn=0,On=0,Pn=0,Ln=0,Fn=0,Vn=0,Bn=0,Un=0,zn=0,Gn=0,Wn=0,Kn=0,Xn=0,qn=0,Zn=0;var Yn=0,Jn=0,Qn=0,$n=0,ei=0,ti=0,ri=0,ni=0,ii=0,ai=0,oi=0,si=0,li=0,ci=0,ui=0,di=0,hi=0,fi=0,pi=0,mi=0;var vi=0,gi=0,yi=0,bi=0,_i=0,Ei=0,Ai=0,wi=0,Ti=0,ki=0,Ri=0,xi=0,Ci=0,Si=0,Mi=0,Ii=0,Di=0,Ni=0,ji=0,Hi=0;var Oi=0,Pi=0,Li=0,Fi=0,Vi=0,Bi=0,Ui=0,zi=0,Gi=0,Wi=0,Ki=0,Xi=0,qi=0,Zi=0,Yi=0,Ji=0,Qi=0,$i=0,ea=0,ta=0;var ra=0,na=0,ia=0,aa=0,oa=0,sa=0,la=0,ca=0,ua=0,da=0,ha=0,fa=0,pa=0,ma=0,va=0,ga=0,ya=0,ba=0,_a=0,Ea=0;var Aa=0,wa=0,Ta=0,ka=0,Ra=0,xa=0,Ca=0,Sa=0,Ma=0,Ia=0,Da=0,Na=0,ja=0,Ha=0,Oa=0,Pa=0,La=0,Fa=0,Va=0,Ba=0;var Ua=0,za=0,Ga=0,Wa=0,Ka=0,Xa=0,qa=0,Za=0,Ya=0,Ja=0,Qa=0,$a=0,eo=0,to=0,ro=0,no=0,io=0,ao=0,oo=0,so=0;var lo=0,co=0,uo=0,ho=0,fo=0,po=0,mo=0,vo=0,go=0,yo=0,bo=0,_o=0,Eo=0,Ao=0,wo=0,To=0,ko=0,Ro=0,xo=0,Co=0;var So=0,Mo=0,Io=0,Do=0,No=0,jo=0,Ho=0,Oo=0,Po=0,Lo=0,Fo=0,Vo=0,Bo=0,Uo=0,zo=0,Go=0,Wo=0,Ko=0,Xo=0,qo=0;var Zo=0,Yo=0,Jo=0,Qo=0,$o=0,es=0,ts=0,rs=0,ns=0,is=0,as=0,os=0,ss=0,ls=0,cs=0,us=0,ds=0,hs=0,fs=0,ps=0;var ms=0,vs=0,gs=0,ys=0,bs=0,_s=0,Es=0,As=0,ws=0,Ts=0,ks=0,Rs=0,xs=0,Cs=0,Ss=0,Ms=0,Is=0,Ds=0,Ns=0,js=0;var Hs=0,Os=0,Ps=0,Ls=0,Fs=0,Vs=0,Bs=0,Us=0,zs=0,Gs=0,Ws=0,Ks=0,Xs=0,qs=0,Zs=0,Ys=0,Js=0,Qs=0,$s=0,el=0;var tl=0,rl=0,nl=0,il=0,al=0,ol=0,sl=0,ll=0,cl=0,ul=0,dl=0,hl=0,fl=0,pl=0,ml=0,vl=0,gl=0,yl=0,bl=0,_l=0;var El=0,Al=0,wl=0,Tl=0,kl=0,Rl=0,xl=0,Cl=0,Sl=0,Ml=0,Il=0,Dl=0,Nl=0,jl=0,Hl=0,Ol=0,Pl=0,Ll=0,Fl=0,Vl=0;var Bl=0,Ul=0,zl=0,Gl=0,Wl=0,Kl=0,Xl=0,ql=0,Zl=0,Yl=0,Jl=0,Ql=0,$l=0,ec=0,tc=0,rc=0,nc=0,ic=0,ac=0,oc=0;var sc=0,lc=0,cc=0,uc=0,dc=0,hc=0,fc=0,pc=0,mc=0,vc=0,gc=0,yc=0,bc=0,_c=0,Ec=0,Ac=0,wc=0,Tc=0,kc=0,Rc=0;var xc=0,Cc=0,Sc=0,Mc=0,Ic=0,Dc=0,Nc=0,jc=0,Hc=0,Oc=0,Pc=0,Lc=0,Fc=0,Vc=0,Bc=0,Uc=0,zc=0,Gc=0,Wc=0,Kc=0;var Xc=0,qc=0,Zc=0,Yc=0,Jc=0,Qc=0,$c=0,eu=0,tu=0,ru=0,nu=0,iu=0,au=0,ou=0,su=0,lu=0,cu=0,uu=0,du=0,hu=0;var fu=0,pu=0,mu=0,vu=0,gu=0,yu=0,bu=0,_u=0,Eu=0,Au=0,wu=0,Tu=0,ku=0,Ru=0,xu=0,Cu=0,Su=0,Mu=0,Iu=0,Du=0;var Nu=0,ju=0,Hu=0,Ou=0,Pu=0,Lu=0,Fu=0,Vu=0,Bu=0,Uu=0,zu=0,Gu=0,Wu=0,Ku=0,Xu=0,qu=0,Zu=0,Yu=0,Ju=0,Qu=0;var $u=0,ed=0,td=0,rd=0,nd=0,id=0,ad=0,od=0,sd=0,ld=0,cd=0,ud=0,dd=0,hd=0,fd=0,pd=0,md=0,vd=0,gd=0,yd=0;var bd=0,_d=0,Ed=0,Ad=0,wd=0,Td=0,kd=0,Rd=0,xd=0,Cd=0,Sd=0,Md=0,Id=0,Dd=0,Nd=0,jd=0,Hd=0,Od=0,Pd=0,Ld=0;var Fd=0,Vd=0,Bd=0,Ud=0,zd=0,Gd=0,Wd=0,Kd=0,Xd=0,qd=0,Zd=0,Yd=0,Jd=0,Qd=0,$d=0,eh=0,th=0,rh=0,nh=0,ih=0;var ah=0,oh=0,sh=0,lh=0,ch=0,uh=0,dh=0,hh=0,fh=0,ph=0,mh=0,vh=0,gh=0,yh=0,bh=0,_h=0,Eh=0,Ah=0,wh=0,Th=0;var kh=0,Rh=0,xh=0,Ch=0,Sh=0,Mh=0,Ih=0,Dh=0,Nh=0,jh=0,Hh=0,Oh=0,Ph=0,Lh=0,Fh=0,Vh=0,Bh=0,Uh=0,zh=0,Gh=0;var Wh=0,Kh=0,Xh=0,qh=0,Zh=0,Yh=0,Jh=0,Qh=0,$h=0,ef=0,tf=0,rf=0,nf=0,af=0,of=0,sf=0,lf=0,cf=0,uf=0,df=0;var hf=0,ff=0,pf=0,mf=0,vf=0,gf=0,yf=0,bf=0,_f=0,Ef=0,Af=0,wf=0,Tf=0,kf=0,Rf=0,xf=0,Cf=0,Sf=0,Mf=0,If=0;var Df=0,Nf=0,jf=0,Hf=0,Of=0,Pf=0,Lf=0,Ff=0,Vf=0,Bf=0,Uf=0,zf=0,Gf=0,Wf=0,Kf=0,Xf=0,qf=0,Zf=0,Yf=0,Jf=0;var Qf=0,$f=0,ep=0,tp=0,rp=0,np=0,ip=0,ap=0,op=0,sp=0,lp=0,cp=0,up=0,dp=0,hp=0,fp=0,pp=0,mp=0,vp=0,gp=0;var yp=0,bp=0,_p=0,Ep=0,Ap=0,wp=0,Tp=0,kp=0,Rp=0,xp=0,Cp=0,Sp=0,Mp=0,Ip=0,Dp=0,Np=0,jp=0,Hp=0,Op=0,Pp=0;var Lp=0,Fp=0,Vp=0,Bp=0,Up=0,zp=0,Gp=0,Wp=0,Kp=0,Xp=0,qp=0,Zp=0,Yp=0,Jp=0,Qp=0,$p=0,em=0,tm=0,rm=0,nm=0;var im=0,am=0,om=0,sm=0,lm=0,cm=0,um=0,dm=0,hm=0,fm=0,pm=0,mm=0,vm=0,gm=0,ym=0,bm=0,_m=0,Em=0,Am=0,wm=0;var Tm=0,km=0,Rm=0,xm=0,Cm=0,Sm=0,Mm=0,Im=0,Dm=0,Nm=0,jm=0,Hm=0,Om=0,Pm=0,Lm=0,Fm=0,Vm=0,Bm=0,Um=0,zm=0;var Gm=0,Wm=0,Km=0,Xm=0,qm=0,Zm=0,Ym=0,Jm=0,Qm=0,$m=0,ev=0,tv=0,rv=0,nv=0,iv=0,av=0,ov=0,sv=0,lv=0,cv=0;var uv=0,dv=0,hv=0,fv=0,pv=0,mv=0,vv=0,gv=0,yv=0,bv=0,_v=0,Ev=0,Av=0,wv=0,Tv=0,kv=0,Rv=0,xv=0,Cv=0,Sv=0;var Mv=0,Iv=0,Dv=0,Nv=0,jv=0,Hv=0,Ov=0,Pv=0,Lv=0,Fv=0,Vv=0,Bv=0,Uv=0,zv=0,Gv=0,Wv=0,Kv=0,Xv=0,qv=0,Zv=0;var Yv=0,Jv=0,Qv=0,$v=0,eg=0,tg=0,rg=0,ng=0,ig=0,ag=0,og=0,sg=0,lg=0,cg=0,ug=0,dg=0,hg=0,fg=0,pg=0,mg=0;var vg=0,gg=0,yg=0,bg=0,_g=0,Eg=0,Ag=0,wg=0,Tg=0,kg=0,Rg=0,xg=0,Cg=0,Sg=0,Mg=0,Ig=0,Dg=0,Ng=0,jg=0,Hg=0;var Og=0,Pg=0,Lg=0,Fg=0,Vg=0,Bg=0,Ug=0,zg=0,Gg=0,Wg=0,Kg=0,Xg=0,qg=0,Zg=0,Yg=0,Jg=0,Qg=0,$g=0,ey=0,ty=0;var ry=0,ny=0,iy=0,ay=0,oy=0,sy=0,ly=0,cy=0,uy=0,dy=0,hy=0,fy=0,py=0,my=0,vy=0,gy=0,yy=0,by=0,_y=0,Ey=0;var Ay=0,wy=0,Ty=0,ky=0,Ry=0,xy=0,Cy=0,Sy=0,My=0,Iy=0,Dy=0,Ny=0,jy=0,Hy=0,Oy=0,Py=0,Ly=0,Fy=0,Vy=0,By=0;var Uy=0,zy=0,Gy=0,Wy=0,Ky=0,Xy=0,qy=0,Zy=0,Yy=0,Jy=0,Qy=0,$y=0,eb=0,tb=0,rb=0;rb=p;p=p+16|0;Ne=rb;Or=e>>>0<245;do{if(Or){Ui=e>>>0<11;Ko=e+11|0;Zl=Ko&-8;Qu=Ui?16:Zl;tf=Qu>>>3;am=a[740]|0;lg=am>>>tf;je=lg&3;We=(je|0)==0;if(!We){rt=lg&1;ft=rt^1;Tt=ft+tf|0;Ht=Tt<<1;Kt=3000+(Ht<<2)|0;nr=Kt+8|0;pr=a[nr>>2]|0;kr=pr+8|0;Pr=a[kr>>2]|0;Zr=(Pr|0)==(Kt|0);if(Zr){sn=1<<Tt;yn=sn^-1;Mn=am&yn;a[740]=Mn}else{Bn=Pr+12|0;a[Bn>>2]=Kt;a[nr>>2]=Pr}Qn=Tt<<3;ci=Qn|3;_i=pr+4|0;a[_i>>2]=ci;Ii=pr+Qn|0;zi=Ii+4|0;ea=a[zi>>2]|0;da=ea|1;a[zi>>2]=da;s=kr;p=rb;return s|0}Aa=a[2968>>2]|0;Na=Qu>>>0>Aa>>>0;if(Na){Ga=(lg|0)==0;if(!Ga){to=lg<<tf;fo=2<<tf;To=0-fo|0;Ho=fo|To;Xo=to&Ho;is=0-Xo|0;ms=Xo&is;Rs=ms+-1|0;Ps=Rs>>>12;qs=Ps&16;al=Rs>>>qs;vl=al>>>5;xl=vl&8;Ll=xl|qs;Yl=al>>>xl;sc=Yl>>>2;yc=sc&4;Sc=Ll|yc;Vc=Yl>>>yc;Jc=Vc>>>1;lu=Jc&2;bu=Sc|lu;Mu=Vc>>>lu;Bu=Mu>>>1;$u=Bu&1;ud=bu|$u;Ed=Mu>>>$u;Dd=ud+Ed|0;zd=Dd<<1;eh=3000+(zd<<2)|0;dh=eh+8|0;Ah=a[dh>>2]|0;Nh=Ah+8|0;Gh=a[Nh>>2]|0;rf=(Gh|0)==(eh|0);if(rf){pf=1<<Dd;kf=pf^-1;Of=am&kf;a[740]=Of;cg=Of}else{Xf=Gh+12|0;a[Xf>>2]=eh;a[dh>>2]=Gh;cg=am}ip=Dd<<3;mp=ip-Qu|0;Rp=Qu|3;Pp=Ah+4|0;a[Pp>>2]=Rp;qp=Ah+Qu|0;om=mp|1;gm=qp+4|0;a[gm>>2]=om;Cm=Ah+ip|0;a[Cm>>2]=mp;Fm=(Aa|0)==0;if(!Fm){Ym=a[2980>>2]|0;sv=Aa>>>3;yv=sv<<1;Sv=3000+(yv<<2)|0;Vv=1<<sv;Jv=cg&Vv;_g=(Jv|0)==0;if(_g){Ig=cg|Vv;a[740]=Ig;ve=Sv+8|0;y=Sv;Re=ve}else{Ug=Sv+8|0;$g=a[Ug>>2]|0;y=$g;Re=Ug}a[Re>>2]=Ym;uy=y+12|0;a[uy>>2]=Ym;Ey=Ym+8|0;a[Ey>>2]=y;Dy=Ym+12|0;a[Dy>>2]=Sv}a[2968>>2]=mp;a[2980>>2]=qp;s=Nh;p=rb;return s|0}Hy=a[2964>>2]|0;Oy=(Hy|0)==0;if(Oy){g=Qu}else{He=0-Hy|0;Oe=Hy&He;Pe=Oe+-1|0;Le=Pe>>>12;Fe=Le&16;Ve=Pe>>>Fe;Be=Ve>>>5;Ue=Be&8;ze=Ue|Fe;Ge=Ve>>>Ue;Ke=Ge>>>2;Xe=Ke&4;qe=ze|Xe;Ze=Ge>>>Xe;Ye=Ze>>>1;Je=Ye&2;Qe=qe|Je;$e=Ze>>>Je;et=$e>>>1;tt=et&1;nt=Qe|tt;it=$e>>>tt;at=nt+it|0;ot=3264+(at<<2)|0;st=a[ot>>2]|0;lt=st+4|0;ct=a[lt>>2]|0;ut=ct&-8;dt=ut-Qu|0;ht=st+16|0;pt=a[ht>>2]|0;mt=(pt|0)==(0|0);Se=mt&1;vt=(st+16|0)+(Se<<2)|0;gt=a[vt>>2]|0;yt=(gt|0)==(0|0);if(yt){h=st;m=dt}else{f=st;v=dt;_t=gt;while(1){bt=_t+4|0;Et=a[bt>>2]|0;At=Et&-8;wt=At-Qu|0;kt=wt>>>0<v>>>0;r=kt?wt:v;t=kt?_t:f;Rt=_t+16|0;xt=a[Rt>>2]|0;Ct=(xt|0)==(0|0);xe=Ct&1;St=(_t+16|0)+(xe<<2)|0;Mt=a[St>>2]|0;It=(Mt|0)==(0|0);if(It){h=t;m=r;break}else{f=t;v=r;_t=Mt}}}Dt=h+Qu|0;Nt=Dt>>>0>h>>>0;if(Nt){jt=h+24|0;Ot=a[jt>>2]|0;Pt=h+12|0;Lt=a[Pt>>2]|0;Ft=(Lt|0)==(h|0);do{if(Ft){Gt=h+20|0;Wt=a[Gt>>2]|0;Xt=(Wt|0)==(0|0);if(Xt){qt=h+16|0;Zt=a[qt>>2]|0;Yt=(Zt|0)==(0|0);if(Yt){ee=0;break}else{V=Zt;B=qt}}else{V=Wt;B=Gt}while(1){Jt=V+20|0;Qt=a[Jt>>2]|0;$t=(Qt|0)==(0|0);if(!$t){V=Qt;B=Jt;continue}er=V+16|0;tr=a[er>>2]|0;rr=(tr|0)==(0|0);if(rr){break}else{V=tr;B=er}}a[B>>2]=0;ee=V}else{Vt=h+8|0;Bt=a[Vt>>2]|0;Ut=Bt+12|0;a[Ut>>2]=Lt;zt=Lt+8|0;a[zt>>2]=Bt;ee=Lt}}while(0);ir=(Ot|0)==(0|0);do{if(!ir){ar=h+28|0;or=a[ar>>2]|0;sr=3264+(or<<2)|0;lr=a[sr>>2]|0;cr=(h|0)==(lr|0);if(cr){a[sr>>2]=ee;Py=(ee|0)==(0|0);if(Py){ur=1<<or;dr=ur^-1;hr=Hy&dr;a[2964>>2]=hr;break}}else{fr=Ot+16|0;mr=a[fr>>2]|0;vr=(mr|0)!=(h|0);Me=vr&1;gr=(Ot+16|0)+(Me<<2)|0;a[gr>>2]=ee;yr=(ee|0)==(0|0);if(yr){break}}br=ee+24|0;a[br>>2]=Ot;_r=h+16|0;Er=a[_r>>2]|0;Ar=(Er|0)==(0|0);if(!Ar){wr=ee+16|0;a[wr>>2]=Er;Tr=Er+24|0;a[Tr>>2]=ee}Rr=h+20|0;xr=a[Rr>>2]|0;Cr=(xr|0)==(0|0);if(!Cr){Sr=ee+20|0;a[Sr>>2]=xr;Mr=xr+24|0;a[Mr>>2]=ee}}}while(0);Ir=m>>>0<16;if(Ir){Dr=m+Qu|0;Nr=Dr|3;jr=h+4|0;a[jr>>2]=Nr;Hr=h+Dr|0;Lr=Hr+4|0;Fr=a[Lr>>2]|0;Vr=Fr|1;a[Lr>>2]=Vr}else{Br=Qu|3;Ur=h+4|0;a[Ur>>2]=Br;zr=m|1;Gr=Dt+4|0;a[Gr>>2]=zr;Wr=Dt+m|0;a[Wr>>2]=m;Kr=(Aa|0)==0;if(!Kr){Xr=a[2980>>2]|0;Yr=Aa>>>3;Jr=Yr<<1;Qr=3000+(Jr<<2)|0;$r=1<<Yr;en=am&$r;tn=(en|0)==0;if(tn){rn=am|$r;a[740]=rn;ge=Qr+8|0;l=Qr;ke=ge}else{nn=Qr+8|0;an=a[nn>>2]|0;l=an;ke=nn}a[ke>>2]=Xr;on=l+12|0;a[on>>2]=Xr;ln=Xr+8|0;a[ln>>2]=l;cn=Xr+12|0;a[cn>>2]=Qr}a[2968>>2]=m;a[2980>>2]=Dt}un=h+8|0;s=un;p=rb;return s|0}else{g=Qu}}}else{g=Qu}}else{dn=e>>>0>4294967231;if(dn){g=-1}else{hn=e+11|0;fn=hn&-8;pn=a[2964>>2]|0;mn=(pn|0)==0;if(mn){g=fn}else{vn=0-fn|0;gn=hn>>>8;bn=(gn|0)==0;if(bn){j=0}else{_n=fn>>>0>16777215;if(_n){j=31}else{En=gn+1048320|0;An=En>>>16;wn=An&8;Tn=gn<<wn;kn=Tn+520192|0;Rn=kn>>>16;xn=Rn&4;Cn=xn|wn;In=Tn<<xn;Dn=In+245760|0;Nn=Dn>>>16;jn=Nn&2;Hn=Cn|jn;On=14-Hn|0;Pn=In<<jn;Ln=Pn>>>15;Fn=On+Ln|0;Vn=Fn<<1;Un=Fn+7|0;zn=fn>>>Un;Gn=zn&1;Wn=Gn|Vn;j=Wn}}Kn=3264+(j<<2)|0;Xn=a[Kn>>2]|0;qn=(Xn|0)==(0|0);e:do{if(qn){$=0;re=0;ne=vn;tb=57}else{Zn=(j|0)==31;Yn=j>>>1;Jn=25-Yn|0;$n=Zn?0:Jn;ei=fn<<$n;S=0;D=vn;N=Xn;O=ei;L=0;while(1){ti=N+4|0;ri=a[ti>>2]|0;ni=ri&-8;ii=ni-fn|0;ai=ii>>>0<D>>>0;if(ai){oi=(ii|0)==0;if(oi){ce=0;he=N;fe=N;tb=61;break e}else{W=N;K=ii}}else{W=S;K=D}si=N+20|0;li=a[si>>2]|0;ui=O>>>31;di=(N+16|0)+(ui<<2)|0;hi=a[di>>2]|0;fi=(li|0)==(0|0);pi=(li|0)==(hi|0);Wy=fi|pi;X=Wy?L:li;mi=(hi|0)==(0|0);By=mi^1;vi=By&1;H=O<<vi;if(mi){$=X;re=W;ne=K;tb=57;break}else{S=W;D=K;N=hi;O=H;L=X}}}}while(0);if((tb|0)==57){gi=($|0)==(0|0);yi=(re|0)==(0|0);zy=gi&yi;if(zy){bi=2<<j;Ei=0-bi|0;Ai=bi|Ei;wi=pn&Ai;Ti=(wi|0)==0;if(Ti){g=fn;break}ki=0-wi|0;Ri=wi&ki;xi=Ri+-1|0;Ci=xi>>>12;Si=Ci&16;Mi=xi>>>Si;Di=Mi>>>5;Ni=Di&8;ji=Ni|Si;Hi=Mi>>>Ni;Oi=Hi>>>2;Pi=Oi&4;Li=ji|Pi;Fi=Hi>>>Pi;Vi=Fi>>>1;Bi=Vi&2;Gi=Li|Bi;Wi=Fi>>>Bi;Ki=Wi>>>1;Xi=Ki&1;qi=Gi|Xi;Zi=Wi>>>Xi;Yi=qi+Zi|0;Ji=3264+(Yi<<2)|0;Qi=a[Ji>>2]|0;oe=0;de=Qi}else{oe=re;de=$}$i=(de|0)==(0|0);if($i){ae=oe;le=ne}else{ce=ne;he=de;fe=oe;tb=61}}if((tb|0)==61){while(1){tb=0;ta=he+4|0;ra=a[ta>>2]|0;na=ra&-8;ia=na-fn|0;aa=ia>>>0<ce>>>0;i=aa?ia:ce;ue=aa?he:fe;oa=he+16|0;sa=a[oa>>2]|0;la=(sa|0)==(0|0);Ie=la&1;ca=(he+16|0)+(Ie<<2)|0;ua=a[ca>>2]|0;ha=(ua|0)==(0|0);if(ha){ae=ue;le=i;break}else{ce=i;he=ua;fe=ue;tb=61}}}fa=(ae|0)==(0|0);if(fa){g=fn}else{pa=a[2968>>2]|0;ma=pa-fn|0;va=le>>>0<ma>>>0;if(va){ga=ae+fn|0;ya=ga>>>0>ae>>>0;if(!ya){s=0;p=rb;return s|0}ba=ae+24|0;_a=a[ba>>2]|0;Ea=ae+12|0;wa=a[Ea>>2]|0;Ta=(wa|0)==(ae|0);do{if(Ta){Sa=ae+20|0;Ma=a[Sa>>2]|0;Ia=(Ma|0)==(0|0);if(Ia){Da=ae+16|0;ja=a[Da>>2]|0;Ha=(ja|0)==(0|0);if(Ha){ie=0;break}else{q=ja;Z=Da}}else{q=Ma;Z=Sa}while(1){Oa=q+20|0;Pa=a[Oa>>2]|0;La=(Pa|0)==(0|0);if(!La){q=Pa;Z=Oa;continue}Fa=q+16|0;Va=a[Fa>>2]|0;Ba=(Va|0)==(0|0);if(Ba){break}else{q=Va;Z=Fa}}a[Z>>2]=0;ie=q}else{ka=ae+8|0;Ra=a[ka>>2]|0;xa=Ra+12|0;a[xa>>2]=wa;Ca=wa+8|0;a[Ca>>2]=Ra;ie=wa}}while(0);Ua=(_a|0)==(0|0);do{if(Ua){Cs=pn}else{za=ae+28|0;Wa=a[za>>2]|0;Ka=3264+(Wa<<2)|0;Xa=a[Ka>>2]|0;qa=(ae|0)==(Xa|0);if(qa){a[Ka>>2]=ie;Fy=(ie|0)==(0|0);if(Fy){Za=1<<Wa;Ya=Za^-1;Ja=pn&Ya;a[2964>>2]=Ja;Cs=Ja;break}}else{Qa=_a+16|0;$a=a[Qa>>2]|0;eo=($a|0)!=(ae|0);De=eo&1;ro=(_a+16|0)+(De<<2)|0;a[ro>>2]=ie;no=(ie|0)==(0|0);if(no){Cs=pn;break}}io=ie+24|0;a[io>>2]=_a;ao=ae+16|0;oo=a[ao>>2]|0;so=(oo|0)==(0|0);if(!so){lo=ie+16|0;a[lo>>2]=oo;co=oo+24|0;a[co>>2]=ie}uo=ae+20|0;ho=a[uo>>2]|0;po=(ho|0)==(0|0);if(po){Cs=pn}else{mo=ie+20|0;a[mo>>2]=ho;vo=ho+24|0;a[vo>>2]=ie;Cs=pn}}}while(0);go=le>>>0<16;do{if(go){yo=le+fn|0;bo=yo|3;_o=ae+4|0;a[_o>>2]=bo;Eo=ae+yo|0;Ao=Eo+4|0;wo=a[Ao>>2]|0;ko=wo|1;a[Ao>>2]=ko}else{Ro=fn|3;xo=ae+4|0;a[xo>>2]=Ro;Co=le|1;So=ga+4|0;a[So>>2]=Co;Mo=ga+le|0;a[Mo>>2]=le;Io=le>>>3;Do=le>>>0<256;if(Do){No=Io<<1;jo=3000+(No<<2)|0;Oo=a[740]|0;Po=1<<Io;Lo=Oo&Po;Fo=(Lo|0)==0;if(Fo){Vo=Oo|Po;a[740]=Vo;Ee=jo+8|0;F=jo;Te=Ee}else{Bo=jo+8|0;Uo=a[Bo>>2]|0;F=Uo;Te=Bo}a[Te>>2]=ga;zo=F+12|0;a[zo>>2]=ga;Go=ga+8|0;a[Go>>2]=F;Wo=ga+12|0;a[Wo>>2]=jo;break}qo=le>>>8;Zo=(qo|0)==0;if(Zo){P=0}else{Yo=le>>>0>16777215;if(Yo){P=31}else{Jo=qo+1048320|0;Qo=Jo>>>16;$o=Qo&8;es=qo<<$o;ts=es+520192|0;rs=ts>>>16;ns=rs&4;as=ns|$o;os=es<<ns;ss=os+245760|0;ls=ss>>>16;cs=ls&2;us=as|cs;ds=14-us|0;hs=os<<cs;fs=hs>>>15;ps=ds+fs|0;vs=ps<<1;gs=ps+7|0;ys=le>>>gs;bs=ys&1;_s=bs|vs;P=_s}}Es=3264+(P<<2)|0;As=ga+28|0;a[As>>2]=P;ws=ga+16|0;Ts=ws+4|0;a[Ts>>2]=0;a[ws>>2]=0;ks=1<<P;xs=Cs&ks;Ss=(xs|0)==0;if(Ss){Ms=Cs|ks;a[2964>>2]=Ms;a[Es>>2]=ga;Is=ga+24|0;a[Is>>2]=Es;Ds=ga+12|0;a[Ds>>2]=ga;Ns=ga+8|0;a[Ns>>2]=ga;break}js=a[Es>>2]|0;Hs=(P|0)==31;Os=P>>>1;Ls=25-Os|0;Fs=Hs?0:Ls;Vs=le<<Fs;M=Vs;I=js;while(1){Bs=I+4|0;Us=a[Bs>>2]|0;zs=Us&-8;Gs=(zs|0)==(le|0);if(Gs){tb=97;break}Ws=M>>>31;Ks=(I+16|0)+(Ws<<2)|0;Xs=M<<1;Zs=a[Ks>>2]|0;Ys=(Zs|0)==(0|0);if(Ys){tb=96;break}else{M=Xs;I=Zs}}if((tb|0)==96){a[Ks>>2]=ga;Js=ga+24|0;a[Js>>2]=I;Qs=ga+12|0;a[Qs>>2]=ga;$s=ga+8|0;a[$s>>2]=ga;break}else if((tb|0)==97){el=I+8|0;tl=a[el>>2]|0;rl=tl+12|0;a[rl>>2]=ga;a[el>>2]=ga;nl=ga+8|0;a[nl>>2]=tl;il=ga+12|0;a[il>>2]=I;ol=ga+24|0;a[ol>>2]=0;break}}}while(0);sl=ae+8|0;s=sl;p=rb;return s|0}else{g=fn}}}}}}while(0);ll=a[2968>>2]|0;cl=ll>>>0<g>>>0;if(!cl){ul=ll-g|0;dl=a[2980>>2]|0;hl=ul>>>0>15;if(hl){fl=dl+g|0;a[2980>>2]=fl;a[2968>>2]=ul;pl=ul|1;ml=fl+4|0;a[ml>>2]=pl;gl=dl+ll|0;a[gl>>2]=ul;yl=g|3;bl=dl+4|0;a[bl>>2]=yl}else{a[2968>>2]=0;a[2980>>2]=0;_l=ll|3;El=dl+4|0;a[El>>2]=_l;Al=dl+ll|0;wl=Al+4|0;Tl=a[wl>>2]|0;kl=Tl|1;a[wl>>2]=kl}Rl=dl+8|0;s=Rl;p=rb;return s|0}Cl=a[2972>>2]|0;Sl=Cl>>>0>g>>>0;if(Sl){Ml=Cl-g|0;a[2972>>2]=Ml;Il=a[2984>>2]|0;Dl=Il+g|0;a[2984>>2]=Dl;Nl=Ml|1;jl=Dl+4|0;a[jl>>2]=Nl;Hl=g|3;Ol=Il+4|0;a[Ol>>2]=Hl;Pl=Il+8|0;s=Pl;p=rb;return s|0}Fl=a[858]|0;Vl=(Fl|0)==0;if(Vl){a[3440>>2]=4096;a[3436>>2]=4096;a[3444>>2]=-1;a[3448>>2]=-1;a[3452>>2]=0;a[3404>>2]=0;Bl=Ne;Ul=Bl&-16;zl=Ul^1431655768;a[858]=zl;Xl=4096}else{_e=a[3440>>2]|0;Xl=_e}Gl=g+48|0;Wl=g+47|0;Kl=Xl+Wl|0;ql=0-Xl|0;Jl=Kl&ql;Ql=Jl>>>0>g>>>0;if(!Ql){s=0;p=rb;return s|0}$l=a[3400>>2]|0;ec=($l|0)==0;if(!ec){tc=a[3392>>2]|0;rc=tc+Jl|0;nc=rc>>>0<=tc>>>0;ic=rc>>>0>$l>>>0;Gy=nc|ic;if(Gy){s=0;p=rb;return s|0}}ac=a[3404>>2]|0;oc=ac&4;lc=(oc|0)==0;e:do{if(lc){cc=a[2984>>2]|0;uc=(cc|0)==(0|0);t:do{if(uc){tb=118}else{d=3408;while(1){dc=a[d>>2]|0;hc=dc>>>0>cc>>>0;if(!hc){fc=d+4|0;pc=a[fc>>2]|0;mc=dc+pc|0;vc=mc>>>0>cc>>>0;if(vc){break}}gc=d+8|0;bc=a[gc>>2]|0;_c=(bc|0)==(0|0);if(_c){tb=118;break t}else{d=bc}}Wc=Kl-Cl|0;Kc=Wc&ql;Xc=Kc>>>0<2147483647;if(Xc){qc=Sn(Kc|0)|0;Zc=a[d>>2]|0;Yc=a[fc>>2]|0;Qc=Zc+Yc|0;$c=(qc|0)==(Qc|0);if($c){eu=(qc|0)==(-1|0);if(eu){Y=Kc}else{pe=Kc;me=qc;tb=135;break e}}else{J=qc;Q=Kc;tb=126}}else{Y=0}}}while(0);do{if((tb|0)==118){Ec=Sn(0)|0;Ac=(Ec|0)==(-1|0);if(Ac){Y=0}else{wc=Ec;Tc=a[3436>>2]|0;kc=Tc+-1|0;Rc=kc&wc;xc=(Rc|0)==0;Cc=kc+wc|0;Mc=0-Tc|0;Ic=Cc&Mc;Dc=Ic-wc|0;Nc=xc?0:Dc;o=Nc+Jl|0;jc=a[3392>>2]|0;Hc=o+jc|0;Oc=o>>>0>g>>>0;Pc=o>>>0<2147483647;Uy=Oc&Pc;if(Uy){Lc=a[3400>>2]|0;Fc=(Lc|0)==0;if(!Fc){Bc=Hc>>>0<=jc>>>0;Uc=Hc>>>0>Lc>>>0;Yy=Bc|Uc;if(Yy){Y=0;break}}zc=Sn(o|0)|0;Gc=(zc|0)==(Ec|0);if(Gc){pe=o;me=Ec;tb=135;break e}else{J=zc;Q=o;tb=126}}else{Y=0}}}}while(0);do{if((tb|0)==126){tu=0-Q|0;ru=(J|0)!=(-1|0);nu=Q>>>0<2147483647;eb=nu&ru;iu=Gl>>>0>Q>>>0;Ky=iu&eb;if(!Ky){mu=(J|0)==(-1|0);if(mu){Y=0;break}else{pe=Q;me=J;tb=135;break e}}au=a[3440>>2]|0;ou=Wl-Q|0;su=ou+au|0;cu=0-au|0;uu=su&cu;du=uu>>>0<2147483647;if(!du){pe=Q;me=J;tb=135;break e}hu=Sn(uu|0)|0;fu=(hu|0)==(-1|0);if(fu){Sn(tu|0)|0;Y=0;break}else{pu=uu+Q|0;pe=pu;me=J;tb=135;break e}}}while(0);vu=a[3404>>2]|0;gu=vu|4;a[3404>>2]=gu;se=Y;tb=133}else{se=0;tb=133}}while(0);if((tb|0)==133){yu=Jl>>>0<2147483647;if(yu){_u=Sn(Jl|0)|0;Eu=Sn(0)|0;Au=(_u|0)!=(-1|0);wu=(Eu|0)!=(-1|0);Qy=Au&wu;Tu=_u>>>0<Eu>>>0;Xy=Tu&Qy;ku=Eu;Ru=_u;xu=ku-Ru|0;Cu=g+40|0;Su=xu>>>0>Cu>>>0;n=Su?xu:se;qy=Xy^1;Iu=(_u|0)==(-1|0);Vy=Su^1;Du=Iu|Vy;Jy=Du|qy;if(!Jy){pe=n;me=_u;tb=135}}}if((tb|0)==135){Nu=a[3392>>2]|0;ju=Nu+pe|0;a[3392>>2]=ju;Hu=a[3396>>2]|0;Ou=ju>>>0>Hu>>>0;if(Ou){a[3396>>2]=ju}Pu=a[2984>>2]|0;Lu=(Pu|0)==(0|0);do{if(Lu){Fu=a[2976>>2]|0;Vu=(Fu|0)==(0|0);Uu=me>>>0<Fu>>>0;Zy=Vu|Uu;if(Zy){a[2976>>2]=me}a[3408>>2]=me;a[3412>>2]=pe;a[3420>>2]=0;zu=a[858]|0;a[2996>>2]=zu;a[2992>>2]=-1;a[3012>>2]=3e3;a[3008>>2]=3e3;a[3020>>2]=3008;a[3016>>2]=3008;a[3028>>2]=3016;a[3024>>2]=3016;a[3036>>2]=3024;a[3032>>2]=3024;a[3044>>2]=3032;a[3040>>2]=3032;a[3052>>2]=3040;a[3048>>2]=3040;a[3060>>2]=3048;a[3056>>2]=3048;a[3068>>2]=3056;a[3064>>2]=3056;a[3076>>2]=3064;a[3072>>2]=3064;a[3084>>2]=3072;a[3080>>2]=3072;a[3092>>2]=3080;a[3088>>2]=3080;a[3100>>2]=3088;a[3096>>2]=3088;a[3108>>2]=3096;a[3104>>2]=3096;a[3116>>2]=3104;a[3112>>2]=3104;a[3124>>2]=3112;a[3120>>2]=3112;a[3132>>2]=3120;a[3128>>2]=3120;a[3140>>2]=3128;a[3136>>2]=3128;a[3148>>2]=3136;a[3144>>2]=3136;a[3156>>2]=3144;a[3152>>2]=3144;a[3164>>2]=3152;a[3160>>2]=3152;a[3172>>2]=3160;a[3168>>2]=3160;a[3180>>2]=3168;a[3176>>2]=3168;a[3188>>2]=3176;a[3184>>2]=3176;a[3196>>2]=3184;a[3192>>2]=3184;a[3204>>2]=3192;a[3200>>2]=3192;a[3212>>2]=3200;a[3208>>2]=3200;a[3220>>2]=3208;a[3216>>2]=3208;a[3228>>2]=3216;a[3224>>2]=3216;a[3236>>2]=3224;a[3232>>2]=3224;a[3244>>2]=3232;a[3240>>2]=3232;a[3252>>2]=3240;a[3248>>2]=3240;a[3260>>2]=3248;a[3256>>2]=3248;Gu=pe+-40|0;Wu=me+8|0;Ku=Wu;Xu=Ku&7;qu=(Xu|0)==0;Zu=0-Ku|0;Yu=Zu&7;Ju=qu?0:Yu;ed=me+Ju|0;td=Gu-Ju|0;a[2984>>2]=ed;a[2972>>2]=td;rd=td|1;nd=ed+4|0;a[nd>>2]=rd;id=me+Gu|0;ad=id+4|0;a[ad>>2]=40;od=a[3448>>2]|0;a[2988>>2]=od}else{w=3408;while(1){sd=a[w>>2]|0;ld=w+4|0;cd=a[ld>>2]|0;dd=sd+cd|0;hd=(me|0)==(dd|0);if(hd){tb=143;break}fd=w+8|0;pd=a[fd>>2]|0;md=(pd|0)==(0|0);if(md){break}else{w=pd}}if((tb|0)==143){vd=w+12|0;gd=a[vd>>2]|0;yd=gd&8;bd=(yd|0)==0;if(bd){_d=sd>>>0<=Pu>>>0;Ad=me>>>0>Pu>>>0;$y=Ad&_d;if($y){wd=cd+pe|0;a[ld>>2]=wd;Td=a[2972>>2]|0;kd=Td+pe|0;Rd=Pu+8|0;xd=Rd;Cd=xd&7;Sd=(Cd|0)==0;Md=0-xd|0;Id=Md&7;Nd=Sd?0:Id;jd=Pu+Nd|0;Hd=kd-Nd|0;a[2984>>2]=jd;a[2972>>2]=Hd;Od=Hd|1;Pd=jd+4|0;a[Pd>>2]=Od;Ld=Pu+kd|0;Fd=Ld+4|0;a[Fd>>2]=40;Vd=a[3448>>2]|0;a[2988>>2]=Vd;break}}}Bd=a[2976>>2]|0;Ud=me>>>0<Bd>>>0;if(Ud){a[2976>>2]=me}Gd=me+pe|0;U=3408;while(1){Wd=a[U>>2]|0;Kd=(Wd|0)==(Gd|0);if(Kd){tb=151;break}Xd=U+8|0;qd=a[Xd>>2]|0;Zd=(qd|0)==(0|0);if(Zd){u=3408;break}else{U=qd}}if((tb|0)==151){Yd=U+12|0;Jd=a[Yd>>2]|0;Qd=Jd&8;$d=(Qd|0)==0;if($d){a[U>>2]=me;th=U+4|0;rh=a[th>>2]|0;nh=rh+pe|0;a[th>>2]=nh;ih=me+8|0;ah=ih;oh=ah&7;sh=(oh|0)==0;lh=0-ah|0;ch=lh&7;uh=sh?0:ch;hh=me+uh|0;fh=Gd+8|0;ph=fh;mh=ph&7;vh=(mh|0)==0;gh=0-ph|0;yh=gh&7;bh=vh?0:yh;_h=Gd+bh|0;Eh=_h;wh=hh;Th=Eh-wh|0;kh=hh+g|0;Rh=Th-g|0;xh=g|3;Ch=hh+4|0;a[Ch>>2]=xh;Sh=(Pu|0)==(_h|0);do{if(Sh){Mh=a[2972>>2]|0;Ih=Mh+Rh|0;a[2972>>2]=Ih;a[2984>>2]=kh;Dh=Ih|1;jh=kh+4|0;a[jh>>2]=Dh}else{Hh=a[2980>>2]|0;Oh=(Hh|0)==(_h|0);if(Oh){Ph=a[2968>>2]|0;Lh=Ph+Rh|0;a[2968>>2]=Lh;a[2980>>2]=kh;Fh=Lh|1;Vh=kh+4|0;a[Vh>>2]=Fh;Bh=kh+Lh|0;a[Bh>>2]=Lh;break}Uh=_h+4|0;zh=a[Uh>>2]|0;Wh=zh&3;Kh=(Wh|0)==1;if(Kh){Xh=zh&-8;qh=zh>>>3;Zh=zh>>>0<256;e:do{if(Zh){Yh=_h+8|0;Jh=a[Yh>>2]|0;Qh=_h+12|0;$h=a[Qh>>2]|0;ef=($h|0)==(Jh|0);if(ef){nf=1<<qh;af=nf^-1;of=a[740]|0;sf=of&af;a[740]=sf;break}else{lf=Jh+12|0;a[lf>>2]=$h;cf=$h+8|0;a[cf>>2]=Jh;break}}else{uf=_h+24|0;df=a[uf>>2]|0;hf=_h+12|0;ff=a[hf>>2]|0;mf=(ff|0)==(_h|0);do{if(mf){_f=_h+16|0;Ef=_f+4|0;Af=a[Ef>>2]|0;wf=(Af|0)==(0|0);if(wf){Tf=a[_f>>2]|0;Rf=(Tf|0)==(0|0);if(Rf){te=0;break}else{z=Tf;G=_f}}else{z=Af;G=Ef}while(1){xf=z+20|0;Cf=a[xf>>2]|0;Sf=(Cf|0)==(0|0);if(!Sf){z=Cf;G=xf;continue}Mf=z+16|0;If=a[Mf>>2]|0;Df=(If|0)==(0|0);if(Df){break}else{z=If;G=Mf}}a[G>>2]=0;te=z}else{vf=_h+8|0;gf=a[vf>>2]|0;yf=gf+12|0;a[yf>>2]=ff;bf=ff+8|0;a[bf>>2]=gf;te=ff}}while(0);Nf=(df|0)==(0|0);if(Nf){break}jf=_h+28|0;Hf=a[jf>>2]|0;Pf=3264+(Hf<<2)|0;Lf=a[Pf>>2]|0;Ff=(Lf|0)==(_h|0);do{if(Ff){a[Pf>>2]=te;Ly=(te|0)==(0|0);if(!Ly){break}Vf=1<<Hf;Bf=Vf^-1;Uf=a[2964>>2]|0;zf=Uf&Bf;a[2964>>2]=zf;break e}else{Gf=df+16|0;Wf=a[Gf>>2]|0;Kf=(Wf|0)!=(_h|0);Ce=Kf&1;qf=(df+16|0)+(Ce<<2)|0;a[qf>>2]=te;Zf=(te|0)==(0|0);if(Zf){break e}}}while(0);Yf=te+24|0;a[Yf>>2]=df;Jf=_h+16|0;Qf=a[Jf>>2]|0;$f=(Qf|0)==(0|0);if(!$f){ep=te+16|0;a[ep>>2]=Qf;tp=Qf+24|0;a[tp>>2]=te}rp=Jf+4|0;np=a[rp>>2]|0;ap=(np|0)==(0|0);if(ap){break}op=te+20|0;a[op>>2]=np;sp=np+24|0;a[sp>>2]=te}}while(0);lp=_h+Xh|0;cp=Xh+Rh|0;c=lp;T=cp}else{c=_h;T=Rh}up=c+4|0;dp=a[up>>2]|0;hp=dp&-2;a[up>>2]=hp;fp=T|1;pp=kh+4|0;a[pp>>2]=fp;vp=kh+T|0;a[vp>>2]=T;gp=T>>>3;yp=T>>>0<256;if(yp){bp=gp<<1;_p=3000+(bp<<2)|0;Ep=a[740]|0;Ap=1<<gp;wp=Ep&Ap;Tp=(wp|0)==0;if(Tp){kp=Ep|Ap;a[740]=kp;be=_p+8|0;x=_p;we=be}else{xp=_p+8|0;Cp=a[xp>>2]|0;x=Cp;we=xp}a[we>>2]=kh;Sp=x+12|0;a[Sp>>2]=kh;Mp=kh+8|0;a[Mp>>2]=x;Ip=kh+12|0;a[Ip>>2]=_p;break}Dp=T>>>8;Np=(Dp|0)==0;do{if(Np){C=0}else{jp=T>>>0>16777215;if(jp){C=31;break}Hp=Dp+1048320|0;Op=Hp>>>16;Lp=Op&8;Fp=Dp<<Lp;Vp=Fp+520192|0;Bp=Vp>>>16;Up=Bp&4;zp=Up|Lp;Gp=Fp<<Up;Wp=Gp+245760|0;Kp=Wp>>>16;Xp=Kp&2;Zp=zp|Xp;Yp=14-Zp|0;Jp=Gp<<Xp;Qp=Jp>>>15;$p=Yp+Qp|0;em=$p<<1;tm=$p+7|0;rm=T>>>tm;nm=rm&1;im=nm|em;C=im}}while(0);sm=3264+(C<<2)|0;lm=kh+28|0;a[lm>>2]=C;cm=kh+16|0;um=cm+4|0;a[um>>2]=0;a[cm>>2]=0;dm=a[2964>>2]|0;hm=1<<C;fm=dm&hm;pm=(fm|0)==0;if(pm){mm=dm|hm;a[2964>>2]=mm;a[sm>>2]=kh;vm=kh+24|0;a[vm>>2]=sm;ym=kh+12|0;a[ym>>2]=kh;bm=kh+8|0;a[bm>>2]=kh;break}_m=a[sm>>2]|0;Em=(C|0)==31;Am=C>>>1;wm=25-Am|0;Tm=Em?0:wm;km=T<<Tm;k=km;R=_m;while(1){Rm=R+4|0;xm=a[Rm>>2]|0;Sm=xm&-8;Mm=(Sm|0)==(T|0);if(Mm){tb=192;break}Im=k>>>31;Dm=(R+16|0)+(Im<<2)|0;Nm=k<<1;jm=a[Dm>>2]|0;Hm=(jm|0)==(0|0);if(Hm){tb=191;break}else{k=Nm;R=jm}}if((tb|0)==191){a[Dm>>2]=kh;Om=kh+24|0;a[Om>>2]=R;Pm=kh+12|0;a[Pm>>2]=kh;Lm=kh+8|0;a[Lm>>2]=kh;break}else if((tb|0)==192){Vm=R+8|0;Bm=a[Vm>>2]|0;Um=Bm+12|0;a[Um>>2]=kh;a[Vm>>2]=kh;zm=kh+8|0;a[zm>>2]=Bm;Gm=kh+12|0;a[Gm>>2]=R;Wm=kh+24|0;a[Wm>>2]=0;break}}}while(0);Ay=hh+8|0;s=Ay;p=rb;return s|0}else{u=3408}}while(1){Km=a[u>>2]|0;Xm=Km>>>0>Pu>>>0;if(!Xm){qm=u+4|0;Zm=a[qm>>2]|0;Jm=Km+Zm|0;Qm=Jm>>>0>Pu>>>0;if(Qm){break}}$m=u+8|0;ev=a[$m>>2]|0;u=ev}tv=Jm+-47|0;rv=tv+8|0;nv=rv;iv=nv&7;av=(iv|0)==0;ov=0-nv|0;lv=ov&7;cv=av?0:lv;uv=tv+cv|0;dv=Pu+16|0;hv=uv>>>0<dv>>>0;fv=hv?Pu:uv;pv=fv+8|0;mv=fv+24|0;vv=pe+-40|0;gv=me+8|0;bv=gv;_v=bv&7;Ev=(_v|0)==0;Av=0-bv|0;wv=Av&7;Tv=Ev?0:wv;kv=me+Tv|0;Rv=vv-Tv|0;a[2984>>2]=kv;a[2972>>2]=Rv;xv=Rv|1;Cv=kv+4|0;a[Cv>>2]=xv;Mv=me+vv|0;Iv=Mv+4|0;a[Iv>>2]=40;Dv=a[3448>>2]|0;a[2988>>2]=Dv;Nv=fv+4|0;a[Nv>>2]=27;a[pv>>2]=a[3408>>2]|0;a[pv+4>>2]=a[3408+4>>2]|0;a[pv+8>>2]=a[3408+8>>2]|0;a[pv+12>>2]=a[3408+12>>2]|0;a[3408>>2]=me;a[3412>>2]=pe;a[3420>>2]=0;a[3416>>2]=pv;Hv=mv;while(1){jv=Hv+4|0;a[jv>>2]=7;Ov=Hv+8|0;Pv=Ov>>>0<Jm>>>0;if(Pv){Hv=jv}else{break}}Lv=(fv|0)==(Pu|0);if(!Lv){Fv=fv;Bv=Pu;Uv=Fv-Bv|0;zv=a[Nv>>2]|0;Gv=zv&-2;a[Nv>>2]=Gv;Wv=Uv|1;Kv=Pu+4|0;a[Kv>>2]=Wv;a[fv>>2]=Uv;Xv=Uv>>>3;qv=Uv>>>0<256;if(qv){Zv=Xv<<1;Yv=3000+(Zv<<2)|0;Qv=a[740]|0;$v=1<<Xv;eg=Qv&$v;tg=(eg|0)==0;if(tg){rg=Qv|$v;a[740]=rg;ye=Yv+8|0;E=Yv;Ae=ye}else{ng=Yv+8|0;ig=a[ng>>2]|0;E=ig;Ae=ng}a[Ae>>2]=Pu;ag=E+12|0;a[ag>>2]=Pu;og=Pu+8|0;a[og>>2]=E;sg=Pu+12|0;a[sg>>2]=Yv;break}ug=Uv>>>8;dg=(ug|0)==0;if(dg){A=0}else{hg=Uv>>>0>16777215;if(hg){A=31}else{fg=ug+1048320|0;pg=fg>>>16;mg=pg&8;vg=ug<<mg;gg=vg+520192|0;yg=gg>>>16;bg=yg&4;Eg=bg|mg;Ag=vg<<bg;wg=Ag+245760|0;Tg=wg>>>16;kg=Tg&2;Rg=Eg|kg;xg=14-Rg|0;Cg=Ag<<kg;Sg=Cg>>>15;Mg=xg+Sg|0;Dg=Mg<<1;Ng=Mg+7|0;jg=Uv>>>Ng;Hg=jg&1;Og=Hg|Dg;A=Og}}Pg=3264+(A<<2)|0;Lg=Pu+28|0;a[Lg>>2]=A;Fg=Pu+20|0;a[Fg>>2]=0;a[dv>>2]=0;Vg=a[2964>>2]|0;Bg=1<<A;zg=Vg&Bg;Gg=(zg|0)==0;if(Gg){Wg=Vg|Bg;a[2964>>2]=Wg;a[Pg>>2]=Pu;Kg=Pu+24|0;a[Kg>>2]=Pg;Xg=Pu+12|0;a[Xg>>2]=Pu;qg=Pu+8|0;a[qg>>2]=Pu;break}Zg=a[Pg>>2]|0;Yg=(A|0)==31;Jg=A>>>1;Qg=25-Jg|0;ey=Yg?0:Qg;ty=Uv<<ey;b=ty;_=Zg;while(1){ry=_+4|0;ny=a[ry>>2]|0;iy=ny&-8;ay=(iy|0)==(Uv|0);if(ay){tb=213;break}oy=b>>>31;sy=(_+16|0)+(oy<<2)|0;ly=b<<1;cy=a[sy>>2]|0;dy=(cy|0)==(0|0);if(dy){tb=212;break}else{b=ly;_=cy}}if((tb|0)==212){a[sy>>2]=Pu;hy=Pu+24|0;a[hy>>2]=_;fy=Pu+12|0;a[fy>>2]=Pu;py=Pu+8|0;a[py>>2]=Pu;break}else if((tb|0)==213){my=_+8|0;vy=a[my>>2]|0;gy=vy+12|0;a[gy>>2]=Pu;a[my>>2]=Pu;yy=Pu+8|0;a[yy>>2]=vy;by=Pu+12|0;a[by>>2]=_;_y=Pu+24|0;a[_y>>2]=0;break}}}}while(0);wy=a[2972>>2]|0;Ty=wy>>>0>g>>>0;if(Ty){ky=wy-g|0;a[2972>>2]=ky;Ry=a[2984>>2]|0;xy=Ry+g|0;a[2984>>2]=xy;Cy=ky|1;Sy=xy+4|0;a[Sy>>2]=Cy;My=g|3;Iy=Ry+4|0;a[Iy>>2]=My;Ny=Ry+8|0;s=Ny;p=rb;return s|0}}jy=qr()|0;a[jy>>2]=12;s=0;p=rb;return s|0}function Xr(e){e=e|0;var t=0,r=0,n=0,i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0;var w=0,T=0,k=0,R=0,x=0,C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0;var z=0,G=0,W=0,K=0,X=0,q=0,Z=0,Y=0,J=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0;var ce=0,ue=0,de=0,he=0,fe=0,pe=0,me=0,ve=0,ge=0,ye=0,be=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,xe=0,Ce=0;var Se=0,Me=0,Ie=0,De=0,Ne=0,je=0,He=0,Oe=0,Pe=0,Le=0,Fe=0,Ve=0,Be=0,Ue=0,ze=0,Ge=0,We=0,Ke=0,Xe=0,qe=0;var Ze=0,Ye=0,Je=0,Qe=0,$e=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,ut=0,dt=0,ht=0,ft=0,pt=0;var mt=0,vt=0,gt=0,yt=0,bt=0,_t=0,Et=0,At=0,wt=0,Tt=0,kt=0,Rt=0,xt=0,Ct=0,St=0,Mt=0,It=0,Dt=0,Nt=0,jt=0;var Ht=0,Ot=0,Pt=0,Lt=0,Ft=0,Vt=0,Bt=0,Ut=0,zt=0,Gt=0,Wt=0,Kt=0,Xt=0,qt=0,Zt=0,Yt=0,Jt=0,Qt=0,$t=0,er=0;var tr=0,rr=0,nr=0,ir=0,ar=0,or=0,sr=0,lr=0,cr=0,ur=0,dr=0,hr=0,fr=0,pr=0,mr=0,vr=0,gr=0,yr=0,br=0,_r=0;var Er=0,Ar=0,wr=0,Tr=0,kr=0,Rr=0,xr=0,Cr=0,Sr=0,Mr=0,Ir=0,Dr=0,Nr=0,jr=0,Hr=0,Or=0,Pr=0,Lr=0,Fr=0,Vr=0;var Br=0,Ur=0,zr=0,Gr=0,Wr=0,Kr=0,Xr=0,qr=0,Zr=0,Yr=0,Jr=0,Qr=0,$r=0,en=0,tn=0,rn=0,nn=0,an=0,on=0,sn=0;var ln=0,cn=0,un=0,dn=0,hn=0,fn=0,pn=0,mn=0,vn=0,gn=0,yn=0,bn=0,_n=0,En=0,An=0,wn=0,Tn=0,kn=0,Rn=0,xn=0;var Cn=0,Sn=0,Mn=0,In=0,Dn=0,Nn=0,jn=0,Hn=0,On=0,Pn=0,Ln=0,Fn=0,Vn=0,Bn=0,Un=0,zn=0,Gn=0,Wn=0,Kn=0,Xn=0;var qn=0,Zn=0,Yn=0,Jn=0,Qn=0,$n=0,ei=0,ti=0,ri=0,ni=0,ii=0,ai=0,oi=0,si=0,li=0,ci=0,ui=0,di=0,hi=0,fi=0;var pi=0,mi=0,vi=0;vi=p;A=(e|0)==(0|0);if(A){return}kt=e+-8|0;zr=a[2976>>2]|0;en=e+-4|0;hn=a[en>>2]|0;wn=hn&-8;jn=kt+wn|0;Wn=hn&1;ri=(Wn|0)==0;do{if(ri){w=a[kt>>2]|0;j=hn&3;W=(j|0)==0;if(W){return}re=0-w|0;fe=kt+re|0;Te=w+wn|0;He=fe>>>0<zr>>>0;if(He){return}Ke=a[2980>>2]|0;nt=(Ke|0)==(fe|0);if(nt){Gn=jn+4|0;Kn=a[Gn>>2]|0;Xn=Kn&3;qn=(Xn|0)==3;if(!qn){l=fe;c=Te;$n=fe;break}a[2968>>2]=Te;Zn=Kn&-2;a[Gn>>2]=Zn;Yn=Te|1;Jn=fe+4|0;a[Jn>>2]=Yn;Qn=fe+Te|0;a[Qn>>2]=Te;return}pt=w>>>3;Rt=w>>>0<256;if(Rt){Pt=fe+8|0;qt=a[Pt>>2]|0;ar=fe+12|0;vr=a[ar>>2]|0;xr=(vr|0)==(qt|0);if(xr){Lr=1<<pt;Vr=Lr^-1;Br=a[740]|0;Ur=Br&Vr;a[740]=Ur;l=fe;c=Te;$n=fe;break}else{Gr=qt+12|0;a[Gr>>2]=vr;Wr=vr+8|0;a[Wr>>2]=qt;l=fe;c=Te;$n=fe;break}}Kr=fe+24|0;Xr=a[Kr>>2]|0;qr=fe+12|0;Zr=a[qr>>2]|0;Yr=(Zr|0)==(fe|0);do{if(Yr){rn=fe+16|0;nn=rn+4|0;an=a[nn>>2]|0;on=(an|0)==(0|0);if(on){sn=a[rn>>2]|0;ln=(sn|0)==(0|0);if(ln){v=0;break}else{u=sn;d=rn}}else{u=an;d=nn}while(1){cn=u+20|0;un=a[cn>>2]|0;dn=(un|0)==(0|0);if(!dn){u=un;d=cn;continue}fn=u+16|0;pn=a[fn>>2]|0;mn=(pn|0)==(0|0);if(mn){break}else{u=pn;d=fn}}a[d>>2]=0;v=u}else{Jr=fe+8|0;Qr=a[Jr>>2]|0;$r=Qr+12|0;a[$r>>2]=Zr;tn=Zr+8|0;a[tn>>2]=Qr;v=Zr}}while(0);vn=(Xr|0)==(0|0);if(vn){l=fe;c=Te;$n=fe}else{gn=fe+28|0;yn=a[gn>>2]|0;bn=3264+(yn<<2)|0;_n=a[bn>>2]|0;En=(_n|0)==(fe|0);if(En){a[bn>>2]=v;fi=(v|0)==(0|0);if(fi){An=1<<yn;Tn=An^-1;kn=a[2964>>2]|0;Rn=kn&Tn;a[2964>>2]=Rn;l=fe;c=Te;$n=fe;break}}else{xn=Xr+16|0;Cn=a[xn>>2]|0;Sn=(Cn|0)!=(fe|0);_=Sn&1;Mn=(Xr+16|0)+(_<<2)|0;a[Mn>>2]=v;In=(v|0)==(0|0);if(In){l=fe;c=Te;$n=fe;break}}Dn=v+24|0;a[Dn>>2]=Xr;Nn=fe+16|0;Hn=a[Nn>>2]|0;On=(Hn|0)==(0|0);if(!On){Pn=v+16|0;a[Pn>>2]=Hn;Ln=Hn+24|0;a[Ln>>2]=v}Fn=Nn+4|0;Vn=a[Fn>>2]|0;Bn=(Vn|0)==(0|0);if(Bn){l=fe;c=Te;$n=fe}else{Un=v+20|0;a[Un>>2]=Vn;zn=Vn+24|0;a[zn>>2]=v;l=fe;c=Te;$n=fe}}}else{l=kt;c=wn;$n=kt}}while(0);ei=$n>>>0<jn>>>0;if(!ei){return}ti=jn+4|0;ni=a[ti>>2]|0;ii=ni&1;ai=(ii|0)==0;if(ai){return}oi=ni&2;si=(oi|0)==0;if(si){li=a[2984>>2]|0;ci=(li|0)==(jn|0);if(ci){ui=a[2972>>2]|0;di=ui+c|0;a[2972>>2]=di;a[2984>>2]=l;hi=di|1;T=l+4|0;a[T>>2]=hi;k=a[2980>>2]|0;R=(l|0)==(k|0);if(!R){return}a[2980>>2]=0;a[2968>>2]=0;return}x=a[2980>>2]|0;C=(x|0)==(jn|0);if(C){S=a[2968>>2]|0;M=S+c|0;a[2968>>2]=M;a[2980>>2]=$n;I=M|1;D=l+4|0;a[D>>2]=I;N=$n+M|0;a[N>>2]=M;return}H=ni&-8;O=H+c|0;P=ni>>>3;L=ni>>>0<256;do{if(L){F=jn+8|0;V=a[F>>2]|0;B=jn+12|0;U=a[B>>2]|0;z=(U|0)==(V|0);if(z){G=1<<P;K=G^-1;X=a[740]|0;q=X&K;a[740]=q;break}else{Z=V+12|0;a[Z>>2]=U;Y=U+8|0;a[Y>>2]=V;break}}else{J=jn+24|0;Q=a[J>>2]|0;$=jn+12|0;ee=a[$>>2]|0;te=(ee|0)==(jn|0);do{if(te){se=jn+16|0;le=se+4|0;ce=a[le>>2]|0;ue=(ce|0)==(0|0);if(ue){de=a[se>>2]|0;he=(de|0)==(0|0);if(he){g=0;break}else{h=de;f=se}}else{h=ce;f=le}while(1){pe=h+20|0;me=a[pe>>2]|0;ve=(me|0)==(0|0);if(!ve){h=me;f=pe;continue}ge=h+16|0;ye=a[ge>>2]|0;be=(ye|0)==(0|0);if(be){break}else{h=ye;f=ge}}a[f>>2]=0;g=h}else{ne=jn+8|0;ie=a[ne>>2]|0;ae=ie+12|0;a[ae>>2]=ee;oe=ee+8|0;a[oe>>2]=ie;g=ee}}while(0);_e=(Q|0)==(0|0);if(!_e){Ee=jn+28|0;Ae=a[Ee>>2]|0;we=3264+(Ae<<2)|0;ke=a[we>>2]|0;Re=(ke|0)==(jn|0);if(Re){a[we>>2]=g;pi=(g|0)==(0|0);if(pi){xe=1<<Ae;Ce=xe^-1;Se=a[2964>>2]|0;Me=Se&Ce;a[2964>>2]=Me;break}}else{Ie=Q+16|0;De=a[Ie>>2]|0;Ne=(De|0)!=(jn|0);E=Ne&1;je=(Q+16|0)+(E<<2)|0;a[je>>2]=g;Oe=(g|0)==(0|0);if(Oe){break}}Pe=g+24|0;a[Pe>>2]=Q;Le=jn+16|0;Fe=a[Le>>2]|0;Ve=(Fe|0)==(0|0);if(!Ve){Be=g+16|0;a[Be>>2]=Fe;Ue=Fe+24|0;a[Ue>>2]=g}ze=Le+4|0;Ge=a[ze>>2]|0;We=(Ge|0)==(0|0);if(!We){Xe=g+20|0;a[Xe>>2]=Ge;qe=Ge+24|0;a[qe>>2]=g}}}}while(0);Ze=O|1;Ye=l+4|0;a[Ye>>2]=Ze;Je=$n+O|0;a[Je>>2]=O;Qe=a[2980>>2]|0;$e=(l|0)==(Qe|0);if($e){a[2968>>2]=O;return}else{m=O}}else{et=ni&-2;a[ti>>2]=et;tt=c|1;rt=l+4|0;a[rt>>2]=tt;it=$n+c|0;a[it>>2]=c;m=c}at=m>>>3;ot=m>>>0<256;if(ot){st=at<<1;lt=3000+(st<<2)|0;ct=a[740]|0;ut=1<<at;dt=ct&ut;ht=(dt|0)==0;if(ht){ft=ct|ut;a[740]=ft;y=lt+8|0;s=lt;b=y}else{mt=lt+8|0;vt=a[mt>>2]|0;s=vt;b=mt}a[b>>2]=l;gt=s+12|0;a[gt>>2]=l;yt=l+8|0;a[yt>>2]=s;bt=l+12|0;a[bt>>2]=lt;return}_t=m>>>8;Et=(_t|0)==0;if(Et){o=0}else{At=m>>>0>16777215;if(At){o=31}else{wt=_t+1048320|0;Tt=wt>>>16;xt=Tt&8;Ct=_t<<xt;St=Ct+520192|0;Mt=St>>>16;It=Mt&4;Dt=It|xt;Nt=Ct<<It;jt=Nt+245760|0;Ht=jt>>>16;Ot=Ht&2;Lt=Dt|Ot;Ft=14-Lt|0;Vt=Nt<<Ot;Bt=Vt>>>15;Ut=Ft+Bt|0;zt=Ut<<1;Gt=Ut+7|0;Wt=m>>>Gt;Kt=Wt&1;Xt=Kt|zt;o=Xt}}Zt=3264+(o<<2)|0;Yt=l+28|0;a[Yt>>2]=o;Jt=l+16|0;Qt=l+20|0;a[Qt>>2]=0;a[Jt>>2]=0;$t=a[2964>>2]|0;er=1<<o;tr=$t&er;rr=(tr|0)==0;do{if(rr){nr=$t|er;a[2964>>2]=nr;a[Zt>>2]=l;ir=l+24|0;a[ir>>2]=Zt;or=l+12|0;a[or>>2]=l;sr=l+8|0;a[sr>>2]=l}else{lr=a[Zt>>2]|0;cr=(o|0)==31;ur=o>>>1;dr=25-ur|0;hr=cr?0:dr;fr=m<<hr;n=fr;i=lr;while(1){pr=i+4|0;mr=a[pr>>2]|0;gr=mr&-8;yr=(gr|0)==(m|0);if(yr){mi=73;break}br=n>>>31;_r=(i+16|0)+(br<<2)|0;Er=n<<1;Ar=a[_r>>2]|0;wr=(Ar|0)==(0|0);if(wr){mi=72;break}else{n=Er;i=Ar}}if((mi|0)==72){a[_r>>2]=l;Tr=l+24|0;a[Tr>>2]=i;kr=l+12|0;a[kr>>2]=l;Rr=l+8|0;a[Rr>>2]=l;break}else if((mi|0)==73){Cr=i+8|0;Sr=a[Cr>>2]|0;Mr=Sr+12|0;a[Mr>>2]=l;a[Cr>>2]=l;Ir=l+8|0;a[Ir>>2]=Sr;Dr=l+12|0;a[Dr>>2]=i;Nr=l+24|0;a[Nr>>2]=0;break}}}while(0);jr=a[2992>>2]|0;Hr=jr+-1|0;a[2992>>2]=Hr;Or=(Hr|0)==0;if(Or){r=3416}else{return}while(1){t=a[r>>2]|0;Pr=(t|0)==(0|0);Fr=t+8|0;if(Pr){break}else{r=Fr}}a[2992>>2]=-1;return}function qr(){var e=0,t=0;t=p;return 3456|0}function Zr(e){e=e|0;var t=0,r=0,i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0;var T=0,k=0,R=0,x=0,C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0;H=p;u=e;A=u&3;x=(A|0)==0;e:do{if(x){r=e;j=4}else{i=e;R=u;while(1){C=n[i>>0]|0;S=C<<24>>24==0;if(S){c=R;break e}M=i+1|0;I=M;D=I&3;N=(D|0)==0;if(N){r=M;j=4;break}else{i=M;R=I}}}}while(0);if((j|0)==4){t=r;while(1){d=a[t>>2]|0;h=d+-16843009|0;f=d&-2139062144;m=f^-2139062144;v=m&h;g=(v|0)==0;y=t+4|0;if(g){t=y}else{break}}b=d&255;_=b<<24>>24==0;if(_){o=t}else{s=t;while(1){E=s+1|0;l=n[E>>0]|0;w=l<<24>>24==0;if(w){o=E;break}else{s=E}}}T=o;c=T}k=c-u|0;return k|0}function Yr(e){e=e|0;var t=0,r=0,n=0,i=0,a=0,o=0,s=0;s=p;r=Zr(e)|0;n=r+1|0;i=Kr(n)|0;a=(i|0)==(0|0);if(a){t=0}else{xn(i|0,e|0,n|0)|0;t=i}return t|0}function Jr(e){e=e|0;var t=0,r=0;r=p;return}function Qr(e){e=e|0;var t=0,r=0;r=p;Jr(e);mn(e);return}function $r(e){e=e|0;var t=0,r=0;r=p;return}function en(e){e=e|0;var t=0,r=0;r=p;return}function tn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0;var k=0,R=0,x=0,C=0;x=p;p=p+64|0;y=x;b=on(e,t,0)|0;if(b){i=1}else{_=(t|0)==(0|0);if(_){i=0}else{E=un(t,208,192,0)|0;A=(E|0)==(0|0);if(A){i=0}else{w=y+4|0;k=w;C=k+52|0;do{a[k>>2]=0|0;k=k+4|0}while((k|0)<(C|0));a[y>>2]=E;T=y+8|0;a[T>>2]=e;o=y+12|0;a[o>>2]=-1;s=y+48|0;a[s>>2]=1;l=a[E>>2]|0;c=l+28|0;u=a[c>>2]|0;d=a[r>>2]|0;qn[u&3](E,y,d,1);h=y+24|0;f=a[h>>2]|0;m=(f|0)==1;if(m){v=y+16|0;g=a[v>>2]|0;a[r>>2]=g;n=1}else{n=0}i=n}}}p=x;return i|0}function rn(e,t,r,n,i,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0;d=p;s=t+8|0;l=a[s>>2]|0;c=on(e,l,o)|0;if(c){cn(0,t,r,n,i)}return}function nn(e,t,r,i,o){e=e|0;t=t|0;r=r|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0;var C=0,S=0,M=0,I=0,D=0,N=0,j=0;j=p;C=t+8|0;S=a[C>>2]|0;M=on(e,S,o)|0;do{if(M){ln(0,t,r,i)}else{I=a[t>>2]|0;D=on(e,I,o)|0;if(D){s=t+16|0;l=a[s>>2]|0;c=(l|0)==(r|0);if(!c){u=t+20|0;d=a[u>>2]|0;h=(d|0)==(r|0);if(!h){v=t+32|0;a[v>>2]=i;a[u>>2]=r;g=t+40|0;y=a[g>>2]|0;b=y+1|0;a[g>>2]=b;_=t+36|0;E=a[_>>2]|0;A=(E|0)==1;if(A){w=t+24|0;T=a[w>>2]|0;k=(T|0)==2;if(k){R=t+54|0;n[R>>0]=1}}x=t+44|0;a[x>>2]=4;break}}f=(i|0)==1;if(f){m=t+32|0;a[m>>2]=1}}}}while(0);return}function an(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,s=0,l=0,c=0;c=p;i=t+8|0;o=a[i>>2]|0;s=on(e,o,0)|0;if(s){sn(0,t,r,n)}return}function on(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=p;n=(e|0)==(t|0);return n|0}function sn(e,t,r,i){e=e|0;t=t|0;r=r|0;i=i|0;var o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0;A=p;m=t+16|0;v=a[m>>2]|0;g=(v|0)==(0|0);do{if(g){a[m>>2]=r;y=t+24|0;a[y>>2]=i;b=t+36|0;a[b>>2]=1}else{_=(v|0)==(r|0);if(!_){c=t+36|0;u=a[c>>2]|0;d=u+1|0;a[c>>2]=d;h=t+24|0;a[h>>2]=2;f=t+54|0;n[f>>0]=1;break}o=t+24|0;s=a[o>>2]|0;l=(s|0)==2;if(l){a[o>>2]=i}}}while(0);return}function ln(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0;h=p;i=t+4|0;o=a[i>>2]|0;s=(o|0)==(r|0);if(s){l=t+28|0;c=a[l>>2]|0;u=(c|0)==1;if(!u){a[l>>2]=n}}return}function cn(e,t,r,i,o){e=e|0;t=t|0;r=r|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0;var C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0;V=p;D=t+53|0;n[D>>0]=1;N=t+4|0;j=a[N>>2]|0;H=(j|0)==(i|0);do{if(H){O=t+52|0;n[O>>0]=1;s=t+16|0;l=a[s>>2]|0;c=(l|0)==(0|0);if(c){a[s>>2]=r;u=t+24|0;a[u>>2]=o;d=t+36|0;a[d>>2]=1;h=t+48|0;f=a[h>>2]|0;m=(f|0)==1;v=(o|0)==1;P=m&v;if(!P){break}g=t+54|0;n[g>>0]=1;break}y=(l|0)==(r|0);if(!y){C=t+36|0;S=a[C>>2]|0;M=S+1|0;a[C>>2]=M;I=t+54|0;n[I>>0]=1;break}b=t+24|0;_=a[b>>2]|0;E=(_|0)==2;if(E){a[b>>2]=o;k=o}else{k=_}A=t+48|0;w=a[A>>2]|0;T=(w|0)==1;R=(k|0)==1;L=T&R;if(L){x=t+54|0;n[x>>0]=1}}}while(0);return}function un(e,t,r,o){e=e|0;t=t|0;r=r|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0;var C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0,z=0,G=0,W=0,K=0,X=0;var q=0,Z=0,Y=0,J=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0;se=p;p=p+64|0;B=se;Y=a[e>>2]|0;J=Y+-8|0;Q=a[J>>2]|0;$=e+Q|0;ee=Y+-4|0;u=a[ee>>2]|0;a[B>>2]=r;d=B+4|0;a[d>>2]=e;h=B+8|0;a[h>>2]=t;f=B+12|0;a[f>>2]=o;m=B+16|0;v=B+20|0;g=B+24|0;y=B+28|0;b=B+32|0;_=B+40|0;ae=m;le=ae+36|0;do{a[ae>>2]=0|0;ae=ae+4|0}while((ae|0)<(le|0));i[m+36>>1]=0|0;n[m+38>>0]=0|0;E=on(u,r,0)|0;e:do{if(E){A=B+48|0;a[A>>2]=1;w=a[u>>2]|0;T=w+20|0;k=a[T>>2]|0;Yn[k&3](u,B,$,$,1,0);R=a[g>>2]|0;x=(R|0)==1;s=x?$:0;l=s}else{C=B+36|0;S=a[u>>2]|0;M=S+24|0;I=a[M>>2]|0;Zn[I&3](u,B,$,1,0);D=a[C>>2]|0;switch(D|0){case 0:{N=a[_>>2]|0;j=(N|0)==1;H=a[y>>2]|0;O=(H|0)==1;te=j&O;P=a[b>>2]|0;L=(P|0)==1;re=te&L;F=a[v>>2]|0;c=re?F:0;l=c;break e;break}case 1:{break}default:{l=0;break e}}V=a[g>>2]|0;U=(V|0)==1;if(!U){z=a[_>>2]|0;G=(z|0)==0;W=a[y>>2]|0;K=(W|0)==1;ne=G&K;X=a[b>>2]|0;q=(X|0)==1;ie=ne&q;if(!ie){l=0;break}}Z=a[m>>2]|0;l=Z}}while(0);p=se;return l|0}function dn(e){e=e|0;var t=0,r=0;r=p;Jr(e);mn(e);return}function hn(e,t,r,n,i,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0;g=p;d=t+8|0;h=a[d>>2]|0;f=on(e,h,o)|0;if(f){cn(0,t,r,n,i)}else{m=e+8|0;s=a[m>>2]|0;l=a[s>>2]|0;c=l+20|0;u=a[c>>2]|0;Yn[u&3](s,t,r,n,i,o)}return}function fn(e,t,r,i,o){e=e|0;t=t|0;r=r|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0;var C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0,z=0,G=0,W=0,K=0,X=0;var q=0,Z=0,Y=0,J=0,Q=0,$=0,ee=0;ee=p;q=t+8|0;Z=a[q>>2]|0;Y=on(e,Z,o)|0;do{if(Y){ln(0,t,r,i)}else{J=a[t>>2]|0;Q=on(e,J,o)|0;if(!Q){z=e+8|0;G=a[z>>2]|0;W=a[G>>2]|0;K=W+24|0;X=a[K>>2]|0;Zn[X&3](G,t,r,i,o);break}c=t+16|0;u=a[c>>2]|0;d=(u|0)==(r|0);if(!d){h=t+20|0;f=a[h>>2]|0;m=(f|0)==(r|0);if(!m){y=t+32|0;a[y>>2]=i;b=t+44|0;_=a[b>>2]|0;E=(_|0)==4;if(E){break}A=t+52|0;n[A>>0]=0;w=t+53|0;n[w>>0]=0;T=e+8|0;k=a[T>>2]|0;R=a[k>>2]|0;x=R+20|0;C=a[x>>2]|0;Yn[C&3](k,t,r,r,1,o);S=n[w>>0]|0;M=S<<24>>24==0;if(M){s=4;$=11}else{I=n[A>>0]|0;D=I<<24>>24==0;if(D){s=3;$=11}else{l=3}}if(($|0)==11){a[h>>2]=r;N=t+40|0;j=a[N>>2]|0;H=j+1|0;a[N>>2]=H;O=t+36|0;P=a[O>>2]|0;L=(P|0)==1;if(L){F=t+24|0;V=a[F>>2]|0;B=(V|0)==2;if(B){U=t+54|0;n[U>>0]=1;l=s}else{l=s}}else{l=s}}a[b>>2]=l;break}}v=(i|0)==1;if(v){g=t+32|0;a[g>>2]=1}}}while(0);return}function pn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0;m=p;s=t+8|0;l=a[s>>2]|0;c=on(e,l,0)|0;if(c){sn(0,t,r,n)}else{u=e+8|0;d=a[u>>2]|0;h=a[d>>2]|0;i=h+28|0;o=a[i>>2]|0;qn[o&3](d,t,r,n)}return}function mn(e){e=e|0;var t=0,r=0;r=p;Xr(e);return}function vn(e){e=e|0;var t=0,r=0;r=p;return}function gn(e){e=e|0;var t=0,r=0;r=p;Jr(e);mn(e);return}function yn(e,t,r){e=e|0;t=t|0;r=r|0;var n=0,i=0,a=0;a=p;n=on(e,t,0)|0;return n|0}function bn(e){e=e|0;var t=0,r=0;r=p;Jr(e);mn(e);return}function _n(e,t,r,i,o,s){e=e|0;t=t|0;r=r|0;i=i|0;o=o|0;s=s|0;var l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0,C=0;var S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0,z=0;z=p;L=t+8|0;F=a[L>>2]|0;V=on(e,F,s)|0;if(V){cn(0,t,r,i,o)}else{B=t+52|0;c=n[B>>0]|0;u=t+53|0;d=n[u>>0]|0;h=e+16|0;f=e+12|0;m=a[f>>2]|0;v=(e+16|0)+(m<<3)|0;n[B>>0]=0;n[u>>0]=0;Tn(h,t,r,i,o,s);g=(m|0)>1;e:do{if(g){y=e+24|0;b=t+24|0;_=e+8|0;E=t+54|0;l=y;while(1){A=n[E>>0]|0;w=A<<24>>24==0;if(!w){break e}T=n[B>>0]|0;k=T<<24>>24==0;if(k){I=n[u>>0]|0;D=I<<24>>24==0;if(!D){N=a[_>>2]|0;j=N&1;H=(j|0)==0;if(H){break e}}}else{R=a[b>>2]|0;x=(R|0)==1;if(x){break e}C=a[_>>2]|0;S=C&2;M=(S|0)==0;if(M){break e}}n[B>>0]=0;n[u>>0]=0;Tn(l,t,r,i,o,s);O=l+8|0;P=O>>>0<v>>>0;if(P){l=O}else{break}}}}while(0);n[B>>0]=c;n[u>>0]=d}return}function En(e,t,r,i,o){e=e|0;t=t|0;r=r|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0,x=0;var C=0,S=0,M=0,I=0,D=0,N=0,j=0,H=0,O=0,P=0,L=0,F=0,V=0,B=0,U=0,z=0,G=0,W=0,K=0,X=0;var q=0,Z=0,Y=0,J=0,Q=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,ue=0,de=0,he=0,fe=0;var pe=0,me=0,ve=0,ge=0,ye=0,be=0,_e=0,Ee=0,Ae=0,we=0,Te=0,ke=0,Re=0,xe=0,Ce=0,Se=0,Me=0,Ie=0,De=0,Ne=0;var je=0,He=0,Oe=0,Pe=0,Le=0,Fe=0,Ve=0,Be=0,Ue=0,ze=0,Ge=0,We=0,Ke=0,Xe=0,qe=0,Ze=0,Ye=0,Je=0,Qe=0;Qe=p;ne=t+8|0;pe=a[ne>>2]|0;ke=on(e,pe,o)|0;e:do{if(ke){ln(0,t,r,i)}else{Oe=a[t>>2]|0;Xe=on(e,Oe,o)|0;if(!Xe){ue=e+16|0;de=e+12|0;he=a[de>>2]|0;fe=(e+16|0)+(he<<3)|0;kn(ue,t,r,i,o);me=e+24|0;ve=(he|0)>1;if(!ve){break}ge=e+8|0;ye=a[ge>>2]|0;be=ye&2;_e=(be|0)==0;if(_e){Ee=t+36|0;Ae=a[Ee>>2]|0;we=(Ae|0)==1;if(!we){Me=ye&1;Ie=(Me|0)==0;if(Ie){je=t+54|0;m=me;while(1){Ge=n[je>>0]|0;We=Ge<<24>>24==0;if(!We){break e}Ke=a[Ee>>2]|0;qe=(Ke|0)==1;if(qe){break e}kn(m,t,r,i,o);Ze=m+8|0;Ye=Ze>>>0<fe>>>0;if(Ye){m=Ze}else{break e}}}De=t+24|0;Ne=t+54|0;d=me;while(1){He=n[Ne>>0]|0;Pe=He<<24>>24==0;if(!Pe){break e}Le=a[Ee>>2]|0;Fe=(Le|0)==1;if(Fe){Ve=a[De>>2]|0;Be=(Ve|0)==1;if(Be){break e}}kn(d,t,r,i,o);Ue=d+8|0;ze=Ue>>>0<fe>>>0;if(ze){d=Ue}else{break e}}}}Te=t+54|0;s=me;while(1){Re=n[Te>>0]|0;xe=Re<<24>>24==0;if(!xe){break e}kn(s,t,r,i,o);Ce=s+8|0;Se=Ce>>>0<fe>>>0;if(Se){s=Ce}else{break e}}}g=t+16|0;y=a[g>>2]|0;b=(y|0)==(r|0);if(!b){_=t+20|0;E=a[_>>2]|0;A=(E|0)==(r|0);if(!A){k=t+32|0;a[k>>2]=i;R=t+44|0;x=a[R>>2]|0;C=(x|0)==4;if(C){break}S=e+16|0;M=e+12|0;I=a[M>>2]|0;D=(e+16|0)+(I<<3)|0;N=t+52|0;j=t+53|0;H=t+54|0;O=e+8|0;P=t+24|0;l=0;c=S;u=0;t:while(1){L=c>>>0<D>>>0;if(!L){v=l;Je=18;break}n[N>>0]=0;n[j>>0]=0;Tn(c,t,r,r,1,o);F=n[H>>0]|0;V=F<<24>>24==0;if(!V){v=l;Je=18;break}B=n[j>>0]|0;U=B<<24>>24==0;do{if(U){h=l;f=u}else{z=n[N>>0]|0;G=z<<24>>24==0;if(G){Y=a[O>>2]|0;J=Y&1;Q=(J|0)==0;if(Q){v=1;Je=18;break t}else{h=1;f=u;break}}W=a[P>>2]|0;K=(W|0)==1;if(K){Je=23;break t}X=a[O>>2]|0;q=X&2;Z=(q|0)==0;if(Z){Je=23;break t}else{h=1;f=1}}}while(0);$=c+8|0;l=h;c=$;u=f}do{if((Je|0)==18){if(!u){a[_>>2]=r;ee=t+40|0;te=a[ee>>2]|0;re=te+1|0;a[ee>>2]=re;ie=t+36|0;ae=a[ie>>2]|0;oe=(ae|0)==1;if(oe){se=a[P>>2]|0;le=(se|0)==2;if(le){n[H>>0]=1;if(v){Je=23;break}else{ce=4;break}}}}if(v){Je=23}else{ce=4}}}while(0);if((Je|0)==23){ce=3}a[R>>2]=ce;break}}w=(i|0)==1;if(w){T=t+32|0;a[T>>2]=1}}}while(0);return}function An(e,t,r,i){e=e|0;t=t|0;r=r|0;i=i|0;var o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0;w=p;v=t+8|0;g=a[v>>2]|0;y=on(e,g,0)|0;e:do{if(y){sn(0,t,r,i)}else{b=e+16|0;_=e+12|0;E=a[_>>2]|0;s=(e+16|0)+(E<<3)|0;wn(b,t,r,i);l=(E|0)>1;if(l){c=e+24|0;u=t+54|0;o=c;while(1){wn(o,t,r,i);d=n[u>>0]|0;h=d<<24>>24==0;if(!h){break e}f=o+8|0;m=f>>>0<s>>>0;if(m){o=f}else{break}}}}}while(0);return}function wn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0;T=p;g=e+4|0;y=a[g>>2]|0;b=y>>8;_=y&1;E=(_|0)==0;if(E){i=b}else{A=a[r>>2]|0;o=A+b|0;s=a[o>>2]|0;i=s}l=a[e>>2]|0;c=a[l>>2]|0;u=c+28|0;d=a[u>>2]|0;h=r+i|0;f=y&2;m=(f|0)!=0;v=m?n:2;qn[d&3](l,t,h,v);return}function Tn(e,t,r,n,i,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;o=o|0;var s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0,R=0;R=p;E=e+4|0;A=a[E>>2]|0;w=A>>8;T=A&1;l=(T|0)==0;if(l){s=w}else{c=a[n>>2]|0;u=c+w|0;d=a[u>>2]|0;s=d}h=a[e>>2]|0;f=a[h>>2]|0;m=f+20|0;v=a[m>>2]|0;g=n+s|0;y=A&2;b=(y|0)!=0;_=b?i:2;Yn[v&3](h,t,r,g,_,o);return}function kn(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;var o=0,s=0,l=0,c=0,u=0,d=0,h=0,f=0,m=0,v=0,g=0,y=0,b=0,_=0,E=0,A=0,w=0,T=0,k=0;k=p;b=e+4|0;_=a[b>>2]|0;E=_>>8;A=_&1;w=(A|0)==0;if(w){o=E}else{s=a[r>>2]|0;l=s+E|0;c=a[l>>2]|0;o=c}u=a[e>>2]|0;d=a[u>>2]|0;h=d+24|0;f=a[h>>2]|0;m=r+o|0;v=_&2;g=(v|0)!=0;y=g?n:2;Zn[f&3](u,t,m,y,i);return}function Rn(){}function xn(e,t,r){e=e|0;t=t|0;r=r|0;var i=0;var o=0;var s=0;var l=0;if((r|0)>=8192){return Ae(e|0,t|0,r|0)|0}i=e|0;l=e+r|0;if((e&3)==(t&3)){while(e&3){if((r|0)==0)return i|0;n[e>>0]=n[t>>0]|0;e=e+1|0;t=t+1|0;r=r-1|0}o=l&-4|0;s=o-64|0;while((e|0)<=(s|0)){a[e>>2]=a[t>>2]|0;a[e+4>>2]=a[t+4>>2]|0;a[e+8>>2]=a[t+8>>2]|0;a[e+12>>2]=a[t+12>>2]|0;a[e+16>>2]=a[t+16>>2]|0;a[e+20>>2]=a[t+20>>2]|0;a[e+24>>2]=a[t+24>>2]|0;a[e+28>>2]=a[t+28>>2]|0;a[e+32>>2]=a[t+32>>2]|0;a[e+36>>2]=a[t+36>>2]|0;a[e+40>>2]=a[t+40>>2]|0;a[e+44>>2]=a[t+44>>2]|0;a[e+48>>2]=a[t+48>>2]|0;a[e+52>>2]=a[t+52>>2]|0;a[e+56>>2]=a[t+56>>2]|0;a[e+60>>2]=a[t+60>>2]|0;e=e+64|0;t=t+64|0}while((e|0)<(o|0)){a[e>>2]=a[t>>2]|0;e=e+4|0;t=t+4|0}}else{o=l-4|0;while((e|0)<(o|0)){n[e>>0]=n[t>>0]|0;n[e+1>>0]=n[t+1>>0]|0;n[e+2>>0]=n[t+2>>0]|0;n[e+3>>0]=n[t+3>>0]|0;e=e+4|0;t=t+4|0}}while((e|0)<(l|0)){n[e>>0]=n[t>>0]|0;e=e+1|0;t=t+1|0}return i|0}function Cn(e,t,r){e=e|0;t=t|0;r=r|0;var i=0,o=0,s=0,l=0;i=e+r|0;t=t&0xff;if((r|0)>=67){while((e&3)!=0){n[e>>0]=t;e=e+1|0}o=i&-4|0;s=o-64|0;l=t|t<<8|t<<16|t<<24;while((e|0)<=(s|0)){a[e>>2]=l;a[e+4>>2]=l;a[e+8>>2]=l;a[e+12>>2]=l;a[e+16>>2]=l;a[e+20>>2]=l;a[e+24>>2]=l;a[e+28>>2]=l;a[e+32>>2]=l;a[e+36>>2]=l;a[e+40>>2]=l;a[e+44>>2]=l;a[e+48>>2]=l;a[e+52>>2]=l;a[e+56>>2]=l;a[e+60>>2]=l;e=e+64|0}while((e|0)<(o|0)){a[e>>2]=l;e=e+4|0}}while((e|0)<(i|0)){n[e>>0]=t;e=e+1|0}return i-r|0}function Sn(e){e=e|0;var t=0;var r=0;var n=0;var i=0;e=e+15&-16|0;t=a[d>>2]|0;n=t+e|0;if((e|0)>0&(n|0)<(t|0)|(n|0)<0){Y()|0;le(12);return-1}a[d>>2]=n;i=Z()|0;if((n|0)>(i|0)){if((q()|0)==0){a[d>>2]=t;le(12);return-1}}return t|0}function Mn(e){e=e|0;return Gn[e&1]()|0}function In(e,t){e=e|0;t=t|0;return Wn[e&1](t|0)|0}function Dn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;return Kn[e&3](t|0,r|0,n|0)|0}function Nn(e,t){e=e|0;t=t|0;Xn[e&7](t|0)}function jn(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;qn[e&3](t|0,r|0,n|0,i|0)}function Hn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;Zn[e&3](t|0,r|0,n|0,i|0,a|0)}function On(e,t,r,n,i,a,o){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;o=o|0;Yn[e&3](t|0,r|0,n|0,i|0,a|0,o|0)}function Pn(){K(0);return 0}function Ln(e){e=e|0;K(1);return 0}function Fn(e,t,r){e=e|0;t=t|0;r=r|0;K(2);return 0}function Vn(e){e=e|0;K(3)}function Bn(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;K(4)}function Un(e,t,r,n,i){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;K(5)}function zn(e,t,r,n,i,a){e=e|0;t=t|0;r=r|0;n=n|0;i=i|0;a=a|0;K(6)}var Gn=[Pn,nt];var Wn=[Ln,lt];var Kn=[Fn,tn,yn,Fn];var Xn=[Vn,Jr,Qr,$r,en,dn,gn,bn];var qn=[Bn,an,pn,An];var Zn=[Un,nn,fn,En];var Yn=[zn,rn,hn,_n];return{__GLOBAL__sub_I_bind_cpp:mt,__GLOBAL__sub_I_whiteList_cpp:pt,___errno_location:qr,___getTypeName:Wr,_free:Xr,_malloc:Kr,_memcpy:xn,_memset:Cn,_sbrk:Sn,dynCall_i:Mn,dynCall_ii:In,dynCall_iiii:Dn,dynCall_vi:Nn,dynCall_viiii:jn,dynCall_viiiii:Hn,dynCall_viiiiii:On,establishStackSpace:$e,getTempRet0:rt,runPostSets:Rn,setTempRet0:tt,setThrew:et,stackAlloc:Ye,stackRestore:Qe,stackSave:Je}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer),__GLOBAL__sub_I_bind_cpp=Module.__GLOBAL__sub_I_bind_cpp=asm.__GLOBAL__sub_I_bind_cpp,__GLOBAL__sub_I_whiteList_cpp=Module.__GLOBAL__sub_I_whiteList_cpp=asm.__GLOBAL__sub_I_whiteList_cpp,___errno_location=Module.___errno_location=asm.___errno_location,___getTypeName=Module.___getTypeName=asm.___getTypeName,_free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,_memcpy=Module._memcpy=asm._memcpy,_memset=Module._memset=asm._memset,_sbrk=Module._sbrk=asm._sbrk,establishStackSpace=Module.establishStackSpace=asm.establishStackSpace,getTempRet0=Module.getTempRet0=asm.getTempRet0,runPostSets=Module.runPostSets=asm.runPostSets,setTempRet0=Module.setTempRet0=asm.setTempRet0,setThrew=Module.setThrew=asm.setThrew,stackAlloc=Module.stackAlloc=asm.stackAlloc,stackRestore=Module.stackRestore=asm.stackRestore,stackSave=Module.stackSave=asm.stackSave,dynCall_i=Module.dynCall_i=asm.dynCall_i,dynCall_ii=Module.dynCall_ii=asm.dynCall_ii,dynCall_iiii=Module.dynCall_iiii=asm.dynCall_iiii,dynCall_vi=Module.dynCall_vi=asm.dynCall_vi,dynCall_viiii=Module.dynCall_viiii=asm.dynCall_viiii,dynCall_viiiii=Module.dynCall_viiiii=asm.dynCall_viiiii,dynCall_viiiiii=Module.dynCall_viiiiii=asm.dynCall_viiiiii;if(Module.asm=asm,memoryInitializer)if(isDataURI(memoryInitializer)||("function"==typeof Module.locateFile?memoryInitializer=Module.locateFile(memoryInitializer):Module.memoryInitializerPrefixURL&&(memoryInitializer=Module.memoryInitializerPrefixURL+memoryInitializer)),ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL){var data=Module.readBinary(memoryInitializer);HEAPU8.set(data,GLOBAL_BASE)}else{addRunDependency("memory initializer");var applyMemoryInitializer=function(e){e.byteLength&&(e=new Uint8Array(e)),HEAPU8.set(e,GLOBAL_BASE),Module.memoryInitializerRequest&&delete Module.memoryInitializerRequest.response,removeRunDependency("memory initializer")};function doBrowserLoad(){Module.readAsync(memoryInitializer,applyMemoryInitializer,(function(){throw"could not load memory initializer "+memoryInitializer}))}var memoryInitializerBytes=tryParseAsDataURI(memoryInitializer);if(memoryInitializerBytes)applyMemoryInitializer(memoryInitializerBytes.buffer);else if(Module.memoryInitializerRequest){function useRequest(){var e=Module.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var r=tryParseAsDataURI(Module.memoryInitializerRequestURL);if(!r)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+memoryInitializer),void doBrowserLoad();t=r.buffer}applyMemoryInitializer(t)}Module.memoryInitializerRequest.response?setTimeout(useRequest,0):Module.memoryInitializerRequest.addEventListener("load",useRequest)}else doBrowserLoad()}function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var calledMain=!1;function run(e){function t(){Module.calledRun||(Module.calledRun=!0,ABORT||(ensureInitRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),postRun()))}e=e||Module.arguments,runDependencies>0||(preRun(),runDependencies>0||Module.calledRun||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((function(){setTimeout((function(){Module.setStatus("")}),1),t()}),1)):t()))}function exit(e,t){t&&Module.noExitRuntime&&0===e||(Module.noExitRuntime||(ABORT=!0,EXITSTATUS=e,STACKTOP=initialStackTop,exitRuntime(),Module.onExit&&Module.onExit(e)),ENVIRONMENT_IS_NODE&&process.exit(e),Module.quit(e,new ExitStatus(e)))}dependenciesFulfilled=function e(){Module.calledRun||run(),Module.calledRun||(dependenciesFulfilled=e)},Module.run=run,Module.exit=exit;var abortDecorators=[];function abort(e){throw Module.onAbort&&Module.onAbort(e),void 0!==e?(Module.print(e),Module.printErr(e),e=JSON.stringify(e)):e="",ABORT=!0,EXITSTATUS=1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(Module.abort=abort,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();Module.noExitRuntime=!0,run(),function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=r(1);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var a=AFRAME.utils.srcLoader.parseUrl,o=AFRAME.utils.debug;o.enable("shader:gif:warn");var s=o("shader:gif:warn"),l=(o("shader:gif:debug"),{});function c(e,t){return{status:"error",src:t,message:e,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{default:null},autoplay:{default:!0}},init:function(e){return this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=a(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,o=this.__validateAndGetQuerySelector(e);if(o&&"object"===(void 0===o?"undefined":n(o))){if(o.error)i=o.error;else{var s=o.tagName.toLowerCase();if("video"===s)e=o.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(o.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var a={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(a)})),l[e]=a)}),(function(e){return o(e)})):o("This is not gif. Please use `shader:flat` instead")}))})),a.addEventListener("error",(function(e){return o("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),a.src=e}function o(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",a=0;a<n.length;a++)i+=n[a].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_RGB",{schema:{color:{type:"color",is:"uniform",default:0},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_threshold:{type:"number",is:"uniform",default:.8},_slope:{type:"number",is:"uniform",default:.2},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform vec3 color;","uniform float opacity;","varying vec2 vUV;","uniform float _threshold;","uniform float _slope;","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," float d1, d2, d3, d4, d;"," d1 = abs(length(abs(color.rgb - tColor.rgb)));"," float c1 = abs(length( tColor.g - tColor.r) - length(color.g - color.r));"," float c2 = abs(length( tColor.r - tColor.b) - length(color.r - color.b));"," float c3 = abs(length( tColor.b - tColor.g) - length(color.b - color.g));"," d4 = c1 + c2 + c3;"," d = (d1*2.0 + d4) / 2.0 ;"," float edge0 = _threshold * (1.0 - _slope);"," float alpha = smoothstep(edge0, _threshold, d);"," if (alpha < opacity){","   gl_FragColor = vec4(tColor, alpha*a);"," }"," else{","   gl_FragColor = vec4(tColor, opacity*a);"," }","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(e.color)},texture:{value:this.__texture},opacity:{value:e.opacity},_threshold:{value:e._threshold},_slope:{value:e._slope}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=a(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,o=this.__validateAndGetQuerySelector(e);if(o&&"object"===(void 0===o?"undefined":n(o))){if(o.error)i=o.error;else{var s=o.tagName.toLowerCase();if("video"===s)e=o.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(o.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var a={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(a)})),l[e]=a)}),(function(e){return o(e)})):o("This is not gif. Please use `shader:flat` instead")}))})),a.addEventListener("error",(function(e){return o("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),a.src=e}function o(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",a=0;a<n.length;a++)i+=n[a].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}}),AFRAME.registerShader("gif_HSV",{schema:{color:{type:"color"},fog:{default:!0},texture:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1},_keyingColorH:{type:"number",is:"uniform",default:.33},_keyingColorS:{type:"number",is:"uniform",default:1},_keyingColorV:{type:"number",is:"uniform",default:.75},_deltaH:{type:"number",is:"uniform",default:.2},_deltaS:{type:"number",is:"uniform",default:.1},_deltaV:{type:"number",is:"uniform",default:.1},src:{default:null},autoplay:{default:!0}},init:function(e){this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset();var t={vertexShader:["varying vec2 vUV;","void main(void) {","  vUV = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform float opacity;","varying vec2 vUV;","uniform float _keyingColorH;","uniform float _keyingColorS;","uniform float _keyingColorV;","uniform float _deltaH;","uniform float _deltaS;","uniform float _deltaV;","vec3 rgb2hsv(vec3 c){"," vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);"," vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));"," vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));"," float d = q.x - min(q.w, q.y);"," float e = 1.0e-10;"," return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","void main(){"," vec3 tColor = texture2D( texture, vUV ).rgb;"," float a = texture2D( texture, vUV ).a;"," vec3 HSV = rgb2hsv(tColor);"," float h = abs(HSV.x - _keyingColorH);"," float s = abs(HSV.y - _keyingColorS);"," float v = abs(HSV.z - _keyingColorV);"," float alpha = opacity;"," if (h <= _deltaH * 0.5 && s <= _deltaS && v <= _deltaV){","   alpha = smoothstep((_deltaH * 0.5) * 0.8, _deltaH* 0.6 ,h);"," }","gl_FragColor = vec4(tColor, alpha*a);","}"].join("\n")};return this.material=new THREE.ShaderMaterial({uniforms:{texture:{value:this.__texture},opacity:{value:e.opacity},_keyingColorH:{value:e._keyingColorH},_keyingColorS:{value:e._keyingColorS},_keyingColorV:{value:e._keyingColorV},_deltaH:{value:e._deltaH},_deltaS:{value:e._deltaS},_deltaV:{value:e._deltaV}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(e){return this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(e){var t=this.material;console.log("testmaterial",t);var r=this.__getMaterialData(e);Object.keys(r).forEach((function(e){t[e]=r[e]}))},__getMaterialData:function(e){return{fog:e.fog,opacity:e.opacity}},__setTexure:function(e){"error"===e.status?(s("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,r=e.autoplay;"boolean"==typeof r?this.__autoplay=r:void 0===r&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var r=a(e);if(r)this.__getImageSrc(r,t);else{var i=void 0,o=this.__validateAndGetQuerySelector(e);if(o&&"object"===(void 0===o?"undefined":n(o))){if(o.error)i=o.error;else{var s=o.tagName.toLowerCase();if("video"===s)e=o.src,i="For video, please use `aframe-video-shader`";else{if("img"===s)return void this.__getImageSrc(o.src,t);i="For <"+s+"> element, please use `aframe-html-shader`"}}var u,d;i&&(u=l[e],d=c(i,e),u&&u.callbacks?u.callbacks.forEach((function(e){return e(d)})):t(d),l[e]=d)}}},__getImageSrc:function(e,t){var r=this;if(e!==this.__textureSrc){var n=l[e];if(n&&n.callbacks){if(n.src)return void t(n);if(n.callbacks)return void n.callbacks.push(t)}else(n=l[e]={callbacks:[]}).callbacks.push(t);var a=new Image;a.crossOrigin="Anonymous",a.addEventListener("load",(function(t){r.__getUnit8Array(e,(function(t){t?(0,i.parseGIF)(t,(function(t,r,i){var a={status:"success",src:e,times:t,cnt:r,frames:i,timestamp:Date.now()};n.callbacks&&(n.callbacks.forEach((function(e){return e(a)})),l[e]=a)}),(function(e){return o(e)})):o("This is not gif. Please use `shader:flat` instead")}))})),a.addEventListener("error",(function(e){return o("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),a.src=e}function o(t){var r=c(t,e);n.callbacks&&(n.callbacks.forEach((function(e){return e(r)})),l[e]=r)}},__getUnit8Array:function(e,t){if("function"==typeof t){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.addEventListener("load",(function(e){for(var r=new Uint8Array(e.target.response),n=r.subarray(0,4),i="",a=0;a<n.length;a++)i+=n[a].toString(16);"47494638"===i?t(r):t()})),r.addEventListener("error",(function(e){t()})),r.send()}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){this.__paused=!0},play:function(){this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){if(0!=this.__frameIdx){var e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();var t=this.__frames[this.__frameIdx];this.__ctx.drawImage(t,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(e){var t=e.src,r=e.times,n=e.cnt,i=e.frames;this.__textureSrc=t,this.__delayTimes=r,n?this.__loopCnt=n:this.__infinity=!0,this.__frames=i,this.__frameCnt=r.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(i[0].width),this.__height=THREE.Math.floorPowerOfTwo(i[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})},function(e,t){"use strict";t.parseGIF=function(e,t,r){var n=0,i=[],a=0,o=null,s=null,l=[],c=0;if(71!==e[0]||73!==e[1]||70!==e[2]||56!==e[3]||57!==e[4]&&55!==e[4]||97!==e[5])r&&r("parseGIF: no GIF89a");else{n+=+!!(128&e[10])*Math.pow(2,1+(7&e[10]))*3+13;for(var u=e.subarray(0,n);e[n]&&59!==e[n];){var d=n,h=e[n];if(33===h){var f=e[++n];if(-1===[1,254,249,255].indexOf(f)){r&&r("parseGIF: unknown label");break}for(249===f&&i.push(10*(e[n+3]+(e[n+4]<<8))),255===f&&(c=e[n+15]+(e[n+16]<<8));e[++n];)n+=e[n];249===f&&(o=e.subarray(d,n+1))}else{if(44!==h){r&&r("parseGIF: unknown blockId");break}for(n+=9,n+=+!!(128&e[n])*(3*Math.pow(2,1+(7&e[n])))+1;e[++n];)n+=e[n];s=e.subarray(d,n+1);var p={disposalMethod:o[3],blob:URL.createObjectURL(new Blob([u,o,s]))};l.push(p)}n++}}if(l.length){var m=document.createElement("canvas"),v=function e(r){var n=new Image;n.onload=function(r,n){a++,l[n]=this,a===l.length?(m=null,t&&t(i,c,l)):e(++n)}.bind(n),n.src=m.toDataURL("image/gif")};l.forEach((function(e,t){var r=new Image;r.onload=function(e,t){0===t&&(m.width=r.width,m.height=r.height),a++,l[t]=this,a===l.length&&(a=0,v(1))}.bind(r,null,t),r.src=e.blob,r.disposalMethod=e.disposalMethod}))}}}]),function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[o]={exports:{}};t[o][0].call(u.exports,(function(e){var r=t[o][1][e];return i(r||e)}),u,u.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";e("./")},{"./":2}],2:[function(e,t,r){"use strict";e("./src/controls"),e("./src/loaders"),e("./src/misc"),e("./src/pathfinding"),e("./src/primitives")},{"./src/controls":14,"./src/loaders":23,"./src/misc":28,"./src/pathfinding":34,"./src/primitives":42}],3:[function(e,t,r){"use strict";t.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(e,a))}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function d(e,t){for(var r in e){e[r].build=t(e[r])}}function h(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function f(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function p(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;E(g(o,i[l],i[c]),t)}return t}function v(e){return h(Ke.animations[e],m)}function g(e,t,r){var n,i,a,o,s,l,c=Ke.nodes[e.id],u=He(c.id),d=c.transforms[e.sid],h=c.matrix.clone().transpose(),f={};switch(d){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===f[n]&&(f[n]={}),!0===e.arraySyntax){var p=r.array[i],m=e.indices[0]+4*e.indices[1];f[n][m]=p}else for(s=0,l=r.stride;s<l;s++)f[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort((function(e,t){return e.time-t.time}));for(var i=0;i<16;i++)A(r,i,t.elements[i]);return r}(f,h);return{name:u.uuid,keyframes:v}}var y=new THREE.Vector3,b=new THREE.Vector3,_=new THREE.Quaternion;function E(e,t){for(var r=e.keyframes,n=e.name,i=[],a=[],o=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],d=u.time,h=u.value;Te.fromArray(h).transpose(),Te.decompose(y,_,b),i.push(d),a.push(y.x,y.y,y.z),o.push(_.x,_.y,_.z,_.w),s.push(b.x,b.y,b.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function A(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=w(e,i,t),n=T(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}k(o,r,n,t)}}}(e,t)}function w(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function T(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function k(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function R(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=v(i[a]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function x(e){return h(Ke.clips[e],R)}function C(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=ie(a);break;case"joints":t.joints=S(a);break;case"vertex_weights":t.vertexWeights=M(a)}}return t}function S(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function M(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=o(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function I(e){var t={id:e.id},r=Ke.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,o=e.vertexWeights,s=o.vcount,l=o.v,c=o.inputs.JOINT.offset,u=o.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],h=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=a[o.inputs.WEIGHT.id].array,p=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(r=0;r<m;r++){var g=l[p+c],y=l[p+u],b=f[y];v.push({index:g,weight:b}),p+=2}for(v.sort(w),r=0;r<4;r++){var _=v[r];void 0!==_?(i.indices.array.push(_.index),i.weights.array.push(_.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=d.array.length;t<n;t++){var E=d.array[t],A=(new THREE.Matrix4).fromArray(h.array,t*h.stride).transpose();i.joints.push({name:E,boneInverse:A})}return i;function w(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function D(e){return void 0!==e.build?e.build:e.init_from}function N(e){var t=Ke.images[e];return void 0!==t?h(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function j(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":H(i,t);break;case"technique":t.technique=L(i);break;case"extra":t.extra=G(i)}}return t}function H(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=O(a);break;case"sampler2D":t.samplers[r]=P(a)}}}function O(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function P(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function L(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=F(i)}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=V(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:V(i)}}}return t}function V(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:B(a)}}}return t}function B(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":U(i,t)}}return t}function U(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":z(i,t)}}}function z(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function G(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function K(e){return e}function X(e){var t,r,n=(t=e.url,h(Ke.effects[t],K)),i=n.profile.technique,a=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function o(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=N(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=N(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Ve;break;default:t=Ue}return t}(r);if(void 0!==i){var a=i.load(r),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name;var l=i.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=o(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=o(u.texture));break;case"bump":u.texture&&(r.normalMap=o(u.texture));break;case"ambient":u.texture&&(r.lightMap=o(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color),u.texture&&(r.emissiveMap=o(u.texture))}}var d=l.transparent,f=l.transparency;if(void 0===f&&d&&(f={float:1}),void 0===d&&f&&(d={opaque:"A_ONE",data:{color:[1,1,1,1]}}),d&&f)if(d.data.texture)r.transparent=!0;else{var p=d.data.color;switch(d.opaque){case"A_ONE":r.opacity=p[3]*f.float;break;case"RGB_ZERO":r.opacity=1-p[0]*f.float;break;case"A_ZERO":r.opacity=1-p[3]*f.float;break;case"RGB_ONE":r.opacity=p[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',d.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=THREE.DoubleSide),r}function q(e){return h(Ke.materials[e],X)}function Z(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return Y(r)}}return{}}function Y(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=J(n)}}return t}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function Q(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function $(e){var t=Ke.cameras[e];return void 0!==t?h(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Ke.lights[e];return void 0!==t?h(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ae(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),d=u>0?l+u:l;t.inputs[d]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];se(s),t[o]=ce(s,r,n)}return t}function ce(e,t,r){for(var n={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,d=[],h=4,f=new THREE.BufferGeometry,p=[],m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,b=0;switch(g.type){case"lines":case"linestrips":b=2*g.count;break;case"triangles":b=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var E=g.vcount[_];switch(E){case 3:b+=3;break;case 4:b+=6;break;default:b+=3*(E-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var A in f.addGroup(m,b,v),m+=b,g.material&&p.push(g.material),y){var w=y[A];switch(A){case"VERTEX":for(var T in r){var k=r[T];switch(T){case"POSITION":var R=i.array.length;if(ue(g,t[k],w.offset,i.array),i.stride=t[k].stride,t.skinWeights&&t.skinIndices&&(ue(g,t.skinIndices,w.offset,c),ue(g,t.skinWeights,w.offset,d)),!1===g.hasUV&&!0===e.uvsNeedsFix){b=(i.array.length-R)/i.stride;for(var x=0;x<b;x++)o.array.push(0,0)}break;case"NORMAL":ue(g,t[k],w.offset,a.array),a.stride=t[k].stride;break;case"COLOR":ue(g,t[k],w.offset,l.array),l.stride=t[k].stride;break;case"TEXCOORD":ue(g,t[k],w.offset,o.array),o.stride=t[k].stride;break;case"TEXCOORD1":ue(g,t[k],w.offset,s.array),o.stride=t[k].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":ue(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"COLOR":ue(g,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":ue(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"TEXCOORD1":ue(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&f.addAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&f.addAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&f.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&f.addAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&f.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,u)),d.length>0&&f.addAttribute("skinWeight",new THREE.Float32BufferAttribute(d,h)),n.data=f,n.type=e[0].type,n.materialKeys=p,n}function ue(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*c,a=t+c;t<a;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,d=0,h=o.length;d<h;d++){var f=o[d];if(4===f){var p=u+1*a,m=u+2*a,v=u+3*a;s(u+0*a),s(p),s(v),s(p),s(m),s(v)}else if(3===f){p=u+1*a,m=u+2*a;s(u+0*a),s(p),s(m)}else if(f>4)for(var g=1,y=f-2;g<=y;g++){p=u+a*g,m=u+a*(g+1);s(u+0*a),s(p),s(m)}u+=a*f}else for(d=0,h=i.length;d<h;d+=a)s(d)}function de(e){return h(Ke.geometries[e],le)}function he(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=pe(n);break;case"link":t.links.push(ve(n))}}}function pe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var a=i(n.textContent);t.axis.fromArray(a);break;case"limits":var o=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function be(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":_e(n,t)}}}function _e(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function Ae(e){return void 0!==e.build?e.build:e}function we(e){for(var t=[],r=Le.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=i(a.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=i(a.textContent);var l=(new THREE.Vector3).fromArray(o);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=i(a.textContent),l=(new THREE.Vector3).fromArray(o);var c=THREE.Math.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:c})}}return t}var Te=new THREE.Matrix4,ke=new THREE.Vector3;function Re(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Re(n);break;case"instance_camera":t.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(xe(n));break;case"instance_light":t.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(xe(n));break;case"instance_node":t.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var a=i(n.textContent);t.matrix.multiply(Te.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=i(n.textContent);ke.fromArray(a),t.matrix.multiply(Te.makeTranslation(ke.x,ke.y,ke.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=i(n.textContent);var s=THREE.Math.degToRad(a[3]);t.matrix.multiply(Te.makeRotationAxis(ke.fromArray(a),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=i(n.textContent);t.matrix.scale(ke.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return je(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ke.nodes[t.id]=t,t}function xe(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=o(c)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function Ce(e,t){var r,n,i,a=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(je(s))Se(He(s),t,a);else if(i=s,void 0!==Ke.visualScenes[i])for(var l=Ke.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];if("JOINT"===u.type)Se(He(u.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(c=0;c<a.length;c++)if((n=a[c]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)!1===(n=a[r]).processed&&(o.push(n),n.processed=!0);var d=[],h=[];for(r=0;r<o.length;r++)n=o[r],d.push(n.bone),h.push(n.boneInverse);return new THREE.Skeleton(d,h)}function Se(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}}))}function Me(e){for(var t,r=[],n=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,d=0,f=i.length;d<f;d++)r.push(He(i[d]));for(d=0,f=o.length;d<f;d++){var p=$(o[d]);null!==p&&r.push(p.clone())}for(d=0,f=s.length;d<f;d++)for(var m=s[d],v=(t=m.id,h(Ke.controllers[t],I)),g=Ne(de(v.id),m.materials),y=Ce(m.skeletons,v.skin.joints),b=0,_=g.length;b<_;b++){var E;(E=g[b]).isSkinnedMesh&&(E.bind(y,v.skin.bindMatrix),E.normalizeSkinWeights()),r.push(E)}for(d=0,f=l.length;d<f;d++){var A=ne(l[d]);null!==A&&r.push(A.clone())}for(d=0,f=c.length;d<f;d++)for(b=0,_=(g=Ne(de((m=c[d]).id),m.materials)).length;b<_;b++)r.push(g[b]);for(d=0,f=u.length;d<f;d++)r.push(He(u[d]).clone());if(0===i.length&&1===r.length)E=r[0];else{E="JOINT"===a?new THREE.Bone:new THREE.Group;for(d=0;d<r.length;d++)E.add(r[d])}return""===E.name&&(E.name="JOINT"===a?e.sid:e.name),E.matrix.copy(n),E.matrix.decompose(E.position,E.quaternion,E.scale),E}var Ie=new THREE.MeshBasicMaterial({color:16711935});function De(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Ie)):r.push(q(a))}return r}function Ne(e,t){var r=[];for(var n in e){var i=e[n],a=De(i.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var o=void 0!==i.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var c,u=1===a.length?a[0]:a;switch(n){case"lines":c=new THREE.LineSegments(i.data,u);break;case"linestrips":c=new THREE.Line(i.data,u);break;case"triangles":case"polylist":c=o?new THREE.SkinnedMesh(i.data,u):new THREE.Mesh(i.data,u)}r.push(c)}return r}function je(e){return void 0!==Ke.nodes[e]}function He(e){return h(Ke.nodes[e],Me)}function Oe(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(He(i.id))}return t}function Pe(e){return h(Ke.visualScenes[e],Oe)}if(0===e.length)return{scene:new THREE.Scene};var Le=r((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],Fe=Le.getAttribute("version");console.log("THREE.ColladaLoader: File version",Fe);var Ve,Be=function(e){return{unit:l(r(e,"unit")[0]),upAxis:c(r(e,"up_axis")[0])}}(r(Le,"asset")[0]),Ue=new THREE.TextureLoader(this.manager);Ue.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ve=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var ze=[],Ge={},We=0,Ke={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Le,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":i=a.getAttribute("id"),t.sources[i]=ie(a);break;case"sampler":i=a.getAttribute("id"),t.samplers[i]=f(a);break;case"channel":i=a.getAttribute("target"),t.channels[i]=p(a);break;default:console.log(a)}}Ke.animations[e.getAttribute("id")]=t})),u(Le,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(o(i.getAttribute("url")))}}Ke.clips[e.getAttribute("id")]=t})),u(Le,"library_controllers","controller",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=C(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ke.controllers[e.getAttribute("id")]=t})),u(Le,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};Ke.images[e.getAttribute("id")]=t})),u(Le,"library_effects","effect",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=j(i)}}Ke.effects[e.getAttribute("id")]=t})),u(Le,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=o(i.getAttribute("url"))}}Ke.materials[e.getAttribute("id")]=t})),u(Le,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Z(i)}}Ke.cameras[e.getAttribute("id")]=t})),u(Le,"library_lights","light",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}Ke.lights[e.getAttribute("id")]=t})),u(Le,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ie(a);break;case"vertices":t.vertices=ae(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(a));break;default:console.log(a)}}}Ke.geometries[e.getAttribute("id")]=t}})),u(Le,"library_nodes","node",Re),u(Le,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+We++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Re(n[i]));Ke.visualScenes[e.getAttribute("id")]=t})),u(Le,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":fe(n,t)}}Ke.kinematicsModels[e.getAttribute("id")]=t})),u(Le,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},be(n,t.rigidBodies[n.getAttribute("name")])}}Ke.physicsModels[e.getAttribute("id")]=t})),u(Le,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(n))}}Ke.kinematicsScenes[o(e.getAttribute("url"))]=t})),d(Ke.animations,m),d(Ke.clips,R),d(Ke.controllers,I),d(Ke.images,D),d(Ke.effects,K),d(Ke.materials,X),d(Ke.cameras,Q),d(Ke.lights,re),d(Ke.geometries,le),d(Ke.visualScenes,Oe),function(){var e=Ke.clips;if(!0===s(e)){if(!1===s(Ke.animations)){var t=[];for(var r in Ke.animations)for(var n=v(r),i=0,a=n.length;i<a;i++)t.push(n[i]);ze.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)ze.push(x(r))}(),function(){var e=Object.keys(Ke.kinematicsModels)[0],t=Object.keys(Ke.kinematicsScenes)[0],r=Object.keys(Ke.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,h(Ke.kinematicsModels[n],he)),a=function(e){return h(Ke.kinematicsScenes[e],Ae)}(t),o=Pe(r),s=a.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var d=s[c],f=Le.querySelector('[sid="'+d.target+'"]');if(f){var p=f.parentElement;v(d.jointIndex,p)}}var m=new THREE.Matrix4;Ge={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,a=n.axis,o=r.transforms;Te.identity();for(var s=0;s<o.length;s++){var c=o[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":Te.multiply(m.makeRotationAxis(a,THREE.Math.degToRad(t)));break;case"prismatic":Te.multiply(m.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":Te.multiply(c.obj);break;case"translate":Te.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":Te.scale(c.obj);break;case"rotate":Te.multiply(m.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(Te),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),n=i.joints[e];o.traverse((function(i){i.name===r&&(l[e]={object:i,transforms:we(t),joint:n,position:n.zeroPosition})}))}}();var Xe=function(e){return Pe(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Le,"scene")[0]);return"Z_UP"===Be.upAxis&&Xe.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Xe.scale.multiplyScalar(Be.unit),{animations:ze,kinematics:Ge,library:Ke,scene:Xe}}}},{}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"function"==typeof Symbol&&n(Symbol.iterator);t.exports=THREE.FBXLoader=function(){var e,t,r;function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function i(e){this.textureLoader=e}function a(){}function o(){}function s(){}function l(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function u(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function h(e){return e/46186158e3}n.prototype={constructor:n,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,(function(r){try{t(i.parse(r,a))}catch(t){setTimeout((function(){n&&n(t),i.manager.itemError(e)}),0)}}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,r){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===_(e,0,t.length)}(t))e=(new l).parse(t);else{var n=_(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(var n=0;n<t.length;++n){if((a=void 0,a=e[(i=1)-1],e=e.slice(r+i),r++,a)===t[n])return!1}var i,a;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new s).parse(n)}return new i(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin)).parse(e)}},i.prototype={constructor:i,parse:function(){t=this.parseConnections();var n=this.parseImages(),i=this.parseTextures(n),o=this.parseMaterials(i),s=this.parseDeformers(),l=(new a).parse(s);return this.parseScene(s,l,o),e&&e.FBXHeaderExtension&&e.FBXHeaderExtension.SceneInfo&&e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"]&&(r["LastSaved|ApplicationName"]||(r["LastSaved|ApplicationName"]=e.FBXHeaderExtension.SceneInfo["LastSaved|ApplicationName"])),e&&e.GlobalSettings&&e.GlobalSettings.OriginalUnitScaleFactor&&e.GlobalSettings.OriginalUnitScaleFactor.value&&(r.OriginalUnitScaleFactor||(r.OriginalUnitScaleFactor=e.GlobalSettings.OriginalUnitScaleFactor.value)),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)}));return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[c=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=l}}}}for(var c in t){var u=t[c];void 0!==r[u]?t[c]=r[u]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var a=new THREE.TGALoader;a.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,a)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,a=void 0!==n?n.value:0,o=void 0!==i?i.value:0;if(r.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(n))return null;var o,s=this.parseParameters(e,r,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial({color:3342591})}return o.setValues(s),o.name=i,o},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(r,e.ID);break;case"DiffuseColor":i.map=a.getTexture(r,e.ID);break;case"DisplacementColor":i.displacementMap=a.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,e.ID);break;case"NormalMap":i.normalMap=a.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=a.getTexture(r,e.ID);break;case"TransparentColor":i.alphaMap=a.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[a]=l}else if("BlendShape"===o.attrType){var c={id:a};c.rawTargets=this.parseMorphTargets(s,i),c.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=c}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;t.get(parseInt(a.ID)).children.forEach((function(e){void 0===e.relationship&&(s.geoID=e.ID)})),n.push(s)}return n},parseScene:function(n,i,a){r=new THREE.Group;var s=this.parseModels(n.skeletons,i,a),l=e.Objects.Model,c=this;s.forEach((function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var r=s.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&r.add(e)})),this.bindSkeleton(n.skeletons,i,s),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix(t)}}));var u=(new o).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=u,r=r.children[0]),r.animations=u},parseModels:function(r,n,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),c=o[s],u=t.get(l),d=this.buildSkeleton(u,r,l,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,n,i);break;case"NurbsCurve":d=this.createCurve(u,n);break;case"LimbNode":case"Root":d=new THREE.Bone;break;case"Null":default:d=new THREE.Group}d.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),d.ID=l}this.getTransformData(d,c),a.set(l,d)}return a},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach((function(e){for(var a in t){var o=t[a];o.rawBones.forEach((function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=THREE.PropertyBinding.sanitizeNodeName(n),i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var d=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(u,c,a,o),null!==d&&r.setFocalLength(d);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach((function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)})),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(a,o,s,1);break;case 1:r=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new THREE.SpotLight(a,o,s,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,a=null,o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=THREE.VertexColors})),i.FBX_Deformer?(o.forEach((function(e){e.skinning=!0})),n=new THREE.SkinnedMesh(i,a)):n=new THREE.Mesh(i,a),n},createCurve:function(e,t){var r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(a))}}}))},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach((function(e){if(r.has(e.ID)){var a=e.ID;t.get(a).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],n=t[1],i=t[2];if(0!==r||0!==n||0!==i)new THREE.Color(r,n,i)}},setupMorphMaterials:function(){var e=this;r.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==i&&(o=!0)})):e.material.uuid===a&&e.uuid!==i&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},a.prototype={constructor:a,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=n.morphTargets,o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null),l=t.children.reduce((function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e}),null),c=o[0],u={};"RotationOrder"in c&&(u.eulerOrder=y(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);var d=g(u);return this.genGeometry(r,s,l,d)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(n.applyToBufferAttribute(s),i.addAttribute("position",s),o.colors.length>0&&i.addAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.addAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=new THREE.Float32BufferAttribute(o.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),i.addAttribute("normal",l)}if(o.uvs.forEach((function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.addAttribute(r,new THREE.Float32BufferAttribute(o.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],u=0;if(o.materialIndex.forEach((function(e,t){e!==c&&(i.addGroup(u,t-u,c),c=e,u=t)})),i.groups.length>0){var d=i.groups[i.groups.length-1],h=d.start+d.count;h!==o.materialIndex.length&&i.addGroup(h,o.materialIndex.length-h,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],l=[],c=[],u=[],d=this;return e.vertexIndices.forEach((function(h,f){var m=!1;h<0&&(h^=-1,m=!0);var v=[],g=[];if(a.push(3*h,3*h+1,3*h+2),e.color){var y=p(f,r,h,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var b=[0,0,0,0],_=[0,0,0,0];g.forEach((function(e,t){var r=e,n=v[t];_.forEach((function(e,t,i){if(r>e){i[t]=r,r=e;var a=b[t];b[t]=n,n=a}}))})),v=b,g=_}for(;g.length<4;)g.push(0),v.push(0);for(var E=0;E<4;++E)c.push(g[E]),u.push(v[E])}if(e.normal){y=p(f,r,h,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var A=p(f,r,h,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=p(f,r,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(d.genFace(t,e,a,A,o,s,l,c,u,n),r++,n=0,a=[],o=[],s=[],l=[],c=[],u=[])})),t},genFace:function(e,t,r,n,i,a,o,s,l,c){for(var u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(u-1)]),e.colors.push(a[3*(u-1)+1]),e.colors.push(a[3*(u-1)+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])}))},addMorphTargets:function(t,r,n,i){if(null!==n){t.morphAttributes.position=[];var a=this;n.rawTargets.forEach((function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)}))}},genMorphGeometry:function(e,t,r,n,i){var a=new THREE.BufferGeometry;r.attrName&&(a.name=r.attrName);for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=0;u<c.length;u++){var d=3*c[u];s[d]+=l[3*u],s[d+1]+=l[3*u+1],s[d+2]+=l[3*u+2]}var h={vertexIndices:o,vertexPositions:s},f=this.genBuffers(h),p=new THREE.Float32BufferAttribute(f.vertex,3);p.name=i||r.attrName,n.applyToBufferAttribute(p),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=i,n=a.length-1-r;for(l=0;l<i;++l)o.push(o[l])}var u=new THREE.NURBSCurve(i,a,o,r,n).getPoints(7*o.length),d=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(d,3*t)}));var h=new THREE.BufferGeometry;return h.addAttribute("position",new THREE.BufferAttribute(d,3)),h}},o.prototype={constructor:o,parse:function(){var e=[],t=this.parseClips();if(void 0!==t){for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e}},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(h),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=a:l.match(/Y/)?r.get(s).curves.y=a:l.match(/Z/)?r.get(s).curves.z=a:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));if(void 0!==l)l.children.forEach((function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a]){t.get(i.ID).parents.forEach((function(e){void 0!==e.relationship&&(f=e.ID)}));var l=e.Objects.Model[f.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(e){(e.ID=l.id)&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new THREE.Matrix4),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),s[a]=c}s[a][o.attr]=o}else if(void 0!==o.curves.morph){if(void 0===s[a]){var u;t.get(i.ID).parents.forEach((function(e){void 0!==e.relationship&&(u=e.ID)}));var d=t.get(u).parents[0].ID,h=t.get(d).parents[0].ID,f=t.get(h).parents[0].ID;l=e.Objects.Model[f],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[u].attrName};s[a]=c}s[a][o.attr]=o}}})),a.set(parseInt(o),s)}return a},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,a)},generateRotationTrack:function(e,t,r,n,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push(a),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.Math.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,c=new THREE.Euler,u=[],d=0;d<s.length;d+=3)c.set(s[d],s[d+1],s[d+2],a),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(u,d/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,r){return r.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var l=t.y.values[o];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var c=t.z.values[s];i.push(c),n[2]=c}else i.push(n[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,l=e.times[t-1],c=(e.times[t]-l)/a,u=l+c,d=[],h=[];u<e.times[t];)d.push(u),u+=c,h.push(s),s+=o;e.times=E(e.times,t,d),e.values=E(e.values,t,h)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),c=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=b(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],a=n[1],o=n[2],s=n[3],l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},l.prototype={constructor:l,parse:function(e){var t=new c(e);t.skip(23);for(var r=t.getUint32(),n=new u;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",d=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(o,r,h)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==d&&(r.attrType=d),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:l,flag:c,value:a}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),i=e.getUint32(),a=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new c(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(a))).decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},u.prototype={constructor:u,add:function(e,t){this[e]=t}};var f=[];function p(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(f,n.buffer,a,o)}var m=new THREE.Euler,v=new THREE.Vector3;function g(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,u=new THREE.Matrix4,d=new THREE.Matrix4,h=new THREE.Matrix4,f=new THREE.Matrix4,p=new THREE.Matrix4,g=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(m.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(m.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(m.fromArray(t)));e.scale&&s.scale(v.fromArray(e.scale)),e.scalingOffset&&c.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&d.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var y=n.multiply(i).multiply(a),b=new THREE.Matrix4;h.extractRotation(b);var _=new THREE.Matrix4,E=new THREE.Matrix4,A=new THREE.Matrix4,w=new THREE.Matrix4;if(w.copyPosition(h),A=w.getInverse(w).multiply(h),E=b.getInverse(b).multiply(A),_=s,0===g)p=b.multiply(y).multiply(E).multiply(_);else if(1===g)p=b.multiply(E).multiply(y).multiply(_);else{var T=(new THREE.Matrix4).copy(s),k=E.multiply(T.getInverse(T));p=b.multiply(y).multiply(k).multiply(_)}o=r.multiply(u).multiply(d).multiply(n).multiply(i).multiply(a).multiply(d.getInverse(d)).multiply(c).multiply(l).multiply(s).multiply(l.getInverse(l));var R=(new THREE.Matrix4).copyPosition(o),x=h.multiply(R);return f.copyPosition(x),o=f.multiply(p)}function y(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function _(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function E(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return n}()},{}],5:[function(e,t,r){"use strict";t.exports=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},{}],6:[function(e,t,r){"use strict";t.exports=function(e,t,r){this.type=e,this.index=t,this.pressed=r.pressed,this.value=r.value}},{}],7:[function(e,t,r){"use strict";t.exports={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]}},{}],8:[function(e,t,r){"use strict";function n(e){var t=document.getElementById(e),r=t.parentNode;try{r&&r.removeChild(t)}catch(e){}}function i(e,t,r){return new r((function(r,i){var a=t.timeout||5e3,o="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=function(e,t){var r=document.createElement("script");return r.type="text/javascript",r.async=!0,r.id=t,r.src=e,r}(e,o),l=setTimeout((function(){i(new Error("Script request to "+e+" timed out")),n(o)}),a),c=function(e){clearTimeout(e)};s.addEventListener("load",(function(e){r({ok:!0}),c(l),n(o)})),s.addEventListener("error",(function(t){i(new Error("Script request to "+e+" failed "+t)),c(l),n(o)})),function(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(s)}))}t.exports=function(e){return e=e||{},function(t,r){return i(t,r=r||{},e.Promise||Promise)}}},{}],9:[function(e,t,r){"use strict";var n,i,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},s=t.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};s.Board=function(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new s.AStarFinder(t),s.Loader.init(),this.setGrid(e)},s.Board.prototype={setEntityOnTile:function(e,t){var r=this.grid.cellToPixel(t.cell);e.position.copy(r),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e},addTile:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)},removeTile:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])},getTileAtCell:function(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)},snapToGrid:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))},snapTileToGrid:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e},getRandomTile:function(){var e=s.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]},findPath:function(e,t,r){return this.finder.findPath(e.cell,t.cell,r,this.grid)},setGrid:function(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach((function(e){this.grid.remove(e.cell),e.dispose()})),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)},generateTilemap:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new THREE.Object3D;for(var r=0;r<t.length;r++)this.tileGroup.add(t[r].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},s.Board.prototype.constructor=s.Board,s.Cell=function(e,t,r,n){this.q=e||0,this.r=t||0,this.s=r||0,this.h=n||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=s.LinkedList.generateID()},s.Cell.prototype={set:function(e,t,r){return this.q=e,this.r=t,this.s=r,this},copy:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this},add:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this},equals:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},s.Cell.prototype.constructor=s.Cell,s.HexGrid=function(e){e=e||{},this.type=s.HEX,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,r=[];for(t=0;6>t;t++)r.push(this._createVertex(t));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(r[0].x,r[0].y),t=1;6>t;t++)this.cellShape.lineTo(r[t].x,r[t].y);this.cellShape.lineTo(r[0].x,r[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=r,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new s.Cell(1,-1,0),new s.Cell(1,0,-1),new s.Cell(0,1,-1),new s.Cell(-1,1,0),new s.Cell(-1,0,1),new s.Cell(0,-1,1)],this._diagonals=[new s.Cell(2,-1,-1),new s.Cell(1,1,-2),new s.Cell(-1,2,-1),new s.Cell(-2,1,1),new s.Cell(-1,-1,2),new s.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new s.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},s.HexGrid.TWO_THIRDS=2/3,s.HexGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3},pixelToCell:function(e){var t=e.x*(s.HexGrid.TWO_THIRDS/this.cellSize),r=(-e.x/3+s.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,r,-t-r),this._cubeRound(this._cel)},getCellAt:function(e){var t=e.x*(s.HexGrid.TWO_THIRDS/this.cellSize),r=(-e.x/3+s.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,r,-t-r),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,r){var n,i,a=this._directions.length;for(this._list.length=0,n=0;a>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);if(t)for(n=0;a>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);return this._list},getRandomCell:function(){var e,t=0,r=s.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===r)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,r){var n=Math.abs(e.h);1>n&&(n=1);var i=this._geoCache[n];i||(this.extrudeSettings.amount=n,i=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=i);var a=new s.Tile({size:this.cellSize,scale:t,cell:e,geometry:i,material:r});return e.tile=a,a},generateTiles:function(e){e=e||{};var t,r,n,i=[],a={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in a=s.Tools.merge(a,e),this.cellSize=a.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=a.extrudeSettings,this.cells)n=this.cells[t],(r=this.generateTile(n,a.tileScale,a.material)).position.copy(this.cellToPixel(n)),r.position.y=0,i.push(r);return i},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,s.PI/2),t},generate:function(e){var t,r,n,i;for(e=e||{},this.size=void 0===e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(r=-this.size;r<this.size+1;r++)n=-t-r,Math.abs(t)<=this.size&&Math.abs(r)<=this.size&&Math.abs(n)<=this.size&&(i=new s.Cell(t,r,n),this.add(i))},generateOverlay:function(e,t,r){var n,i,a,o=this.cellShape.createPointsGeometry();for(n=-e;e+1>n;n++)for(i=-e;e+1>i;i++)if(a=-n-i,Math.abs(n)<=e&&Math.abs(i)<=e&&Math.abs(a)<=e){this._cel.set(n,i,a);var l=new THREE.Line(o,r);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*s.DEG_TO_RAD,t.add(l)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,r){var n=this;s.Tools.getJSON({url:e,callback:function(e){n.fromJSON(e),t.call(r||null,e)},cache:!1,scope:n})},fromJSON:function(e){var t,r,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*s.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(r=new s.Cell).copy(n[t]),this.add(r)},toJSON:function(){var e,t,r={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return r.cells=n,r},_createVertex:function(e){var t=s.TAU/6*e;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(e){var t=Math.round(e.q),r=Math.round(e.r),n=Math.round(e.s),i=Math.abs(t-e.q),a=Math.abs(r-e.r),o=Math.abs(n-e.s);return i>a&&i>o?t=-r-n:a>o?r=-t-n:n=-t-r,this._cel.set(t,r,n)}},s.HexGrid.prototype.constructor=s.HexGrid,s.SqrGrid=function(e){e=e||{},this.type=s.SQR,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new THREE.Vector3),t.push(new THREE.Vector3(-this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new s.Cell(1,0,0),new s.Cell(0,-1,0),new s.Cell(-1,0,0),new s.Cell(0,1,0)],this._diagonals=[new s.Cell(-1,-1,0),new s.Cell(-1,1,0),new s.Cell(1,1,0),new s.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new s.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},s.SqrGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3},pixelToCell:function(e){var t=Math.round(e.x/this._fullCellSize),r=Math.round(e.z/this._fullCellSize);return this._cel.set(t,r,0)},getCellAt:function(e){var t=Math.round(e.x/this._fullCellSize),r=Math.round(e.z/this._fullCellSize);return this._cel.set(t,r),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,r){var n,i,a=this._directions.length;for(this._list.length=0,n=0;a>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);if(t)for(n=0;a>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(i=this.cells[this.cellToHash(this._cel)])||r&&!r(e,i)||this._list.push(i);return this._list},getRandomCell:function(){var e,t=0,r=s.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===r)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,r){var n=Math.abs(e.h);1>n&&(n=1);var i=this._geoCache[n];i||(this.extrudeSettings.amount=n,i=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[n]=i);var a=new s.Tile({size:this.cellSize,scale:t,cell:e,geometry:i,material:r});return e.tile=a,a},generateTiles:function(e){e=e||{};var t,r,n,i=[],a={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in a=s.Tools.merge(a,e),this.cellSize=a.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=a.extrudeSettings,this.cells)n=this.cells[t],(r=this.generateTile(n,a.tileScale,a.material)).position.copy(this.cellToPixel(n)),r.position.y=0,i.push(r);return i},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,s.PI/2),t},generate:function(e){e=e||{},this.size=void 0===e.size?this.size:e.size;var t,r,n,i=Math.ceil(this.size/2);for(t=-i;i>t;t++)for(r=-i;i>r;r++)n=new s.Cell(t,r+1),this.add(n)},generateOverlay:function(e,t,r){var n,i,a=Math.ceil(e/2);for(n=-a;a>n;n++)for(i=-a;a>i;i++){this._cel.set(n,i);var o=new THREE.Line(this.cellGeo,r);o.position.copy(this.cellToPixel(this._cel)),o.rotation.x=90*s.DEG_TO_RAD,t.add(o)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,r){s.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(r||null,e)},cache:!1,scope:this})},fromJSON:function(e){var t,r,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(r=new s.Cell).copy(n[t]),this.add(r)},toJSON:function(){var e,t,r={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return r.cells=n,r}},s.SqrGrid.prototype.constructor=s.SqrGrid,s.Tile=function(e){e=e||{};var t={cell:null,geometry:null,material:null};if(!(t=s.Tools.merge(t,e)).cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=s.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:s.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=s.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*s.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},s.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},s.Tile.prototype.constructor=s.Tile,n=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},(i=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}).generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},(i.prototype={getNode:function(e){return this.objToNodeMap[e.uniqueID]},addNode:function(e){var t=new n;if(!e.uniqueID)try{e.uniqueID=i.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return t.obj=e,t.free=!1,this.objToNodeMap[e.uniqueID]=t,t},swapObjects:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t},add:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(e){return!!this.objToNodeMap[e.uniqueID]},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prev){var r=t.prev,n=r.prev;t==this.last&&(this.last=r);var i=t.next;n&&(n.next=t),t.next=r,t.prev=r.prev,r.next=i,r.prev=t,this.first==r&&(this.first=t)}},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var r=t.next;this.moveUp(r.obj),this.last==r&&(this.last=t)}},sort:function(e){var t,r,n=this.sortArray,i=this.first;for(n.length=0;i;)n.push(i.obj),i=i.next;for(this.clear(),n.sort(e),r=n.length,t=0;r>t;t++)this.add(n[t])},remove:function(e){var t=this.getNode(e);return!(!t||t.free||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,0))},shift:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},pop:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},concat:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next},clear:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0},dispose:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null},dump:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=i,s.LinkedList=i,function(){var e=function(e,t,r,n,i){this._listener=t,this.isOnce=r,this.context=n,this.signal=e,this._priority=i||0};(e.prototype={active:!0,params:null,execute:function(e){var t,r;return this.active&&this._listener&&(r=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,r),this.isOnce&&this.detach()),t},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}).constructor=e;var t=function e(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.prototype.dispatch.apply(t,arguments)}};(t.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(t,r,n,i){var a,o=this._indexOfListener(t,n);if(-1!==o){if((a=this._bindings[o]).isOnce!==r)throw new Error("You cannot add"+(r?"":"Once")+"() then add"+(r?"Once":"")+"() the same listener without removing the relationship first.")}else a=new e(this,t,r,n,i),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return this.validateListener(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){this.validateListener(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var e,t=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=t),r){e=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(e[r]&&this._shouldPropagate&&!1!==e[r].execute(t))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}).constructor=t,s.Signal=t}(),s.AStarFinder=function(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=s.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new s.LinkedList},s.AStarFinder.prototype={findPath:function(e,t,r,n){var i,a,o,l,c,u;for(r=r||this.heuristicFilter,n.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(i=this.list.shift())._visited=!0,i===t)return s.PathUtil.backtrace(t);for(c=0,u=(o=n.getNeighbors(i,this.allowDiagonal,r)).length;u>c;c++)if((l=o[c]).walkable&&(a=i._calcCost+n.distance(i,l),!l._visited||a<l._calcCost)){if(l._visited=!0,l._parent=i,l._calcCost=a,l._priority=a+n.distance(t,l),l===t)return s.PathUtil.backtrace(t);this.list.add(l)}}return null},compare:function(e,t){return e._priority-t._priority}},s.AStarFinder.prototype.constructor=s.AStarFinder,s.PathUtil={backtrace:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()},biBacktrace:function(e,t){var r=this.backtrace(e),n=this.backtrace(t);return r.concat(n.reverse())},pathLength:function(e){var t,r,n,i,a,o=0;for(t=1;t<e.length;++t)r=e[t-1],n=e[t],i=r[0]-n[0],a=r[1]-n[1],o+=Math.sqrt(i*i+a*a);return o},interpolate:function(e,t,r,n){var i,a,o,s,l,c,u=Math.abs,d=[];for(i=r>e?1:-1,a=n>t?1:-1,l=(o=u(r-e))-(s=u(n-t));e!==r||t!==n;)d.push([e,t]),(c=2*l)>-s&&(l-=s,e+=i),o>c&&(l+=o,t+=a);return d},expandPath:function(e){var t,r,n,i,a,o,s=[],l=e.length;if(2>l)return s;for(a=0;l-1>a;++a)for(t=e[a],r=e[a+1],i=(n=this.interpolate(t[0],t[1],r[0],r[1])).length,o=0;i-1>o;++o)s.push(n[o]);return s.push(e[l-1]),s},smoothenPath:function(e,t){var r,n,i,a,o,s,l,c,u,d,h,f,p=t.length,m=t[0][0],v=t[0][1],g=t[p-1][0],y=t[p-1][1];for(o=[[r=m,n=v]],l=2;p>l;++l){for(i=(u=t[l])[0],a=u[1],d=this.interpolate(r,n,i,a),f=!1,c=1;c<d.length;++c)if(h=d[c],!e.isWalkableAt(h[0],h[1])){f=!0;break}f&&(s=t[l-1],o.push(s),r=s[0],n=s[1])}return o.push([g,y]),o},compressPath:function(e){if(e.length<3)return e;var t,r,n,i,a,o,s=[],l=e[0][0],c=e[0][1],u=e[1][0],d=e[1][1],h=u-l,f=d-c;for(h/=a=Math.sqrt(h*h+f*f),f/=a,s.push([l,c]),o=2;o<e.length;o++)t=u,r=d,n=h,i=f,h=(u=e[o][0])-t,f=(d=e[o][1])-r,f/=a=Math.sqrt(h*h+f*f),((h/=a)!==n||f!==i)&&s.push([t,r]);return s.push([u,d]),s}},s.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new THREE.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,r,n){var i=new THREE.Texture(null,t);return this.imageLoader.load(e,(function(e){i.image=e,i.needsUpdate=!0,r&&r(i)}),null,(function(e){n&&n(e)})),i.sourceFile=e,i}},s.MouseCaster=function(e,t,r){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new s.Signal,this.group=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(r=r||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),r.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),r.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),r.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),r.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},s.MouseCaster.OVER="over",s.MouseCaster.OUT="out",s.MouseCaster.DOWN="down",s.MouseCaster.UP="up",s.MouseCaster.CLICK="click",s.MouseCaster.WHEEL="wheel",s.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,r=this._raycaster.intersectObject(this.group,!0);r.length>0?(t=(e=r[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch(s.MouseCaster.OUT,this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch(s.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(s.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=r}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(e){return(e=e||window.event).preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,void this.signal.dispatch(s.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(e){return e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch(s.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(s.MouseCaster.CLICK,this.pickedObject),this.down=1!==e.which&&this.down,void(this.rightDown=3!==e.which&&this.rightDown))},_onDocumentMouseMove:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1},_onMouseWheel:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch(s.MouseCaster.WHEEL,this.wheel)}}},s.MouseCaster.prototype.constructor=s.MouseCaster,s.Scene=function(e,t){var r={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},n={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(r=s.Tools.merge(r,e),"boolean"!=typeof t&&(n=s.Tools.merge(n,t)),this.renderer=new THREE.WebGLRenderer({alpha:r.alpha,antialias:r.antialias}),this.renderer.setClearColor(r.clearColor,0),this.renderer.sortObjects=r.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=r.orthoZoom,this.container=new THREE.Scene,this.container.fog=r.fog,this.container.add(new THREE.AmbientLight(14540253)),r.lightPosition||r.light.position.set(-1,1,-1).normalize(),this.container.add(r.light),"OrthographicCamera"===r.cameraType){var i=window.innerWidth/this.orthoZoom,a=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(i/-2,i/2,a/2,a/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=n.minDistance,this.controls.maxDistance=n.maxDistance,this.controls.zoomSpeed=n.zoomSpeed,this.controls.noZoom=n.noZoom),r.cameraPosition&&this.camera.position.copy(r.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(r.element)},s.Scene.prototype={attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}},focusOn:function(e){this.camera.lookAt(e.position)}},s.Scene.prototype.constructor=s.Scene,s.SelectionManager=function(e){this.mouse=e,this.onSelect=new s.Signal,this.onDeselect=new s.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},s.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case s.MouseCaster.DOWN:t||this.clearSelection();break;case s.MouseCaster.CLICK:this.select(t)}}},s.SelectionManager.prototype.constructor=s.SelectionManager,s.Tools={clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,r){return(e-t)/(r-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!=(void 0===e?"undefined":o(e))||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var r=this,n=Array.isArray(t),i=n&&[]||{};return n?(e=e||[],i=i.concat(e),t.forEach((function(t,n){void 0===i[n]?i[n]=t:r.isPlainObject(t)?i[n]=r.merge(e[n],t):-1===e.indexOf(t)&&i.push(t)})),i):(e&&r.isPlainObject(e)&&Object.keys(e).forEach((function(t){i[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&r.isPlainObject(t[n])&&e[n]?i[n]=r.merge(e[n],t[n]):i[n]=t[n]})),i)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,r,n){if(n=n||31,!((t=t||0)>=(r=r||e.length)-1||0>n)){for(var i=t,a=r,o=1<<n;a>i;)if(e[i]&o){--a;var s=e[i];e[i]=e[a],e[a]=s}else++i;this.radixSort(e,t,a,n-1),this.radixSort(e,a,r,n-1)}},randomizeRGB:function(e,t){var r,n,i=e.split(","),a="rgb(";for(t=this.randomInt(t),r=0;3>r;r++)0>(n=parseInt(i[r])+t)?n=0:n>255&&(n=255),a+=n+",";return(a=a.substring(0,a.length-1))+")"},getJSON:function(e){var t=new XMLHttpRequest,r=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",r,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}}},{}],10:[function(e,t,r){"use strict";!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var r=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,i=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,a=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function o(e,t){return-1!==String(e).indexOf(t)}var s=o(navigator.platform,"Win")?"win":o(navigator.platform,"Mac")?"mac":o(navigator.platform,"CrOS")?"cros":o(navigator.platform,"Linux")?"linux":o(navigator.userAgent,"iPad")||o(navigator.platform,"iPod")||o(navigator.platform,"iPhone")?"ios":"",l=o(navigator.userAgent,"Chrome/")?"chrome":o(navigator.vendor,"Apple")?"safari":o(navigator.userAgent,"MSIE")?"ie":o(navigator.userAgent,"Gecko/")?"moz":o(navigator.userAgent,"Opera/")?"opera":"",c=l+"-"+s;function u(e,t,r){c!==t&&l!==t&&s!==t||Object.keys(r).forEach((function(t){e[t]=r[t]}))}var d={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:i},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:a},97:{code:"Numpad1",keyCap:"1",location:a},98:{code:"Numpad2",keyCap:"2",location:a},99:{code:"Numpad3",keyCap:"3",location:a},100:{code:"Numpad4",keyCap:"4",location:a},101:{code:"Numpad5",keyCap:"5",location:a},102:{code:"Numpad6",keyCap:"6",location:a},103:{code:"Numpad7",keyCap:"7",location:a},104:{code:"Numpad8",keyCap:"8",location:a},105:{code:"Numpad9",keyCap:"9",location:a},106:{code:"NumpadMultiply",keyCap:"*",location:a},107:{code:"NumpadAdd",keyCap:"+",location:a},108:{code:"NumpadComma",keyCap:",",location:a},109:{code:"NumpadSubtract",keyCap:"-",location:a},110:{code:"NumpadDecimal",keyCap:".",location:a},111:{code:"NumpadDivide",keyCap:"/",location:a},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:a},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:i},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:i},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:i},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};u(d,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:a},189:{code:"NumpadSubtract",keyCap:"-",location:a}}),u(d,"moz-mac",{12:{code:"NumLock",location:a},173:{code:"Minus",keyCap:"-"}}),u(d,"moz-win",{173:{code:"Minus",keyCap:"-"}}),u(d,"chrome-mac",{93:{code:"OSRight",location:i}}),u(d,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),u(d,"ios",{10:{code:"Enter",location:r}}),u(d,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:i},229:{code:"KeyQ",keyCap:"Q"}});var h={};"cros"===s&&(h["U+00A0"]={code:"ShiftLeft",location:n},h["U+00A1"]={code:"ShiftRight",location:i},h["U+00A2"]={code:"ControlLeft",location:n},h["U+00A3"]={code:"ControlRight",location:i},h["U+00A4"]={code:"AltLeft",location:n},h["U+00A5"]={code:"AltRight",location:i}),"chrome-mac"===c&&(h["U+0010"]={code:"ContextMenu"}),"safari-mac"===c&&(h["U+0010"]={code:"ContextMenu"}),"ios"===s&&(h["U+0010"]={code:"Function"},h["U+001C"]={code:"ArrowLeft"},h["U+001D"]={code:"ArrowRight"},h["U+001E"]={code:"ArrowUp"},h["U+001F"]={code:"ArrowDown"},h["U+0001"]={code:"Home"},h["U+0004"]={code:"End"},h["U+000B"]={code:"PageUp"},h["U+000C"]={code:"PageDown"});var f=[];f[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},f[i]={16:{code:"ShiftRight",location:i},17:{code:"ControlRight",location:i},18:{code:"AltRight",location:i}},f[a]={13:{code:"NumpadEnter",location:a}},u(f[a],"moz",{109:{code:"NumpadSubtract",location:a},107:{code:"NumpadAdd",location:a}}),u(f[n],"moz-mac",{224:{code:"OSLeft",location:n}}),u(f[i],"moz-mac",{224:{code:"OSRight",location:i}}),u(f[i],"moz-win",{91:{code:"OSRight",location:i}}),u(f[i],"mac",{93:{code:"OSRight",location:i}}),u(f[a],"chrome-mac",{12:{code:"NumLock",location:a}}),u(f[a],"safari-mac",{12:{code:"NumLock",location:a},187:{code:"NumpadAdd",location:a},189:{code:"NumpadSubtract",location:a},190:{code:"NumpadDecimal",location:a},191:{code:"NumpadDivide",location:a}});var p={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};u(p,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},v=function(e,t){var r={};return Object.keys(e).forEach((function(n){var i=e[n];t in i&&(r[i[t]]=i)})),r}(d,"code");try{var g=t&&"location"in new KeyboardEvent("")}catch(e){}function y(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,r=function(){if(g||"keyLocation"in e){var r=g?e.location:e.keyLocation;if(r&&t in f[r])return f[r][t]}return"keyIdentifier"in e&&e.keyIdentifier in h?h[e.keyIdentifier]:t in d?d[t]:null}();if(!r)return null;var n,i=(n=p[r.code])?e.shiftKey&&"shiftKey"in n?n.shiftKey:n.key:r.code;return{code:r.code,key:i,location:r.location,keyCap:r.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,r){t in e||Object.defineProperty(e,t,r)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=y(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return m.hasOwnProperty(e)?m[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=y(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=y(this);return e&&"location"in e?e.location:r}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!v.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var r=v[e];return r.keyCap||r.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=y(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:r,e.locale=""}}}(window)},{}],11:[function(e,t,r){var n=function(){};n.computeCentroids=function(e){var t,r,n;for(t=0,r=e.faces.length;t<r;t++)(n=e.faces[t]).centroid=new THREE.Vector3(0,0,0),n.centroid.add(e.vertices[n.a]),n.centroid.add(e.vertices[n.b]),n.centroid.add(e.vertices[n.c]),n.centroid.divideScalar(3)},n.roundNumber=function(e,t){return Number(e.toFixed(t))},n.sample=function(e){return e[Math.floor(Math.random()*e.length)]},n.mergeVertexIds=function(e,t){var r=[];if(e.forEach((function(e){t.indexOf(e)>=0&&r.push(e)})),r.length<2)return[];r.includes(e[0])&&r.includes(e[e.length-1])&&e.push(e.shift()),r.includes(t[0])&&r.includes(t[t.length-1])&&t.push(t.shift()),r=[],e.forEach((function(e){t.includes(e)&&r.push(e)}));for(var n=r[1],i=r[0],a=e.slice();a[0]!==n;)a.push(a.shift());for(var o=0,s=t.slice();s[0]!==i;)if(s.push(s.shift()),o++>10)throw new Error("Unexpected state");return s.shift(),s.pop(),a.concat(s)},n.setPolygonCentroid=function(e,t){var r=new THREE.Vector3,n=t.vertices;e.vertexIds.forEach((function(e){r.add(n[e])})),r.divideScalar(e.vertexIds.length),e.centroid.copy(r)},n.cleanPolygon=function(e,t){for(var r=[],n=t.vertices,i=0;i<e.vertexIds.length;i++){var a,o,s,l=n[e.vertexIds[i]];0===i?(a=e.vertexIds[1],o=e.vertexIds[e.vertexIds.length-1]):i===e.vertexIds.length-1?(a=e.vertexIds[0],o=e.vertexIds[e.vertexIds.length-2]):(a=e.vertexIds[i+1],o=e.vertexIds[i-1]),s=n[o];var c=n[a].clone().sub(l),u=s.clone().sub(l),d=c.angleTo(u);if(d>Math.PI-.01&&d<Math.PI+.01){var h=[];e.neighbours.forEach((function(t){t.vertexIds.includes(e.vertexIds[i])||h.push(t)})),e.neighbours=h}else r.push(e.vertexIds[i])}e.vertexIds=r,this.setPolygonCentroid(e,t)},n.isConvex=function(e,t){var r=t.vertices;if(e.vertexIds.length<3)return!1;for(var n=!0,i=[],a=0;a<e.vertexIds.length;a++){var o,s,l=r[e.vertexIds[a]];0===a?(o=r[e.vertexIds[1]],s=r[e.vertexIds[e.vertexIds.length-1]]):a===e.vertexIds.length-1?(o=r[e.vertexIds[0]],s=r[e.vertexIds[e.vertexIds.length-2]]):(o=r[e.vertexIds[a+1]],s=r[e.vertexIds[a-1]]);var c=o.clone().sub(l),u=s.clone().sub(l),d=c.angleTo(u);if(d===Math.PI||0===d)return!1;var h=c.cross(u).y;i.push(h)}return i.forEach((function(e){0===e&&(n=!1)})),i.forEach(i[0]>0?function(e){e<0&&(n=!1)}:function(e){e>0&&(n=!1)}),n},n.distanceToSquared=function(e,t){var r=e.x-t.x,n=e.y-t.y,i=e.z-t.z;return r*r+n*n+i*i},n.isPointInPoly=function(e,t){for(var r=!1,n=-1,i=e.length,a=i-1;++n<i;a=n)(e[n].z<=t.z&&t.z<e[a].z||e[a].z<=t.z&&t.z<e[n].z)&&t.x<(e[a].x-e[n].x)*(t.z-e[n].z)/(e[a].z-e[n].z)+e[n].x&&(r=!r);return r},n.isVectorInPolygon=function(e,t,r){var n=1e5,i=-1e5,a=[];return t.vertexIds.forEach((function(e){n=Math.min(r[e].y,n),i=Math.max(r[e].y,i),a.push(r[e])})),!!(e.y<i+.5&&e.y>n-.5&&this.isPointInPoly(a,e))},n.triarea2=function(e,t,r){return(r.x-e.x)*(t.z-e.z)-(t.x-e.x)*(r.z-e.z)},n.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5};var i=function(e){this.content=[],this.scoreFunction=e};i.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},i.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},i.prototype.remove=function(e){var t=this.content.indexOf(e),r=this.content.pop();t!==this.content.length-1&&(this.content[t]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},i.prototype.size=function(){return this.content.length},i.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},i.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var r=(e+1>>1)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},i.prototype.bubbleUp=function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=e+1<<1,a=i-1,o=null,s=void 0;if(a<t&&(s=this.scoreFunction(this.content[a]))<n&&(o=a),i<t&&this.scoreFunction(this.content[i])<(null===o?n:s)&&(o=i),null===o)break;this.content[e]=this.content[o],this.content[o]=r,e=o}};var a=function(){};a.init=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.f=0,r.g=0,r.h=0,r.cost=1,r.visited=!1,r.closed=!1,r.parent=null}},a.cleanUp=function(e){for(var t=0;t<e.length;t++){var r=e[t];delete r.f,delete r.g,delete r.h,delete r.cost,delete r.visited,delete r.closed,delete r.parent}},a.heap=function(){return new i((function(e){return e.f}))},a.search=function(e,t,r){this.init(e);var n=this.heap();for(n.push(t);n.size()>0;){var i=n.pop();if(i===r){for(var a=i,o=[];a.parent;)o.push(a),a=a.parent;return this.cleanUp(o),o.reverse()}i.closed=!0;for(var s=this.neighbours(e,i),l=0,c=s.length;l<c;l++){var u=s[l];if(!u.closed){var d=i.g+u.cost,h=u.visited;if(!h||d<u.g){if(u.visited=!0,u.parent=i,!u.centroid||!r.centroid)throw new Error("Unexpected state");u.h=u.h||this.heuristic(u.centroid,r.centroid),u.g=d,u.f=u.g+u.h,h?n.rescoreElement(u):n.push(u)}}}}return[]},a.heuristic=function(e,t){return n.distanceToSquared(e,t)},a.neighbours=function(e,t){for(var r=[],n=0;n<t.neighbours.length;n++)r.push(e[t.neighbours[n]]);return r};var o=1,s=function(){};s.buildZone=function(e){var t=this,r=this._buildNavigationMesh(e),i={};r.vertices.forEach((function(e){e.x=n.roundNumber(e.x,2),e.y=n.roundNumber(e.y,2),e.z=n.roundNumber(e.z,2)})),i.vertices=r.vertices;var a=this._buildPolygonGroups(r);i.groups=[];var o=function(e,t){for(var r=0;r<e.length;r++)if(t===e[r])return r};return a.forEach((function(e){var r=[];e.forEach((function(i){var a=i.neighbours.map((function(t){return o(e,t)})),s=i.neighbours.map((function(e){return t._getSharedVerticesInOrder(i,e)}));i.centroid.x=n.roundNumber(i.centroid.x,2),i.centroid.y=n.roundNumber(i.centroid.y,2),i.centroid.z=n.roundNumber(i.centroid.z,2),r.push({id:o(e,i),neighbours:a,vertexIds:i.vertexIds,centroid:i.centroid,portals:s})})),i.groups.push(r)})),i},s._buildNavigationMesh=function(e){return n.computeCentroids(e),e.mergeVertices(),this._buildPolygonsFromGeometry(e)},s._buildPolygonGroups=function(e){var t=[],r=0,n=function(e){e.neighbours.forEach((function(t){void 0===t.group&&(t.group=e.group,n(t))}))};return e.polygons.forEach((function(e){void 0===e.group&&(e.group=r++,n(e)),t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),t},s._buildPolygonNeighbours=function(e,t,r){var n=new Set,i=r.get(e.vertexIds[0]),a=r.get(e.vertexIds[1]),o=r.get(e.vertexIds[2]);i.forEach((function(e){(a.has(e)||o.has(e))&&n.add(t.polygons[e])})),a.forEach((function(e){o.has(e)&&n.add(t.polygons[e])})),e.neighbours=Array.from(n)},s._buildPolygonsFromGeometry=function(e){for(var t=this,r=[],n=e.vertices,i=e.faceVertexUvs,a=new Map,s=0;s<n.length;s++)a.set(s,new Set);e.faces.forEach((function(e){r.push({id:o++,vertexIds:[e.a,e.b,e.c],centroid:e.centroid,normal:e.normal,neighbours:[]}),a.get(e.a).add(r.length-1),a.get(e.b).add(r.length-1),a.get(e.c).add(r.length-1)}));var l={polygons:r,vertices:n,faceVertexUvs:i};return r.forEach((function(e){t._buildPolygonNeighbours(e,l,a)})),l},s._getSharedVerticesInOrder=function(e,t){var r=e.vertexIds,n=t.vertexIds,i=new Set;if(r.forEach((function(e){n.includes(e)&&i.add(e)})),i.size<2)return[];i.has(r[0])&&i.has(r[r.length-1])&&r.push(r.shift()),i.has(n[0])&&i.has(n[n.length-1])&&n.push(n.shift());var a=[];return r.forEach((function(e){n.includes(e)&&a.push(e)})),a};var l=function(){this.portals=[]};l.prototype.push=function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})},l.prototype.stringPull=function(){var e,t,r,i=this.portals,a=[],o=0,s=0,l=0;t=i[0].left,r=i[0].right,a.push(e=i[0].left);for(var c=1;c<i.length;c++){var u=i[c].left,d=i[c].right;if(n.triarea2(e,r,d)<=0){if(!(n.vequal(e,r)||n.triarea2(e,t,d)>0)){a.push(t),t=e=t,r=e,s=o=s,l=o,c=o;continue}r=d,l=c}if(n.triarea2(e,t,u)>=0){if(!(n.vequal(e,t)||n.triarea2(e,r,u)<0)){a.push(r),t=e=r,r=e,s=o=l,l=o,c=o;continue}t=u,s=c}}return 0!==a.length&&n.vequal(a[a.length-1],i[i.length-1].left)||a.push(i[i.length-1].left),this.path=a,a};var c,u,d,h,f,p,m=function(){this.zones={}};m.createZone=function(e){return s.buildZone(e)},m.prototype.setZoneData=function(e,t){this.zones[e]=t},m.prototype.getGroup=function(e,t){if(!this.zones[e])return null;var r=null,i=Math.pow(50,2);return this.zones[e].groups.forEach((function(e,a){e.forEach((function(e){var o=n.distanceToSquared(e.centroid,t);o<i&&(r=a,i=o)}))})),r},m.prototype.getRandomNode=function(e,t,r,i){if(!this.zones[e])return new THREE.Vector3;r=r||null,i=i||0;var a=[];return this.zones[e].groups[t].forEach((function(e){r&&i?n.distanceToSquared(r,e.centroid)<i*i&&a.push(e.centroid):a.push(e.centroid)})),n.sample(a)||new THREE.Vector3},m.prototype.getClosestNode=function(e,t,r,i){void 0===i&&(i=!1);var a=this.zones[t].vertices,o=null,s=1/0;return this.zones[t].groups[r].forEach((function(t){var r=n.distanceToSquared(t.centroid,e);r<s&&(!i||n.isVectorInPolygon(e,t,a))&&(o=t,s=r)})),o},m.prototype.findPath=function(e,t,r,n){var i=this.zones[r].groups[n],o=this.zones[r].vertices,s=this.getClosestNode(e,r,n),c=this.getClosestNode(t,r,n,!0);if(!s||!c)return null;var u=a.search(i,s,c),d=function(e,t){for(var r=0;r<e.neighbours.length;r++)if(e.neighbours[r]===t.id)return e.portals[r]},h=new l;h.push(e);for(var f=0;f<u.length;f++){var p=u[f+1];if(p){var m=d(u[f],p);h.push(o[m[0]],o[m[1]])}}h.push(t),h.stringPull();var v=h.path.map((function(e){return new THREE.Vector3(e.x,e.y,e.z)}));return v.shift(),v},m.prototype.clampStep=(d=new THREE.Vector3,h=new THREE.Plane,f=new THREE.Triangle,p=new THREE.Vector3,function(e,t,r,n,i,a){var o=this.zones[n].vertices,s=this.zones[n].groups[i],l=[r],m={};m[r.id]=0,c=void 0,p.set(0,0,0),u=1/0,h.setFromCoplanarPoints(o[r.vertexIds[0]],o[r.vertexIds[1]],o[r.vertexIds[2]]),h.projectPoint(t,d),t.copy(d);for(var v=l.pop();v;v=l.pop()){f.set(o[v.vertexIds[0]],o[v.vertexIds[1]],o[v.vertexIds[2]]),f.closestPointToPoint(t,d),d.distanceToSquared(t)<u&&(c=v,p.copy(d),u=d.distanceToSquared(t));var g=m[v];if(!(g>2))for(var y=0;y<v.neighbours.length;y++){var b=s[v.neighbours[y]];b.id in m||(l.push(b),m[b.id]=g+1)}}return a.copy(p),c}),r.Pathfinding=m},{}],12:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){var t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(this.active){var e=this.data,t=this.offset,r=this.position,n=this.targetPosition,i=this.checkpoint;return this.sync(),r.distanceTo(n)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:i}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)}},sync:function(){var e=this.offset,t=this.position,r=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(r),r.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(r).sub(t)}})},{}],13:[function(e,t,r){"use strict";var n=e("../../lib/GamepadButton"),i=e("../../lib/GamepadButtonEvent");t.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:n,schema:{controller:{default:0,oneOf:[0,1,2,3]},enabled:{default:!0},debug:{default:!1},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){var e=this.el.sceneEl;this.prevTime=window.performance.now(),this.buttons={};var t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(t.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(t.y),this.yaw.add(this.pitch),e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getDpad(),t=this.getJoystick(0),r=e.x||t.x,n=e.y||t.y;return Math.abs(r)>.2||Math.abs(n)>.2},getVelocityDelta:function(){var e=this.getDpad(),t=this.getJoystick(0),r=e.x||t.x,n=e.y||t.y,i=new THREE.Vector3;return Math.abs(r)>.2&&(i.x+=r),Math.abs(n)>.2&&(i.z+=n),i},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this.getJoystick(1);return Math.abs(e.x)>.2||Math.abs(e.y)>.2},updateRotation:function(e){if(this.isRotationActive()){var t=this.data,r=this.yaw,n=this.pitch,i=t.camera.components["look-controls"],a=i&&i.pitchObject&&i.yawObject;a&&(n.rotation.copy(i.pitchObject.rotation),r.rotation.copy(i.yawObject.rotation));var o=this.getJoystick(1);Math.abs(o.x)<=.2&&(o.x=0),Math.abs(o.y)<=.2&&(o.y=0),o.multiplyScalar(t.rotationSensitivity*e/1e3),r.rotation.y-=o.x,n.rotation.x-=o.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),t.camera.object3D.rotation.set(n.rotation.x,r.rotation.y,0),a&&(i.pitchObject.rotation.copy(n.rotation),i.yawObject.rotation.copy(r.rotation))}},updateButtonState:function(){var e=this.getGamepad();if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new i("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new i("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new i(e.type,e.index,e))},getGamepad:function(){var e=navigator.getGamepads&&navigator.getGamepads()[this.data.controller],t=this.el.sceneEl.components["proxy-controls"];return t&&t.isConnected()&&t.getGamepad(this.data.controller)||e},getButton:function(e){return this.getGamepad().buttons[e]},getAxis:function(e){return this.getGamepad().axes[e]},getJoystick:function(e){var t=this.getGamepad();switch(e){case 0:return new THREE.Vector2(t.axes[0],t.axes[1]);case 1:return new THREE.Vector2(t.axes[2],t.axes[3]);default:throw new Error('Unexpected joystick index "%d".',e)}},getDpad:function(){var e=this.getGamepad();return e.buttons[n.DPAD_RIGHT]?new THREE.Vector2((e.buttons[n.DPAD_RIGHT].pressed?1:0)+(e.buttons[n.DPAD_LEFT].pressed?-1:0),(e.buttons[n.DPAD_UP].pressed?-1:0)+(e.buttons[n.DPAD_DOWN].pressed?1:0)):new THREE.Vector2},isConnected:function(){var e=this.getGamepad();return!(!e||!e.connected)},getID:function(){return this.getGamepad().id}})},{"../../lib/GamepadButton":5,"../../lib/GamepadButtonEvent":6}],14:[function(e,t,r){"use strict";e("./checkpoint-controls"),e("./gamepad-controls"),e("./keyboard-controls"),e("./touch-controls"),e("./movement-controls"),e("./trackpad-controls")},{"./checkpoint-controls":12,"./gamepad-controls":13,"./keyboard-controls":15,"./movement-controls":16,"./touch-controls":17,"./trackpad-controls":18}],15:[function(e,t,r){"use strict";e("../../lib/keyboard.polyfill");var n=window.KeyboardEvent;t.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){var e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(var e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){var e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},{"../../lib/keyboard.polyfill":10}],16:[function(e,t,r){"use strict";var n,i,a,o,s;t.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){var e=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){var t=this.el,r=this.data,n=t.sceneEl.systems.nav;t.sceneEl.hasLoaded&&this.injectControls(),n&&r.constrainToNavMesh!==e.constrainToNavMesh&&(r.constrainToNavMesh?n.addAgent(this):n.removeAgent(this))},injectControls:function(){for(var e,t=this.data,r=0;r<t.controls.length;r++)e=t.controls[r]+"-controls",this.el.components[e]||this.el.setAttribute(e,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:(a=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,function(e,t){if(t){var r=this.el,n=this.data;if(n.enabled){this.updateVelocityCtrl();var i=this.velocityCtrl,l=this.velocity;if(i)if(t/1e3>.2?l.set(0,0,0):this.updateVelocity(t),n.constrainToNavMesh&&!1!==i.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;a.copy(r.object3D.position),o.copy(l).multiplyScalar(t/1e3).add(a);var c=r.sceneEl.systems.nav;this.navGroup=null===this.navGroup?c.getGroup(a):this.navGroup,this.navNode=this.navNode||c.getNode(a,this.navGroup),this.navNode=c.clampStep(a,o,this.navGroup,this.navNode,s),r.object3D.position.copy(s)}else r.hasAttribute("velocity")?r.setAttribute("velocity",l):(r.object3D.position.x+=l.x*t/1e3,r.object3D.position.y+=l.y*t/1e3,r.object3D.position.z+=l.z*t/1e3)}}}),updateVelocityCtrl:function(){var e=this.data;if(e.enabled){for(var t=0,r=e.controls.length;t<r;t++){var n=this.el.components[e.controls[t]+"-controls"];if(n&&n.isVelocityActive())return void(this.velocityCtrl=n)}this.velocityCtrl=null}},updateVelocity:(n=new THREE.Vector2,i=new THREE.Quaternion,function(e){var t=void 0,r=this.el,a=this.velocityCtrl,o=this.velocity,s=this.data;if(a){if(!a.getVelocityDelta){if(a.getVelocity)return void o.copy(a.getVelocity());if(a.getPositionDelta)return void o.copy(a.getPositionDelta(e).multiplyScalar(1e3/e));throw new Error("Incompatible movement controls: ",a)}t=a.getVelocityDelta(e)}if(r.hasAttribute("velocity")&&!s.constrainToNavMesh&&o.copy(this.el.getAttribute("velocity")),t&&s.enabled){var l=s.camera;i.copy(l.object3D.quaternion),i.premultiply(r.object3D.quaternion),t.applyQuaternion(i);var c=t.length();s.fly?(o.copy(t),o.multiplyScalar(16.66667*this.data.speed)):(n.set(t.x,t.z),n.setLength(c*this.data.speed*16.66667),o.x=n.x,o.z=n.y)}})})},{}],17:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd)):e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()}})},{}],18:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){var e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){var t=this.data,r=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=r[0],this.startingAxisData[1]=r[1]),this.startingAxisData.length>0){var n=0,i=0;t.enableNegX&&r[0]<this.startingAxisData[0]&&(n=-1),t.enablePosX&&r[0]>this.startingAxisData[0]&&(n=1),t.enablePosZ&&r[1]>this.startingAxisData[1]&&(i=-1),t.enableNegZ&&r[1]<this.startingAxisData[1]&&(i=1);var a=Math.abs(this.startingAxisData[1]-r[1]);Math.abs(this.startingAxisData[0]-r[0])>a?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=i,this.isMoving=!0)}},handleTouchAxis:function(e){var t=this.data,r=e.detail.axis,n=0,i=0;t.enableNegX&&r[0]<0&&(n=-1),t.enablePosX&&r[0]>0&&(n=1),t.enablePosZ&&r[1]>0&&(i=-1),t.enableNegZ&&r[1]<0&&(i=1),Math.abs(r[0])>Math.abs(r[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=i)}})},{}],19:[function(e,t,r){"use strict";var n={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function i(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}t.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(n)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){var e=this;this.model=null,this.mixer=null,this.activeActions=[];var t=this.el.getObject3D("mesh");t?this.load(t):this.el.addEventListener("model-loaded",(function(t){e.load(t.detail.model)}))},load:function(e){if(this.el==e.el){var t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(function(e){t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(function(e){t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})}},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(e){var t=this.data,r=AFRAME.utils.diff(t,e);if("clip"in r)return this.stopAction(),void(t.clip&&this.playAction());this.activeActions.forEach((function(e){"duration"in r&&t.duration&&e.setDuration(t.duration),"clampWhenFinished"in r&&(e.clampWhenFinished=t.clampWhenFinished),("loop"in r||"repetitions"in r)&&e.setLoop(n[t.loop],t.repetitions),"timeScale"in r&&e.setEffectiveTimeScale(t.timeScale)}))}},stopAction:function(){for(var e=this.data,t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(this.mixer){var e=this.model,t=this.data,r=e.animations||(e.geometry||{}).animations||[];if(r.length)for(var a,o,s=(a=t.clip,new RegExp("^"+a.split(/\*+/).map(i).join(".*")+"$")),l=0;o=r[l];l++)if(o.name.match(s)){var c=this.mixer.clipAction(o,e);c.enabled=!0,c.clampWhenFinished=t.clampWhenFinished,t.duration&&c.setDuration(t.duration),1!==t.timeScale&&c.setEffectiveTimeScale(t.timeScale),c.setLoop(n[t.loop],t.repetitions).fadeIn(t.crossFadeDuration).play(),this.activeActions.push(c)}}},tick:function(e,t){if(this.mixer&&!isNaN(t)){if(this.mixer.update(t/1e3),!this.mixer._actions[0])return;if(this.model.animationSlices&&this.model.animationSlices[0].uid){for(let e=1;e<this.model.animationSlices.length;e++)if(this.model.animationSlices[0].uid==this.model.animationSlices[e].uid)var r=e;if(this.model.animationSlices[r]&&(this.model.animationSlices[0].changed&&(this.mixer._actions[0].time=this.model.animationSlices[r].startTime,this.model.animationSlices[0].changed=!1),this.mixer._actions[0].time>this.model.animationSlices[r].endTime))if(this.model.animationSlices[0].uid==this.model.animationSlices[0].idle)this.mixer._actions[0].time=this.model.animationSlices[r].startTime;else{this.model.animationSlices[0].uid=this.model.animationSlices[0].idle;for(let e=1;e<this.model.animationSlices.length;e++)this.model.animationSlices[0].uid==this.model.animationSlices[e].uid&&(r=e,this.model.el.setAttribute("animation-mixer","clip: "+this.model.animationSlices[e].animationName));this.mixer._actions[0].time=this.model.animationSlices[r].startTime}}}}})},{}],20:[function(e,t,r){"use strict";THREE.ColladaLoader=e("../../lib/ColladaLoader"),t.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,r=this.data,n=this.el.sceneEl.systems.renderer;r&&(this.remove(),this.loader.load(r,(function(r){e.model=r.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/ColladaLoader":3}],21:[function(e,t,r){"use strict";THREE.FBXLoader=e("../../lib/FBXLoader"),t.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this.data;if(e.src){this.remove();var t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))}},load:function(e){let t=new THREE.Vector3(1,1,1);!function(e,t){if(e["LastSaved|ApplicationName"])switch(e["LastSaved|ApplicationName"].value){case"3ds Max":e.OriginalUnitScaleFactor?t.multiplyScalar(e.OriginalUnitScaleFactor):t.multiplyScalar(100);break;case"Maya":e.OriginalUnitScaleFactor&&t.multiplyScalar(e.OriginalUnitScaleFactor)}}(e,t),e.scale.copy(t.multiplyScalar(.01)),this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/FBXLoader":4}],22:[function(e,t,r){"use strict";var n,i=e("../../lib/fetch-script")(),a=(n=void 0,function(){return n=n||i("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")});t.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){var e=this;this.model=null,this.loader=null,this.loaderPromise=a().then((function(){e.loader=new THREE.GLTFLoader,e.loader.setCrossOrigin("Anonymous")}))},update:function(){var e=this,t=this,r=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then((function(){e.loader.load(n,(function(e){t.model=e.scene,t.model.animations=e.animations,r.setObject3D("mesh",t.model),r.emit("model-loaded",{format:"gltf",model:t.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/fetch-script":8}],23:[function(e,t,r){"use strict";e("./animation-mixer"),e("./collada-model-legacy"),e("./fbx-model"),e("./gltf-model-legacy"),e("./object-model")},{"./animation-mixer":19,"./collada-model-legacy":20,"./fbx-model":21,"./gltf-model-legacy":22,"./object-model":24}],24:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this,t=void 0,r=this.data;r.src&&(this.remove(),t=new THREE.ObjectLoader,r.crossorigin&&t.setCrossOrigin(r.crossorigin),t.load(r.src,(function(t){t.traverse((function(e){e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),e.load(t)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{}],25:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){var e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},{}],26:[function(e,t,r){"use strict";function n(e,t,r,n){e&&(t=t||[],e.traverse((function(e){var i;e.isMesh&&((i=e.material)?Array.isArray(i)?i:i.materials?i.materials:[i]:[]).forEach((function(e){(!e||"envMap"in e)&&(t.length&&-1===t.indexOf(e.name)||(e.envMap=r,e.reflectivity=n,e.needsUpdate=!0))}))})))}t.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){var e=this,t=this.data;this.texture=(new THREE.CubeTextureLoader).load([t.path+"posx."+t.extension,t.path+"negx."+t.extension,t.path+"posy."+t.extension,t.path+"negy."+t.extension,t.path+"posz."+t.extension,t.path+"negz."+t.extension]),this.texture.format=THREE[t.format],this.object3dsetHandler=function(){var t=e.el.getObject3D("mesh"),r=e.data;n(t,r.materials,e.texture,r.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){var t=this.data,r=this.el.getObject3D("mesh"),i=[],a=[];if(t.materials.length&&(e.materials?(i=t.materials.filter((function(t){return!e.materials.includes(t)})),a=e.materials.filter((function(e){return!t.materials.includes(e)}))):i=t.materials),i.length&&n(r,i,this.texture,t.reflectivity),a.length&&n(r,a,null,1),e.materials&&t.reflectivity!==e.reflectivity){var o=t.materials.filter((function(t){return e.materials.includes(t)}));o.length&&n(r,o,this.texture,t.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);var e=this.el.getObject3D("mesh"),t=this.data;n(e,t.materials,null,1),t.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},{}],27:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){var e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){var e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){var e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){var t=e.detail.el;t&&!t.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},{}],28:[function(e,t,r){"use strict";e("./checkpoint"),e("./cube-env-map"),e("./grab"),e("./jump-ability"),e("./kinematic-body"),e("./mesh-smooth"),e("./normal-material"),e("./sphere-collider")},{"./checkpoint":25,"./cube-env-map":26,"./grab":27,"./jump-ability":29,"./kinematic-body":30,"./mesh-smooth":31,"./normal-material":32,"./sphere-collider":33}],29:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;var e=this.beginJump.bind(this),t=this.data.on.split(" ");this.bindings={};for(var r=0;r<t.length;r++)this.bindings[t[r]]=e,this.el.addEventListener(t[r],e);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var e in this.bindings)this.bindings.hasOwnProperty(e)&&(this.el.removeEventListener(e,this.bindings[e]),delete this.bindings[e]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){var e=this.data,t=Math.sqrt(-2*e.distance*-24.8),r=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:r.x,y:t,z:r.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}})},{}],30:[function(e,t,r){"use strict";var n,i,a,o;t.exports=AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);var e=this.el,t=this.data,r=(new CANNON.Vec3).copy(e.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:r,mass:t.mass,linearDamping:t.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(t.radius),new CANNON.Vec3(0,t.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),e.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(e,t){if(t){var r=this.el,n=this.data,i=this.body;n.enableJumps||i.velocity.set(0,0,0),i.position.copy(r.getAttribute("position"))}},step:(n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,function(e,t){if(t){var r=this.body,s=this.data,l=void 0,c=-1/0,u=void 0,d=this.system.getContacts();t=Math.min(t,1e3*this.system.data.maxInterval),o.set(0,0,0),n.copy(this.el.getAttribute("velocity")),r.velocity.copy(n);for(var h,f=0;h=d[f];f++)if(h.enabled){if(r.id===h.bi.id)h.ni.negate(a);else{if(r.id!==h.bj.id)continue;a.copy(h.ni)}r.velocity.dot(a)<-1e-6&&a.y<=.5?n.projectOnPlane(a):a.y>.5&&(l=r.id===h.bi.id?Math.abs(h.rj.y+h.bj.position.y):Math.abs(h.ri.y+h.bi.position.y))>c&&(c=l,o.copy(a),u=r.id===h.bi.id?h.bj:h.bi)}i.copy(n).normalize(),u&&(!s.enableJumps||i.y<.5)?(s.enableSlopes?o.y<1-1e-6&&o.copy(this.raycastToGround(u,o)):o.set(0,1,0),n.projectOnPlane(o)):this.system.driver.world&&n.add(this.system.driver.world.gravity.scale(4*t/1e3)),r.velocity.copy(n),this.el.setAttribute("velocity",r.velocity),this.el.setAttribute("position",r.position)}}),raycastToGround:function(e,t){var r,n=void 0,i=this.body.position,a=this.body.position.clone();return(n=new CANNON.Ray(i,a))._updateDirection(),n.intersectBody(e),n.hasHit?(r=n.result.hitNormalWorld,Math.abs(r.y)>Math.abs(t.y)?r:t):t}})},{}],31:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",(function(e){e.detail.model.traverse((function(e){e.isMesh&&e.geometry.computeVertexNormals()}))}))}})},{}],32:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){var e=this;this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e.material)}))}})},{}],33:[function(e,t,r){"use strict";var n,i,a,o,s,l;t.exports=AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){var e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){var e=this.data,t=void 0;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:(n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Box3,l=new Map,function(){var e,t=this.el,r=this.data,c=t.getObject3D("mesh"),u=[],d=void 0;c&&(l.clear(),t.object3D.getWorldPosition(n),t.object3D.getWorldScale(a),d=r.radius*(e=a,Math.max.apply(null,e.toArray())),this.els.forEach((function(e){var t,r,a,c;e.isEntity&&(r=e.getObject3D("mesh"))&&(s.setFromObject(r).getSize(o),c=Math.max(o.x,o.y,o.z)/2,t=Math.sqrt(2*c*c),s.getCenter(i),t&&(a=n.distanceTo(i))<t+d&&(u.push(e),l.set(e,a)))})),u.sort((function(e,t){return l.get(e)>l.get(t)?1:-1})).forEach(this.handleHit),0===u.length&&t.emit("hit",{el:null}),this.collisions.filter((function(e){return!l.has(e)})).forEach(this.handleHitEnd),this.collisions=u)}),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.el.emit("hit",{el:e})},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.el.emit("hitend",{el:e})}})},{}],34:[function(e,t,r){"use strict";e("./nav-mesh"),e("./nav-agent"),e("./system")},{"./nav-agent":35,"./nav-mesh":36,"./system":37}],35:[function(e,t,r){"use strict";var n,i,a;t.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:(n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,function(e,t){var r=this.el,o=this.data,s=this.raycaster,l=o.speed*t/1e3;if(o.active){if(!this.path.length){var c=this.el.object3D.position;this.group=this.group||this.system.getGroup(c),this.path=this.system.getPath(c,n.copy(o.destination),this.group)||[],r.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",o.destination),this.el.setAttribute("nav-agent",{active:!1}),void r.emit("navigation-end");var u=r.object3D.position,d=this.path[0];i.subVectors(d,u);var h=void 0;if(i.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void r.emit("navigation-end");a.copy(u),h=this.path[0]}else a.copy(i.setLength(l)).add(u),h=d;h.y=u.y,r.object3D.lookAt(h),s.ray.origin.copy(a),s.ray.origin.y+=1.5,s.ray.direction.y=-1;var f=s.intersectObject(this.system.getNavMesh());f.length?(i.subVectors(f[0].point,u),u.add(i.setLength(l))):u.copy(a)}})})},{}],36:[function(e,t,r){"use strict";t.exports=AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this.el.getObject3D("mesh"),t=this.el.sceneEl.object3D;if(e){var r=void 0;if(e.traverse((function(e){e.isMesh&&(r=e)})),r){var n=r.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(r.geometry):r.geometry.clone();t.updateMatrixWorld(),n.applyMatrix(r.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}}})},{}],37:[function(e,t,r){"use strict";var n=e("three-pathfinding").Pathfinding,i=new n,a="level";t.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),i.setZoneData(a,n.createZone(e)),Array.from(this.agents).forEach((function(e){return e.updateNavLocation()}))},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,r){return this.navMesh?i.findPath(e,t,a,r):null},getGroup:function(e){return this.navMesh?i.getGroup(a,e):null},getNode:function(e,t){return this.navMesh?i.getClosestNode(e,a,t,!0):null},clampStep:function(e,t,r,n,o){return this.navMesh?n?i.clampStep(e,t,n,a,r,o):(o.copy(t),this.getNode(t,r)):(o.copy(t),null)}})},{"three-pathfinding":11}],38:[function(e,t,r){"use strict";t.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},{}],39:[function(e,t,r){"use strict";var n=e("../../lib/hex-grid.min.js"),i=e("../../lib/default-hex-grid");t.exports.Primitive=AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}}),t.exports.Component=AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){var e=this,t=this.data;t.src?fetch(t.src).then((function(e){return e.json()})).then((function(t){return e.addMesh(t)})):this.addMesh(i)},addMesh:function(e){var t=new n.HexGrid;t.fromJSON(e);var r=new n.Board(t);r.generateTilemap(),this.el.setObject3D("mesh",r.group),this.addMaterial()},addMaterial:function(){var e=(this.el.components.material||{}).material;e&&this.el.object3D.traverse((function(t){t.isMesh&&(t.material=e)}))},remove:function(){this.el.removeObject3D("mesh")}})},{"../../lib/default-hex-grid":7,"../../lib/hex-grid.min.js":9}],40:[function(e,t,r){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),t.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){var e=this.el,t=this.data,r=e.components.material,n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);n.mergeVertices(),this.waves=[];for(var i,a=0,o=n.vertices.length;a<o;a++)i=n.vertices[a],this.waves.push({z:i.z,ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});r||((r={}).material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(n,r.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(t){for(var r,n,i=this.mesh.geometry.vertices,a=0;r=i[a];a++)n=this.waves[a],r.z=n.z+Math.sin(n.ang)*n.amp,n.ang+=n.speed*t;this.mesh.geometry.verticesNeedUpdate=!0}}})},{}],41:[function(e,t,r){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),t.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){var e=this.el,t=this.data,r=e.components.material;if(t.path.length){var n=new THREE.CatmullRomCurve3(t.path.map((function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}))),i=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);r||((r={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(i,r.material),this.el.setObject3D("mesh",this.mesh)}else console.error("[a-tube] `path` property expected but not found.")},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},{}],42:[function(e,t,r){"use strict";e("./a-grid"),e("./a-hexgrid"),e("./a-ocean"),e("./a-tube")},{"./a-grid":38,"./a-hexgrid":39,"./a-ocean":40,"./a-tube":41}]},{},[1]),function(){var e=function(){AFRAME.registerComponent("initvrscene",{init:function(){this.el}});var e=function(){this.GLRenderer=null,this.light=null,this.vrScene=null,this.publishVRProjs=null,this.VRSceneResult=null,this.makarVRscenes={},this.makarObjects=[],this.FUNCTION_ENABLED=!1,this.clock=new THREE.Clock,this.delta=this.time=0,this.projectIdx=0,this.currentSceneIndex=null,this.loadSceneCount=0,this.triggerEnable=!1};e.prototype.setupFunction=function(){if(this.FUNCTION_ENABLED)return;this.FUNCTION_ENABLED=!0;var e=this;this.loadAssets=function(t){let r=document.createElement("a-assets");r.setAttribute("id","makarAssets"),r.setAttribute("timeout","100"),e.vrScene.appendChild(r),e.makarObjects.push(r)},this.loadScene=function(t,r){if(console.log("VRFunc.js: VRController: _loadScene: [projectIndex, sceneIndex]=",t,r,e.VRSceneResult[t].scenes[r]),e.currentSceneIndex==r)console.log("VRFunc.js: VRController: _loadScene: same scene");else if(null==e.VRSceneResult[t].scenes[r])console.log("VRFunc.js: VRController: _loadScene: error, [valid sceneIndex]=",e.VRSceneResult[t].scenes.length,r);else{if(loadPage.style.display="block",e.makarObjects){for(let t=0;t<e.makarObjects.length;t++){e.makarObjects[t].remove()}e.makarObjects.length=0}e.loadSceneCount++,e.loadAssets(),e.loadSceneObjects(t,r),setTimeout((function(){e.currentSceneIndex=r,e.loadSky(t,r)}),1),setTimeout((function(){console.log("VRFunc.js: _loadScene: set triggerEnable true "),e.triggerEnable=!0}),3e3)}},this.editorVerionControll=function(t,r,n){let i;if(3==t.length){let o=t[0],s=t[1],l=t[2];switch(o){case"3":if(0==s&&l<=6){if(!Array.isArray(e.VRSceneResult[r].scenes[n].scene_objs))return console.log("VRFunc.js: _editorVerionControll the scenes[sceneIndex] is not Array, error",e.VRSceneResult[r]),-1;console.log("VRFunc.js: _editorVerionControll: the editor version before 3.0.6",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs}else if(1==s||0==s&&l>=7)console.log("VRFunc.js: _editorVerionControll: the editor version after 3.0.7",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].objs;else if(2==s){if(console.log("VRFunc.js: _editorVerionControll: the editor version is 3.2.n ",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].objs,e.VRSceneResult[r].scenes[n].camera_rotation&&e.VRSceneResult[r].scenes[n].fov){let t=(new THREE.Vector3).fromArray(e.VRSceneResult[r].scenes[n].camera_rotation.split(",").map((function(e){return Number(e)})));t.multiply(new THREE.Vector3(-1,-1,0)).add(new THREE.Vector3(0,180,0));document.getElementById("camera_cursor");let i=document.getElementById("aCamera");function a(){console.log("VRFunc.js: _editorVerionControll: aCamera loaded rotation=",t),i.components["look-controls"].yawObject.rotation.y=t.y/180*Math.PI,i.components["look-controls"].pitchObject.rotation.x=0,i.object3D.position.set(0,0,0),console.log("VRFunc.js: _loadSceneObjects aCamera: yawr=",i.components["look-controls"].yawObject.rotation,", pitchr=",i.components["look-controls"].pitchObject.rotation),i.removeEventListener("look-controls-loaded",a)}i.components["look-controls"].yawObject&&i.components["look-controls"].pitchObject?(console.log("VRFunc.js: _editorVerionControll: aCamera look-controls already set"),a()):(console.log("VRFunc.js: _editorVerionControll: aCamera look-controls not set yet"),i.addEventListener("look-controls-loaded",a))}}else console.error("VRFunc.js: _editorVerionControll: the editor version after 3.2 , error ",e.VRSceneResult[r]);break;case"2":case"1":console.log("VRFunc.js: _editorVerionControll: largeVersion below 3",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs;break;default:console.log("VRFunc.js: _editorVerionControll: missing large version ",e.VRSceneResult[r])}}else if(""==e.VRSceneResult[r].editor_ver){if(!Array.isArray(e.VRSceneResult[r].scenes[n].scene_objs))return console.log("VRFunc.js: _loadSceneObjects the scene_objs_v2 is not Array, error",e.VRSceneResult[r]),-1;console.log("VRFunc.js: _loadSceneObjects: the editor version empty",e.VRSceneResult[r]),i=e.VRSceneResult[r].scenes[n].scene_objs}return i},this.loadSky=function(t,r){let n;switch(e.VRSceneResult[t].scenes[r].scene_skybox_main_type){case"spherical_image":case"image":document.getElementById("sky")?"a-sky"==(n=document.getElementById("sky")).localName||"a-videosphere"==n.localName&&(n.remove(),(n=document.createElement("a-sky")).setAttribute("id","sky"),e.vrScene.appendChild(n)):((n=document.createElement("a-sky")).setAttribute("id","sky"),e.vrScene.appendChild(n)),"DefaultResource/Spherical_Image/SphericalImage.png"==e.VRSceneResult[t].scenes[r].scene_skybox_url&&(e.VRSceneResult[t].scenes[r].scene_skybox_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Spherical_Image/SphericalImage.png"),n.setAttribute("material",{src:e.VRSceneResult[t].scenes[r].scene_skybox_url}),n.setAttribute("radius",2e3);var i=function(){console.log("VRFunc.js: _loadSky: spherical_image materialtextureloaded, remove loading page "),loadPage.style.display="none",n.removeEventListener("materialtextureloaded",i)};n.addEventListener("materialtextureloaded",i);break;case"spherical_video":let a=document.getElementById("makarAssets");document.getElementById("sky")?"a-sky"==(n=document.getElementById("sky")).localName?(n.remove(),(n=document.createElement("a-videosphere")).setAttribute("id","sky"),e.vrScene.appendChild(n)):n.localName:((n=document.createElement("a-videosphere")).setAttribute("id","sky"),e.vrScene.appendChild(n));let o=document.createElement("video");o.src=e.VRSceneResult[t].scenes[r].scene_skybox_url,o.playsInline=!0,o.setAttribute("loop","true"),o.setAttribute("type","video/mp4"),o.onloadedmetadata=function(){if(e.loadSceneCount>1)return o.autoplay=!0,o.setAttribute("autoplay","true"),void o.play();if(window.Browser)if("mozilla"==window.Browser.name)o.autoplay=!0,o.setAttribute("autoplay","true"),o.play();else{o.autoplay=!1,o.setAttribute("autoplay","false");let e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",document.body.appendChild(e);let t=document.createElement("img");t.setAttribute("id","clickImg"),t.src="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/button/click.png",t.style.position="absolute",t.onload=function(){t.style.left="calc(50% - "+t.width/2+"px )",t.style.top="calc(50% - "+t.height/2+"px )",n.setAttribute("opacity",0),e.onclick=function(){console.log(" **** click **** "),o.play().then(()=>{console.log(" **** play then remove clickImg **** "),n.setAttribute("opacity",1),e.remove()})}},e.appendChild(t)}},o.setAttribute("crossorigin","anonymous"),o.setAttribute("id",e.VRSceneResult[t].scenes[r].scene_id+"_"+e.loadSceneCount),a.appendChild(o),n.setAttribute("src","#"+e.VRSceneResult[t].scenes[r].scene_id+"_"+e.loadSceneCount),n.setAttribute("radius",2e3);i=function(){console.log("VRFunc.js: _loadSky: spherical_video materialtextureloaded, remove loading page "),loadPage.style.display="none",n.removeEventListener("materialtextureloaded",i)};n.addEventListener("materialtextureloaded",i),console.log("VRFunc.js: _loadSky: aSky=",n)}},this.loadSceneObjects=function(t,r){if(!userProjResDict)return console.log("%cVRFunc.js: _loadSceneObjects: error userProjResDict not exist, return -1","color:red"),-1;let n=[];var i=[];if("string"!=typeof e.VRSceneResult[t].editor_ver)return console.log("VRFunc.js: _loadSceneObjects: the editor_ver is not string, error and return "),-1;if(i=e.VRSceneResult[t].editor_ver.split("."),n=e.editorVerionControll(i,t,r),!Array.isArray(n))return-1;let a;"DefaultResource/Spherical_Image/SphericalImage.png"==e.VRSceneResult[t].scenes[r].scene_skybox_url&&(e.VRSceneResult[t].scenes[r].scene_skybox_url="https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/2D/sceneDefaultImages/SphericalImage.png"),a="spherical_video"==e.VRSceneResult[t].scenes[r].scene_skybox_main_type?"https://mifly0makar0assets.s3-ap-northeast-1.amazonaws.com/DefaultResource/spherical_image/defaultGray2.jpg":e.VRSceneResult[t].scenes[r].scene_skybox_url;let o=new THREE.WebGLRenderTargetCube(1024,1024),s=e.vrScene.renderer;s.outputEncoding=THREE.GammaEncoding,s.gammaFactor=1;let l=(new THREE.TextureLoader).load(a,(function(){let r=o.fromEquirectangularTexture(s,l);for(let a=0;a<n.length;a++){let o=(new THREE.Vector3).fromArray(n[a].transform[0].split(",").map((function(e){return Number(e)}))),s=(new THREE.Vector3).fromArray(n[a].transform[1].split(",").map((function(e){return Number(e)}))),l=(new THREE.Vector3).fromArray(n[a].transform[2].split(",").map((function(e){return Number(e)})));switch(n[a].main_type){case"camera":if(e.VRSceneResult[t].editor_ver&&"string"==typeof e.VRSceneResult[t].editor_ver){var i=e.VRSceneResult[t].editor_ver.split(".");if(3==i.length&&3==i[0]&&2==i[1]){console.log("VRFunc.js: _loadSceneObjects: camera: editor vesion is 3.2.n , dont set");break}}let c=document.getElementById("camera_cursor");s.multiply(new THREE.Vector3(-1,-1,0)).add(new THREE.Vector3(0,180,0)),c.setAttribute("rotation",s),c.setAttribute("position",o),aCamera.components["look-controls"].yawObject&&aCamera.components["look-controls"].pitchObject&&(aCamera.components["look-controls"].yawObject.rotation.set(0,0,0),aCamera.components["look-controls"].pitchObject.rotation.set(0,0,0),aCamera.object3D.position.set(0,0,0)),console.log("VRFunc.js: _loadSceneObjects: camera: ",a,n[a],o,s);break;case"image":let u=n[a];if(userProjResDict[u.res_id])u.res_url==userProjResDict[u.res_id].res_url?e.loadTexture(u,o,s,l):console.log("%cVRFunc.js: _loadSceneObjects: image res_url is different from userProjResDict!","color:red",a,u,userProjResDict[u.res_id]);else{switch(console.log("%cVRFunc.js: _loadSceneObjects: image res_id not exist!","color:red",a),u.res_id){case"MakAR_Call":u.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Call.png";break;case"MakAR_Room":u.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Room.png";break;case"MakAR_Mail":u.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/MakAR_Mail.png";break;case"Line_icon":u.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Line_icon.png";break;case"FB_icon":u.res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/FB_icon.png";break;default:console.log("image: default, obj=",window.sceneResult[a].data.scene_objs_v2[j])}e.loadTexture(u,o,s,l)}break;case"text":e.loadText(n[a],o,s,l);break;case"audio":"mp3"!=n[a].sub_type&&"wav"!=n[a].sub_type&&"ogg"!=n[a].sub_type||!n[a].res_url||e.loadAudio(n[a]);break;case"video":"mp4"==n[a].sub_type&&n[a].res_url&&e.loadVideo(n[a],o,s,l);break;case"model":if(console.log("VRFunc.js: _loadSceneObjects: model",a,n[a]),userProjResDict[n[a].res_id])n[a].res_url=userProjResDict[n[a].res_id].res_url;else if(userOnlineResDict[n[a].res_id])n[a].res_url=userOnlineResDict[n[a].res_id].res_url;else switch(n[a].res_id){case"Cube":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Cube.glb";break;case"Capsule":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Capsule.glb";break;case"Sphere":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/Sphere.glb";break;case"ch_Bojue":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Bojue.glb";break;case"ch_Fei":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Fei.glb";break;case"ch_Lina":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Lina.glb";break;case"ch_Poyuan":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Poyuan.glb";break;case"ch_Roger":n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/ch_Roger.glb";break;default:if(n[a].res_gltf_resource)break;n[a].res_url="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/3D/MissingFileBox.glb"}e.loadGLTFModel(n[a],o,s,l,r);break;case"light":e.loadLight(n[a],o,s,l);break;default:console.log("VRFunc.js: _loadSceneObjects: default",a,n[a])}}}))},this.loadTexture=function(t,r,n,i){(new THREE.TextureLoader).load(t.res_url,(function(a){let o,s=t.res_url.split(".").length,l=t.res_url.split(".")[s-1].toLowerCase();"jpg"==l||"jpeg"==l||"png"==l?(o=document.createElement("a-plane")).setAttribute("src",t.res_url):"gif"==l&&(o=document.createElement("a-entity")),o.setAttribute("id",t.obj_id);let c=!1;if(t.behav)for(let e=0;e<t.behav.length;e++)"TransparentVideo"!=t.behav[e].simple_behav&&"TransparentImage"!=t.behav[e].simple_behav||(c=!0,chromaKey=t.behav[e].chromakey,slope=t.behav[e].slope,threshold=t.behav[e].threshold,transparentBehav=t.behav[e]);if(c){let e=chromaKey.split(","),r=new THREE.Color(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),n=transparentBehav.HSV.split(","),i=parseFloat(n[0]),a=parseFloat(n[1]),s=parseFloat(n[2]);"jpg"==l||"jpeg"==l||"png"==l?"RGB"==transparentBehav.mode?o.setAttribute("material","shader: chromaKey; color: #"+r.getHexString()+";transparent: true; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";"):"HSV"==transparentBehav.mode&&o.setAttribute("material","shader: HSVMatting; transparent: true; _keyingColorH:"+i+"; _keyingColorS:"+a+"; _keyingColorV:"+s+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";"):"gif"==l&&(o.setAttribute("geometry","primitive: plane"),o.setAttribute("material","transparent: true; shader:gif;  src: url("+t.res_url+"); opacity: 1"),"RGB"==transparentBehav.mode?(o.setAttribute("geometry","primitive: plane"),o.setAttribute("material","shader:gif_RGB;  src: url("+t.res_url+"); opacity: 1; transparent: true; depthWrite:false; color: #"+r.getHexString()+"; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";")):"HSV"==transparentBehav.mode&&(o.setAttribute("geometry","primitive: plane"),o.setAttribute("material","shader:gif_HSV;  src: url("+t.res_url+"); opacity: 1; transparent: true; depthWrite:false; _keyingColorH:"+i+"; _keyingColorS:"+a+"; _keyingColorV:"+s+"; _deltaH:"+parseFloat(transparentBehav.hue)+"; _deltaS:"+parseFloat(transparentBehav.saturation)+"; _deltaV:"+parseFloat(transparentBehav.brightness)+";")))}else"jpg"==l||"jpeg"==l||"png"==l?o.setAttribute("material","shader: flat; side:double; opacity: 1.0; transparent: true; "):"gif"==l&&(o.setAttribute("geometry","primitive: plane"),o.setAttribute("material","transparent: true; shader:gif;  src: url("+t.res_url+"); opacity: 1"));if(t.behav?1==t.behav.length&&c?o.setAttribute("class","unclickable"):o.setAttribute("class","clickable"):o.setAttribute("class","unclickable"),e.setTransform(o,r,n,i),e.makarObjects.push(o),o.addEventListener("loaded",(function(e){if(e.target==e.currentTarget){setTimeout((function(){o.setAttribute("cursor-listener",!0)}),500),console.log("VRFunc.js: loadTexture: loaded target same"),o.object3D.children[0].scale.set(.01*a.image.width,.01*a.image.height,1);let e=new THREE.Vector3;e.set(0,Math.PI,0),o.object3D.children[0].rotation.setFromVector3(e),o.object3D.makarObject=!0,t.behav&&(o.object3D.behav=t.behav),t.behav_reference&&(o.object3D.behav_reference=t.behav_reference)}else console.log("VRFunc.js: loadTexture: loaded target different")})),console.log("image behav_reference: ",t.behav_reference),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){o.setAttribute("visible",!1),o.setAttribute("class","unclickable");break}if(t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(o),window.clearInterval(e))}),1)}else e.vrScene.appendChild(o);console.log("VRFunc.js: VRController: loadTexture,obj=",t)}),void 0,(function(e){console.error("An error happened. loadTexture, err=",e)}))},this.loadText=function(t,r,n,i){let a=document.createElement("a-entity");e.setTransform(a,r,n,i),a.setAttribute("id",t.obj_id),e.makarObjects.push(a),t.behav?a.setAttribute("class","clickable"):a.setAttribute("class","unclickable");let o=document.createElement("a-text");textList=t.content.split("\n");let s=0;const l=/[\u4e00-\u9fff]|[\u3400-\u4dbf]|[\u{20000}-\u{2a6df}]|[\u{2a700}-\u{2b73f}]|[\u{2b740}-\u{2b81f}]|[\u{2b820}-\u{2ceaf}]|[\uf900-\ufaff]|[\u3300-\u33ff]|[\ufe30-\ufe4f]|[\uf900-\ufaff]|[\u{2f800}-\u{2fa1f}]/u,c=e=>l.test(e);for(let e=0;e<textList.length;e++){textLength=0;for(let t=0;t<textList[e].length;t++)c(textList[e][t])?textLength+=1.6:textList[e][t]==textList[e][t].toUpperCase()&&textList[e][t]!=textList[e][t].toLowerCase()?textLength+=1:textList[e][t]==textList[e][t].toLowerCase()&&textList[e][t]!=textList[e][t].toUpperCase()?textLength+=1:isNaN(1*textList[e][t])?textLength+=1.25:textLength+=1;console.log(textList[e],textLength),textLength>s&&(s=textLength)}o.setAttribute("value",t.content),o.setAttribute("width",.08*s),o.setAttribute("wrap-count",s),o.setAttribute("anchor","center"),o.setAttribute("align","left"),o.setAttribute("backcolor",t.back_color),o.setAttribute("textcolor",t.color),o.setAttribute("side","double");var u="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/resource/fonts/";fonts=[u+"1-msdf.json",u+"2-msdf.json",u+"3-msdf.json",u+"4-msdf.json",u+"5-msdf.json",u+"6-msdf.json",u+"7-msdf.json",u+"8-msdf.json",u+"9-msdf.json",u+"10-msdf.json",u+"11-msdf.json",u+"12-msdf.json"],o.setAttribute("font",fonts),o.setAttribute("negate","false"),o.setAttribute("crossorigin","anonymous");let d=t.color.split(","),h=new THREE.Color(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]));if(o.setAttribute("color","#"+h.getHexString()),t.behav?o.setAttribute("class","clickable"):o.setAttribute("class","unclickable"),o.addEventListener("loaded",(function(e){if(e.target==e.currentTarget){setTimeout((function(){o.setAttribute("cursor-listener",!0)}),500);let e=new THREE.Vector3;e.set(0,Math.PI,0),o.object3D.rotation.setFromVector3(e),o.object3D.makarObject=!0,t.behav&&(o.object3D.behav=t.behav),t.behav_reference&&(o.object3D.behav_reference=t.behav_reference)}})),a.appendChild(o),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){a.setAttribute("visible",!1),a.setAttribute("class","unclickable");break}if(t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(a),window.clearInterval(e))}),1)}else e.vrScene.appendChild(a)},this.loadGLTFModel=function(t,r,n,i,a){let o=document.getElementById("makarAssets"),s=document.createElement("a-asset-item");s.setAttribute("id",t.obj_id+"_"+t.res_id),s.setAttribute("src",t.res_url),s.setAttribute("crossorigin","anonymous"),o.appendChild(s);var l,c=null;if(t.animation){c=[];for(let e=0;e<t.animation.length;e++)t.animation[e].isActive&&(c.push({idle:t.animation[e].uid,uid:t.animation[e].uid,changed:!1}),l=t.animation[e].animationName);for(let e=0;e<t.animation.length;e++)c.push({name:t.animation[e].name,animationName:t.animation[e].animationName,startTime:t.animation[e].startTime,endTime:t.animation[e].endTime,uid:t.animation[e].uid})}let u=document.createElement("a-entity");if(t.res_url){if(u.setAttribute("gltf-model","#"+t.obj_id+"_"+t.res_id),u.setAttribute("animation-mixer","clip: "+l),t.behav?u.setAttribute("class","clickable"):u.setAttribute("class","unclickable"),u.setAttribute("id",t.obj_id),u.setAttribute("crossorigin","anonymous"),e.setTransform(u,r,n,i),e.makarObjects.push(u),u.addEventListener("model-loaded",(function(e){if(console.log("VRFunc.js: VRController: _loadGLTFModel, object3dset: evt=",e,t),e.target==e.currentTarget&&(setTimeout((function(){u.setAttribute("cursor-listener",!0)}),500),u.object3D)){if(u.object3D.makarObject=!0,t.behav&&(u.object3D.behav=t.behav),t.behav_reference&&(u.object3D.behav_reference=t.behav_reference),t.material){for(let e=0;e<t.material.length;e++){let n=t.material[e].color.split(","),i=new THREE.Color(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]));const o=u.getObject3D("mesh");switch(t.material[e].shader){case"Unlit/Color":o.traverse(r=>{r.isMesh&&r.material.name===t.material[e].name&&(r.material=new THREE.MeshBasicMaterial({color:i,name:t.material[e].name,skinning:r.material.skinning}))});break;case"Standard":var r=u.sceneEl.renderer;o.traverse(o=>{o.material&&o.material.name==t.material[e].name&&(o.material=new THREE.MeshStandardMaterial({name:t.material[e].name,skinning:o.material.skinning,map:o.material.map,emissive:o.material.emissive,emissiveMap:o.material.emissiveMap,normalMap:o.material.normalMap}),o.material.color=i,o.material.metalness=t.material[e].metallic,o.material.roughness=1-t.material[e].smoothness,o.material.envMap=a.texture,o.material.envMapIntensity=1,o.material.needsUpdate=!0,o.material.reflectivity=0,o.material.side=THREE.DoubleSide,o.material.transparent=!0,o.material.map&&(o.material.map.encoding=THREE.GammaEncoding,o.material.map.needsUpdate=!0),0==t.material[e].mode?(o.material.opacity=1,r.setClearAlpha(1),o.material.blending=THREE.CustomBlending,o.material.blendEquation=THREE.AddEquation,o.material.blendSrc=THREE.OneFactor,o.material.blendDst=THREE.ZeroFactor,o.material.blendSrcAlpha=THREE.ZeroFactor,o.material.blendDstAlpha=THREE.OneFactor):1==t.material[e].mode?(o.material.opacity=1,o.material.alphaTest=t.material[e].cut_off,r.setClearAlpha(1),o.material.blending=THREE.CustomBlending,o.material.blendEquation=THREE.AddEquation,o.material.blendSrc=THREE.OneFactor,o.material.blendDst=THREE.ZeroFactor,o.material.blendSrcAlpha=THREE.ZeroFactor,o.material.blendDstAlpha=THREE.OneFactor,o.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:o.material.map,alphaTest:t.material[e].cut_off})):2==t.material[e].mode?(o.material.opacity=parseFloat(n[3]),o.material.depthWrite=!1,o.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:o.material.map,alphaTest:t.material[e].cut_off})):3==t.material[e].mode&&(o.material.opacity=Math.max(parseFloat(n[3]),t.material[e].metallic),o.material.depthWrite=!1,o.material.blending=THREE.CustomBlending,o.material.blendEquation=THREE.AddEquation,o.material.blendSrc=THREE.OneFactor,o.material.blendDst=THREE.OneMinusSrcAlphaFactor,o.material.blendSrcAlpha=THREE.OneFactor,o.material.blendDstAlpha=THREE.OneMinusSrcAlphaFactor,o.customDepthMaterial=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking,skinning:!0,map:o.material.map,alphaTest:t.material[e].cut_off})))});break;case"Unlit/Transparent":o.traverse(r=>{r.material&&r.material.name==t.material[e].name&&(r.material.opacity=1,r.material.depthWrite=!1)});break;case"Unlit/Transparent Cutout":o.traverse(r=>{r.material&&r.material.name==t.material[e].name&&(r.material.opacity=1,r.material.alphaTest=.5)});break;case"Unlit/Texture":o.traverse(r=>{r.material&&r.material.name==t.material[e].name&&(r.material=new THREE.MeshBasicMaterial({color:new THREE.Color(1,1,1),name:t.material[e].name,skinning:r.material.skinning,map:r.material.map}),r.material.map&&(r.material.map.encoding=THREE.GammaEncoding,r.material.map.needsUpdate=!0,console.log(r.material.map)),r.material.needsUpdate=!0)});break;default:console.log(`The shader of no. ${e} material is not supported currently.`)}}Array.isArray(e.detail.model.animations)&&e.detail.model.animations.length>0&&!u.getAttribute("animation-mixer")&&(console.log("VRFunc.js: loadGFLTFModel: the model with animation but no animation-mixer, probabily older version of editor ",e.detail.model),u.setAttribute("animation-mixer","clip: "+e.detail.model.animations[0].name),(c=[]).push({changed:!1,idle:"mifly168",uid:"mifly168"}),c.push({animationName:e.detail.model.animations[0].name,name:e.detail.model.animations[0].name,endTime:e.detail.model.animations[0].duration,startTime:0,uid:"mifly168"}))}e.detail.model.animationSlices=c}})),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){u.setAttribute("visible",!1),u.setAttribute("class","unclickable");break}if(t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(u),window.clearInterval(e))}),1)}else e.vrScene.appendChild(u)}},this.loadFBXModel=function(t,r,n,i){let a=document.createElement("a-entity");if(t.res_url_fbx){if(a.setAttribute("fbx-model","src:"+t.res_url_fbx),a.setAttribute("animation-mixer",""),t.behav?a.setAttribute("class","clickable"):a.setAttribute("class","unclickable"),a.setAttribute("id",t.obj_id),setTimeout((function(){a.setAttribute("cursor-listener",!0)}),500),e.setTransform(a,r,n,i),e.makarObjects.push(a),t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){a.setAttribute("visible",!1),a.setAttribute("class","unclickable");break}if(t.obj_parent_id){let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.appendChild(a),window.clearInterval(e))}),1)}else e.vrScene.appendChild(a);a.addEventListener("model-loaded",(function(e){e.target==e.currentTarget&&(a.object3D.makarObject=!0,t.behav&&(a.object3D.behav=t.behav))}))}},this.loadAudio=function(t){console.log("audio loaded");let r=document.getElementById("makarAssets"),n=document.createElement("audio");n.setAttribute("id",t.obj_id+"_"+t.res_id),n.setAttribute("src",t.res_url),n.setAttribute("crossorigin","anonymous"),n.setAttribute("loop",!0),n.setAttribute("preload","auto"),r.appendChild(n),n.onloadedmetadata=function(){let r=document.createElement("a-entity");r.setAttribute("sound","src: #"+t.obj_id+"_"+t.res_id+"; autoplay: true; loop: true; volume: 1; positional: false"),r.setAttribute("id",t.obj_id),r.setAttribute("sound","autoplay: false"),e.makarObjects.push(r);let n=!1;if(t.behav_reference){for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){n=!0,r.setAttribute("sound","loop: false"),r.setAttribute("visible",!1),r.setAttribute("class","unclickable");break}}else r.setAttribute("visible",!0);if(t.obj_parent_id){let e=setInterval((function(){let i=document.getElementById(t.obj_parent_id);i&&i.object3D.children.length>0&&(i.appendChild(r),window.clearInterval(e),i.addEventListener("child-attached",(function(e){console.log("VRFunc.js: VRController: _loadAudio,: parent child-attached, el=",e);let t=!0;r.object3D.traverseAncestors((function(e){"Scene"!=e.type?(console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: not Scene parent=",e),0==e.visible&&(t=!1)):1==t&&1==r.object3D.visible&&0==n?(console.log("VRFunc.js: VRController: _loadAudio,: traverseAncestors: all parent visible true=",r.object3D),r.setAttribute("sound","autoplay: true")):(console.log("2 VRFunc.js: VRController: _loadAudio,: traverseAncestors: not all parent visible true=",r.object3D.children[0]),r.setAttribute("sound","autoplay: false"))}))})))}),1)}else r.setAttribute("sound","autoplay: true"),e.vrScene.appendChild(r);r.addEventListener("loaded",(function(e){e.target==e.currentTarget&&(console.log("3 VRFunc.js: VRController: _loadAudio,: loaded, soundEntity.object3D.children[0]=",r.object3D.children[0]),r.object3D.makarObject=!0,t.behav&&(r.object3D.behav=t.behav),t.behav_reference&&(r.object3D.behav_reference=t.behav_reference))}))}},this.loadVideo=function(t,r,n,i){let a=document.getElementById("makarAssets");var o;(o=document.createElement("video")).src=t.res_url,o.playsInline=!0,o.autoplay=!1,o.loop=!0,o.setAttribute("crossorigin","anonymous"),o.setAttribute("id",t.obj_id+"_"+t.res_id+"_"+e.loadSceneCount),a.appendChild(o),window.Browser&&(null!=window.Browser.name&&"safari"!=window.Browser.name||(o.muted=!0)),o.onloadedmetadata=function(){var a,s;o.videoWidth>=o.videoHeight?(a=1,s=1*o.videoHeight/o.videoWidth):(a=1*o.videoWidth/o.videoHeight,s=1);let l=document.createElement("a-video"),c=!1;if(t.behav)for(let e=0;e<t.behav.length;e++)"TransparentVideo"==t.behav[e].simple_behav&&(c=!0,chromaKey=t.behav[e].chromakey,slope=t.behav[e].slope,threshold=t.behav[e].threshold,transparentBehav=t.behav[e]);if(c){let e=chromaKey.split(",");var u=new THREE.Color(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));let t=transparentBehav.HSV.split(","),r=parseFloat(t[0]),n=parseFloat(t[1]),i=parseFloat(t[2]);"RGB"==transparentBehav.mode?l.setAttribute("material","shader: chromaKey; color: #"+u.getHexString()+";transparent: true; _slope: "+parseFloat(slope)+"; _threshold: "+parseFloat(threshold)+";"):"HSV"==transparentBehav.mode&&l.setAttribute("material","shader: HSVMatting; transparent: true; _keyingColorH:"+r+"; _keyingColorS:"+n+"; _keyingColorV:"+i+"; _deltaH:"+transparentBehav.hue+"; _deltaS:"+transparentBehav.saturation+"; _deltaV:"+transparentBehav.brightness+";")}else l.setAttribute("material","side:double; opacity: 1.0; transparent: true; ");t.behav?1==t.behav.length&&c?l.setAttribute("class","unclickable"):l.setAttribute("class","clickable"):l.setAttribute("class","unclickable"),l.setAttribute("id",t.obj_id),l.setAttribute("src","#"+t.obj_id+"_"+t.res_id+"_"+e.loadSceneCount),e.setTransform(l,r,n,i),l.addEventListener("loaded",(function(e){if(e.target==e.currentTarget){setTimeout((function(){l.setAttribute("cursor-listener",!0)}),500),l.object3D.children[0].scale.multiply(new THREE.Vector3(a,s,1));let e=new THREE.Vector3;e.set(0,Math.PI,0),l.object3D.children[0].rotation.setFromVector3(e),l.object3D.makarObject=!0,t.behav&&(l.object3D.behav=t.behav),t.behav_reference&&(l.object3D.behav_reference=t.behav_reference)}})),e.makarObjects.push(l);let d=!1;if(t.behav_reference)for(let e=0;e<t.behav_reference.length;e++)if("PlayAnimation"!=t.behav_reference[e].behav_name){d=!0,l.setAttribute("visible",!1),l.setAttribute("class","unclickable"),o.muted=!1;break}if(t.obj_parent_id){o.autoplay=!1;let e=setInterval((function(){let r=document.getElementById(t.obj_parent_id);r&&r.object3D.children.length>0&&(r.addEventListener("child-attached",(function(e){console.log("VRFunc.js: VRController: _loadVideo,: parent child-attached, el=",e);let t=!0;l.object3D.traverseAncestors((function(e){"Scene"!=e.type?(console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not Scene parent=",e),0==e.visible&&(t=!1)):1==t&&1==l.object3D.visible&&0==d?(console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: all parent visible true=",l.object3D),o.autoplay=!0,o.play()):(console.log("VRFunc.js: VRController: _loadVideo,: traverseAncestors: not all parent visible true=",l.object3D),o.autoplay=!1,o.pause())}))})),r.appendChild(l),window.clearInterval(e))}),1)}else o.autoplay=!0,o.play(),e.vrScene.appendChild(l)}},this.loadLight=function(t,r,n,i){console.log("VRFunc.js: _loadLight: obj=",t);let a=document.createElement("a-light");a.setAttribute("id",t.obj_id),a.setAttribute("type",t.light.light_type);let o=t.light.color.split(","),s=new THREE.Color(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2]));a.setAttribute("color","#"+s.getHexString()),a.setAttribute("intensity",t.light.intensity),t.light.shadow,a.setAttribute("castShadow",!1);let l=new THREE.Vector3(0,0,-1),c=new THREE.Euler,u=t.quaternionRotation.split(","),d=new THREE.Quaternion(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[0]));c.setFromQuaternion(d),c.y=-c.y,c.z=-c.z,l.applyEuler(c),a.setAttribute("position",l),e.vrScene.appendChild(a)},this.setTransform=function(e,t,r,n){let i=t.clone();i.multiply(new THREE.Vector3(-1,1,1)),e.setAttribute("position",i);let a=r.clone();a.multiply(new THREE.Vector3(1,-1,-1)),e.setAttribute("rotation",a),e.setAttribute("scale",n)},this.checkAnimation=function(e,t){e.mixer&&e.mixer.update(t),e.animationSlices&&e.animationSlices[0].index&&e.animationSlices[e.animationSlices[0].index]&&(e.mixer._actions[0].time>e.animationSlices[e.animationSlices[0].index].timeEnd||e.mixer._actions[0].time<e.animationSlices[e.animationSlices[0].index].timeStart)&&(e.mixer._actions[0].time=e.animationSlices[e.animationSlices[0].index].timeStart)},this.showObjectEvent=function(e,t){if(e.getAttribute("visible")){e.setAttribute("visible",!1),e.setAttribute("class","unclickable");let r=e.getAttribute("src");if(null!=r){r=r.split("#").pop();let e=document.getElementById(r);e instanceof HTMLElement&&e.pause()}e.object3D.traverse((function(e){if("Group"==e.type){if(e.el.setAttribute("class","unclickable"),"a-video"==e.el.localName){let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.pause()}}if(e.makarObject&&e.el.getAttribute("sound")){e.behav_reference&&e.el.setAttribute("visible",!1);for(let t in e.children)"Audio"==e.children[t].children[0].type&&1==e.children[t].children[0].isPlaying&&e.el.components.sound.stopSound()}}})),t&&e.object3D.traverse((function(e){"Group"==e.type&&(e.el.setAttribute("visible",!1),e.el.setAttribute("class","unclickable"))}))}else{e.setAttribute("visible",!0);let t=e.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.play()}e.object3D.behav&&e.setAttribute("class","clickable"),e.object3D.traverse((function(e){if("Group"==e.type&&e.el.getAttribute("visible")){if(e.el.object3D.behav&&e.el.setAttribute("class","clickable"),"a-video"==e.el.localName){let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.play()}}e.makarObject&&e.el.getAttribute("sound")&&e.el.components.sound.playSound()}}))}},this.hideGroupObjectEvent=function(e){e.getAttribute("visible")&&(e.setAttribute("visible",!1),e.setAttribute("class","unclickable"),e.object3D.traverse((function(e){if("Group"==e.type){if(e.el.setAttribute("class","unclickable"),"a-video"==e.el.localName){let t=e.el.getAttribute("src");if(null!=t){t=t.split("#").pop();let e=document.getElementById(t);e instanceof HTMLElement&&e.pause()}}if(e.makarObject&&e.el.getAttribute("sound")){e.behav_reference&&e.el.setAttribute("visible",!1);for(let t in e.children)"Audio"==e.children[t].children[0].type&&1==e.children[t].children[0].isPlaying&&e.el.components.sound.stopSound()}}})))},this.getMakarObject=function(t){return 1!=t.makarObject?t.parent?e.getMakarObject(t.parent):0:t},e.vrScene.canvas.addEventListener("touchend",n,!1),e.vrScene.canvas.addEventListener("mouseup",n,!1);new THREE.Vector2;var t=new THREE.Vector2,r=new THREE.Raycaster;function n(n){if(!e.triggerEnable)return;if(2==e.touchMouseState)return;n.preventDefault();let i=e.GLRenderer.domElement.getBoundingClientRect();switch(n.type){case"mouseup":t.x=(n.clientX-i.left)/e.GLRenderer.domElement.clientWidth*2-1,t.y=-(n.clientY-i.top)/e.GLRenderer.domElement.clientHeight*2+1;break;case"touchend":t.x=(n.changedTouches[0].clientX-i.left)/e.GLRenderer.domElement.clientWidth*2-1,t.y=-(n.changedTouches[0].clientY-i.top)/e.GLRenderer.domElement.clientHeight*2+1;break;default:return void console.log("default endEvent: event.type=",n.type," not mouseup/touchend, return ")}let a=[];for(let t=0;t<e.makarObjects.length;t++){let r=e.makarObjects[t];r.object3D&&"clickable"==r.className&&a.push(r.object3D)}r.setFromCamera(t,e.vrScene.camera);let o=r.intersectObjects(a,!0);if(0!=o.length){console.log("VRFunc.js: _setupFunction: 1 endEvent, intersects=",o);let t=e.getMakarObject(o[0].object);if(t.traverse((function(e){e.isMesh})),t.behav){for(let r=0;r<t.behav.length;r++)if(t.behav[r].group)for(let n=0;n<e.makarObjects.length;n++){let i=e.makarObjects[n];if(i.object3D&&i.object3D.makarObject&&i.object3D.behav)for(let n=0;n<i.object3D.behav.length;n++)if(i.object3D.behav[n].group==t.behav[r].group&&i.object3D!=t){let t=document.getElementById(i.object3D.behav[n].obj_id);e.hideGroupObjectEvent(t)}}let r=!1;for(let e=0;e<t.behav.length;e++)"CloseAndResetChildren"==t.behav[e].simple_behav&&(r=!0);for(let n=0;n<t.behav.length;n++)"CloseAndResetChildren"!=t.behav[n].simple_behav&&e.triggerEvent(t.behav[n],r,t)}}}},e.prototype.triggerEvent=function(e,t,r,n,i){if(!this.FUNCTION_ENABLED)return;let a;switch(e.simple_behav){case"PhoneCall":console.log("VRFunc.js: triggerEvent: PhoneCall: event=",e);let r=window.document.getElementById("phoneCall");r.href="tel:"+e.phone,r.click();break;case"SendEmail":console.log("VRFunc.js: triggerEvent: SendEmail: event=",e);let n=window.document.getElementById("sendEmail");n.href="mailto:"+e.mail_to,n.click();break;case"OpenWebPage":console.log("VRFunc.js: triggerEvent: OpenWebPage: event=",e,e.url);let i=window.document.getElementById("openWebBrowser");i.href=e.url,i.click(),console.log("VRFunc.js: triggerEvent: OpenWebPage: webTag=",i);break;case"SceneChange":console.log("VRFunc.js: triggerEvent: SceneChange: event=",e),sceneID=e.scene_id;let s=this.projectIdx;for(let e=0;e<VRSceneResult[s].scenes.length;e++)VRSceneResult[s].scenes[e].scene_id==sceneID&&(this.triggerEnable=!1,this.loadScene(s,e));break;case"ShowImage":console.log("VRFunc.js: triggerEvent: ShowImage: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),this.showObjectEvent(a,t);break;case"ShowText":console.log("VRFunc.js: triggerEvent: ShowText: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),this.showObjectEvent(a,t);break;case"ShowModel":console.log("VRFunc.js: triggerEvent: ShowModel: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),this.showObjectEvent(a,t);break;case"PlayMusic":console.log("VRFunc.js: triggerEvent: PlayMusic: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id);for(let e in a.object3D.children)"Audio"==a.object3D.children[e].children[0].type&&(console.log("VRFunc.js: triggerEvent: PlayMusic: target.object3D.children =",e,a.object3D.children[e].children[0]),1==a.object3D.children[e].children[0].isPlaying?(a.components.sound.stopSound(),a.setAttribute("visible",!1)):(a.components.sound.playSound(),a.setAttribute("visible",!0)));break;case"ShowVideo":console.log("VRFunc.js: triggerEvent: ShowVideo: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id),this.showObjectEvent(a,t);break;case"PlayAnimation":var o;console.log("VRFunc.js: triggerEvent: PlayAnimation: event=",e),obj_id=e.obj_id,a=document.getElementById(obj_id);for(let t=1;t<a.object3D.children[0].animationSlices.length;t++)a.object3D.children[0].animationSlices[t].uid==e.uid&&(o=a.object3D.children[0].animationSlices[t].animationName);a.setAttribute("animation-mixer","clip: "+o),e.loop?(a.object3D.children[0].animationSlices[0].idle=e.uid,a.object3D.children[0].animationSlices[0].uid=e.uid,a.object3D.children[0].animationSlices[0].changed=!0,a.setAttribute("class","unclickable")):(a.object3D.children[0].animationSlices[0].uid=e.uid,a.object3D.children[0].animationSlices[0].changed=!0);break;default:console.log("VRFunc.js: triggerEvent: default: event=",e)}},e.prototype.setGuideList=function(e){let t=this,r=document.getElementById("guide"),n=document.getElementById("guideList"),i=document.getElementById("guideClass01"),a=document.getElementById("bottomArrow01"),o=document.getElementById("guideStore01"),s=document.getElementById("guideClass02"),l=document.getElementById("bottomArrow02"),c=document.getElementById("guideStore02"),u=document.getElementById("guideClass03"),d=document.getElementById("bottomArrow03"),h=document.getElementById("guideStore03"),f=document.getElementById("guideClass04"),p=document.getElementById("bottomArrow04"),m=document.getElementById("guideStore04"),v=document.getElementById("guideClass05"),g=document.getElementById("bottomArrow05"),y=document.getElementById("guideStore05"),b=document.getElementById("guideClass06"),_=document.getElementById("bottomArrow06"),E=document.getElementById("guideStore06"),A=document.getElementById("guideClass07"),w=document.getElementById("bottomArrow07"),T=document.getElementById("guideStore07"),k=document.getElementById("guideClass08"),R=document.getElementById("bottomArrow08"),x=document.getElementById("guideStore08");r.addEventListener("click",(function(e){e.preventDefault(),"block"==n.style.display?n.style.display="none":n.style.display="block"})),i.addEventListener("click",(function(e){e.preventDefault(),"block"==o.style.display?(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="block",a.style.transform="rotate(135deg)",i.style.background="rgba(49, 51, 63, 0.65)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),s.addEventListener("click",(function(e){e.preventDefault(),"block"==c.style.display?(c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="block",l.style.transform="rotate(135deg)",s.style.background="rgba(49, 51, 63, 0.65)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),u.addEventListener("click",(function(e){e.preventDefault(),"block"==h.style.display?(h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="block",d.style.transform="rotate(135deg)",u.style.background="rgba(49, 51, 63, 0.65)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),f.addEventListener("click",(function(e){e.preventDefault(),"block"==m.style.display?(m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="block",p.style.transform="rotate(135deg)",f.style.background="rgba(49, 51, 63, 0.65)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),v.addEventListener("click",(function(e){e.preventDefault(),"block"==y.style.display?(y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="block",g.style.transform="rotate(135deg)",v.style.background="rgba(49, 51, 63, 0.65)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),b.addEventListener("click",(function(e){e.preventDefault(),"block"==E.style.display?(E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="block",_.style.transform="rotate(135deg)",b.style.background="rgba(49, 51, 63, 0.65)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),A.addEventListener("click",(function(e){e.preventDefault(),"block"==T.style.display?(T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="block",w.style.transform="rotate(135deg)",A.style.background="rgba(49, 51, 63, 0.65)",x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)")})),k.addEventListener("click",(function(e){e.preventDefault(),"block"==x.style.display?(x.style.display="none",R.style.transform="rotate(-45deg)",k.style.background="rgba(49, 51, 63, 0.85)"):(o.style.display="none",a.style.transform="rotate(-45deg)",i.style.background="rgba(49, 51, 63, 0.85)",c.style.display="none",l.style.transform="rotate(-45deg)",s.style.background="rgba(49, 51, 63, 0.85)",h.style.display="none",d.style.transform="rotate(-45deg)",u.style.background="rgba(49, 51, 63, 0.85)",m.style.display="none",p.style.transform="rotate(-45deg)",f.style.background="rgba(49, 51, 63, 0.85)",y.style.display="none",g.style.transform="rotate(-45deg)",v.style.background="rgba(49, 51, 63, 0.85)",E.style.display="none",_.style.transform="rotate(-45deg)",b.style.background="rgba(49, 51, 63, 0.85)",T.style.display="none",w.style.transform="rotate(-45deg)",A.style.background="rgba(49, 51, 63, 0.85)",x.style.display="block",R.style.transform="rotate(135deg)",k.style.background="rgba(49, 51, 63, 0.65)")}));let C=document.getElementById("storeTable01"),S=document.getElementById("storeTable02"),M=document.getElementById("storeTable03"),I=document.getElementById("storeTable04"),D=document.getElementById("storeTable05"),N=document.getElementById("storeTable06"),j=document.getElementById("storeTable07"),H=document.getElementById("storeTable08"),O=C.insertRow(0),P=O.insertCell(0),L=document.createElement("div"),F=document.createElement("table"),V=F.insertRow(0),B=V.insertCell(0),U=V.insertCell(1);F.classList.toggle("storeDiv");let z=new Image;z.src="images/store01.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>呷七碗食品有限公司</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,1)})),P=(O=C.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store02.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>麵屋黑平</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,2)})),P=(O=C.insertRow(2)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store03.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>小原田</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,3)})),P=(O=S.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store04.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>永康街芋頭大王(芒果冰)</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,4)})),P=(O=M.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store05.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>爵林鳳梨酥</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,5)})),P=(O=M.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store06.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>小珍珠烘培</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,6)})),P=(O=M.insertRow(2)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store07.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>聖比德</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,7)})),P=(O=I.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store08.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>小茶栽堂-<br>Le Salon永康店</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,8)})),P=(O=I.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store09.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>御尚璽</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,9)})),P=(O=I.insertRow(2)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store10.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>興華名茶</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,10)})),P=(O=D.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store11.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>框影咖啡</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,11)})),P=(O=D.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store12.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>Nous deux 努得咖啡</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,12)})),P=(O=N.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store13.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>一茶工房</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,13)})),P=(O=N.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store14.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>三良品茶</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,14)})),P=(O=j.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store15.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>幸福可可</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,15)})),P=(O=H.insertRow(0)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store16.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>Florame法恩</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,16)})),P=(O=H.insertRow(1)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store17.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>晧雅日本生活百貨</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,17)})),P=(O=H.insertRow(2)).insertCell(0),L=document.createElement("div"),B=(V=(F=document.createElement("table")).insertRow(0)).insertCell(0),U=V.insertCell(1),F.classList.toggle("storeDiv"),(z=new Image).src="images/store18.png",z.style="width:100px;",B.appendChild(z),U.innerHTML="<h5>飛比樂有限公司</h5>",L.appendChild(F),P.appendChild(L),L.addEventListener("click",(function(r){r.preventDefault(),n.style.display="none",t.triggerEnable=!1,t.loadScene(e,18)}))},e.prototype.setSceneTable=function(e){let t=this,r=document.getElementById("scenesTable"),n=r.rows.scene_snapshot,i=r.rows.scene_name,a=n.children.length,o=i.children.length;for(let e=0;e<a;e++)n.deleteCell(0);for(let e=0;e<o;e++)i.deleteCell(0);for(let r=0;r<VRSceneResult[e].scenes.length;r++){let a=VRSceneResult[e].scenes[r],o=i.insertCell(r),s=n.insertCell(r);o.style.paddingLeft="8px",s.style.paddingLeft="8px";let l=document.createElement("div");l.innerText=a.scene_name,l.className="sceneNameOneRow",0==r&&(l.style.backgroundColor="rgba(73, 117, 221, 1.0)"),o.appendChild(l);let c=document.createElement("img");"DefaultResource/Spherical_Image_Snapshot/SphericalImage.png"==a.scene_snapshot_url?c.src="https://s3-ap-northeast-1.amazonaws.com/makar.webar.defaultobject/makar_default_objects/2D/Spherical_Image/SphericalImage.png":c.src=a.scene_snapshot_url,c.width=128,c.height=64,c.onclick=function(){if(t.triggerEnable){console.log("VRFuc.js: _setSceneTable: scene click, index = ",r,i.cells[r].children[0]),i.cells[r].children[0].style.backgroundColor="rgba(73, 117, 221, 1.0)",t.triggerEnable=!1,t.loadScene(e,r);for(let e=0;e<i.cells.length;e++)r!=e&&(i.cells[e].children[0].style.backgroundColor="rgba(98, 103, 116, 1.0)")}else console.log("please wait 3 seconds for load scene")},s.appendChild(c)}};var t=function(){if("undefined"!=typeof checkHost){if("yet"==checkHost)setTimeout(t,50);else if("correct"==checkHost)console.log("VRFunc.js: _checkHost_tick correct");else if("fail"==checkHost){for(;document.body.firstChild;)document.body.removeChild(document.body.firstChild);var e=document.createElement("div");e.innerHTML="<br>The host of webVR seems unauthorized,<br> please contact MIFLY ",e.style.fontSize="18px",e.style.margin="5px",e.style.fontWeight="700",document.body.append(e)}}else console.log("VRFunc.js: checkHost = undefined, something ERROR.")};t(),Module.checkMifly(),window.showVRProjList=function(){requestDeviceMotionPermission();let e,t=window.serverUrl;document.getElementById("uid");window.makarID?e=window.makarID:console.error("VRFunc.js: the window.makarID not exit, FYS"),getVRSceneByUserID(t,e,(function(t){if(0==window.allowedMakarIDUseWeb)return r="this ID <br> ["+e+"] <br> is free user, not allow to use webVR, visit MAKAR for more information",void(document.getElementById("freeUserWarnDiv")&&(document.getElementById("freeUserWarnDiv").style.display="block",document.getElementById("pUserInfo").innerHTML=r,document.getElementById("pUserInfo").style.color="rgba(0,201,156,1)",leaveIframe.onclick=function(){event.preventDefault(),window.open("https://www.makerar.com/","_self")}));var r;console.log("VRFunc.js: showVRProjList: getVRSceneByUserID: callback, publishVRProjs=",publishVRProjs);let n=0;if("string"==typeof projName)for(let e in publishVRProjs.result)publishVRProjs.result[e].proj_name.toLowerCase()==decodeURIComponent(projName).toLowerCase()&&(n=e);activeVRScenes(n)}))},window.activeVRScenes=function(r,i=0){let a=document.getElementsByTagName("video");if(a.length>0)for(let e=0;e<a.length;e++)a[e].pause(),a[e].removeAttribute("src"),a[e].load();document.getElementById("vrDiv")&&document.getElementById("vrDiv").remove();let o,s=document.createElement("a-scene");s.setAttribute("id","vrscene"),s.setAttribute("embedded",""),s.setAttribute("vr-mode-ui","enabled: false"),(o=document.createElement("div")).style.position="relative",o.setAttribute("id","vrDiv"),o.style.width=document.documentElement.clientWidth+"px",o.style.height=Math.round(document.documentElement.clientHeight-0)+"px",o.style.top="0px",window.onresize=function(){o.style.width=document.documentElement.clientWidth+"px",o.style.height=Math.round(document.documentElement.clientHeight-0)+"px"},document.body.appendChild(o),o.appendChild(s),s.hasLoaded?c():s.addEventListener("loaded",c),s.addEventListener("enter-vr",(function(){})),s.addEventListener("renderstart",(function(){}));let l=new e;function c(){s.children[2].attributes;let e=new THREE.Vector2;s.renderer.getSize(e),vrscene.renderer.sortObjects=!0,s.renderer.autoClear=!1,l.GLRenderer=s.renderer,l.vrScene=s,l.setupFunction();let a=document.createElement("a-entity");a.setAttribute("id","cursor_main"),a.setAttribute("cursor","fuse: true; fuseTimeout: 5"),a.setAttribute("raycaster","objects: .clickable"),a.setAttribute("animation__mouseenter","property: geometry.thetaLength; delay: 5; startEvents: mouseenter; dur: 5; from: 0.5; to: 360"),a.setAttribute("animation__mouseleave","property: geometry.thetaLength; startEvents: mouseleave; dur: 100; from: 360; to: 0.5"),a.setAttribute("geometry","primitive: ring; radiusOuter: 0.02; radiusInner: 0.01; thetaLength: 360; thetaStart: 0;"),a.setAttribute("position","0 0 -1"),a.setAttribute("material","color: red; shader: flat; ");let c=document.createElement("a-entity");c.setAttribute("id","cursor_default"),c.setAttribute("geometry","primitive: ring; radiusOuter: 0.02; radiusInner: 0.01; thetaLength: 360; thetaStart: 0;"),c.setAttribute("position","0 0 -1.001"),c.setAttribute("material","color: #2ADD2A; shader: flat; ");let d=document.createElement("a-entity");d.setAttribute("camera",""),d.setAttribute("look-controls",""),d.setAttribute("wasd-controls",""),d.setAttribute("id","aCamera"),d.setAttribute("position",{x:0,y:0,z:0}),d.setAttribute("fov",60),d.setAttribute("near",.3),d.setAttribute("far",1e4);let h=document.createElement("a-entity");h.setAttribute("id","camera_cursor"),h.setAttribute("position",{x:0,y:0,z:0}),h.setAttribute("rotation","0 0 0"),h.appendChild(d),s.appendChild(h);let f=document.createElement("a-light");f.setAttribute("id","ambientLight"),f.setAttribute("type","ambient"),f.setAttribute("color","#808080"),f.setAttribute("intensity",1),s.appendChild(f),s.addEventListener("camera-set-active",(function(e){o=document.getElementById("vrDiv"),s.camera.aspect=o.clientWidth/o.clientHeight,s.camera.updateProjectionMatrix()})),l.triggerEnable=!1,l.loadScene(r,i),l.userStartTime=(new Date).getTime(),setTimeout((function(){n()}),3e3),t(),Module.checkMifly(),u(),l.setGuideList(r),Browser.desktop&&THREE.EffectComposer&&THREE.RenderPass&&THREE.OutlinePass&&THREE.ShaderPass&&THREE.FXAAShader&&THREE.CopyShader&&d.addEventListener("loaded",(function(e){let t=s.renderer;var r=new THREE.EffectComposer(t);l.composer=r;var n=new THREE.RenderPass(s.object3D,s.camera);r.addPass(n);let i=new THREE.OutlinePass(new THREE.Vector2(s.clientWidth,s.clientHeight),s.object3D,s.camera);i.visibleEdgeColor=new THREE.Color(1,1,1),i.hiddenEdgeColor=new THREE.Color(.45,0,0),i.usePatternTexture=!1,r.addPass(i);let a=new THREE.ShaderPass(THREE.FXAAShader);a.uniforms.resolution.value.set(1/s.clientWidth,1/s.clientHeight),r.addPass(a);var o=[],c=new THREE.Vector2,u=new THREE.Raycaster;let d=null,h=null;function f(e){var t,r;e.changedTouches?(t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY):(t=e.clientX,r=e.clientY),c.x=t/s.clientWidth*2-1,c.y=-r/s.clientHeight*2+1}function p(e){(o=[]).push(e)}function m(){u.setFromCamera(c,s.camera);var e=u.intersectObject(s.object3D,!0);if(e.length>0){var t=e[0].object;t.el&&("sky"==t.el.id?i.selectedObjects=[]:(p(t),i.selectedObjects=o))}else i.selectedObjects=[]}s.canvas.addEventListener("mousedown",(function(e){d=!0})),s.canvas.addEventListener("mousemove",(function(e){d||(f(e),function(){u.setFromCamera(c,s.camera);var e=u.intersectObject(s.object3D,!0);if(e.length>0){var t=e[0].object;t.el&&"sky"!=t.el.id&&(p(t),i.selectedObjects=o)}else console.log(" --- ")}())})),s.canvas.addEventListener("mouseup",(function(e){d=!1,f(e),m()})),s.canvas.addEventListener("touchstart",(function(e){h=!1})),s.canvas.addEventListener("touchmove",(function(e){h=!0})),s.canvas.addEventListener("touchend",(function(e){h||(f(e),m())}))}))}l.VRSceneResult=VRSceneResult,l.publishVRProjs=publishVRProjs,window.vrController=l,l.projectIdx=r;var u=function(){l.GLRenderer.clearDepth(),l.GLRenderer.render(l.vrScene.object3D,l.vrScene.camera),l.composer&&l.composer.render(),requestAnimationFrame(u)}}};function t(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,i=0;i<e;i++)t+=r.charAt(Math.floor(Math.random()*n));return t}var r,n=window.leavedSendLog=function(e){if(!window.publishVRProjs)return;if(!publishVRProjs.result)return;if(!publishVRProjs.result[0].user_id)return;let r;localStorage.getItem("device_id")&&localStorage.getItem("device_id")>=24?r=localStorage.getItem("device_id"):(r=(new Date).getTime()+"_"+t(10),localStorage.setItem("device_id",r));let n=(new Date).getTime(),i={brand:Browser.name+Browser.version,os:Browser.platform,device_id:r,client:"viewer",user_id:publishVRProjs.result[0].user_id,proj_id:"",proj_type:"vr",duration_time:0,explore_time:0,play_time:0,location_long:0,location_lan:0};i.proj_id=publishVRProjs.result[vrController.projectIdx].proj_id,i.duration_time=(n-vrController.userStartTime)/1e3,i.play_time=(n-vrController.userStartTime)/1e3,i.duration_time=10+Math.random(),i.play_time=10+Math.random(),console.log("VRFunc.js: project["+vrController.projectIdx+"] playing time = ",i.duration_time,i.play_time,i.explore_time);let a=new XMLHttpRequest,o={ver:"3.1.3",cid:5,data:i},s=JSON.stringify(o);a.open("POST",window.serverUrl+"add_project_log",!0),a.setRequestHeader("Content-Type","application/json"),a.responseType="json",a.addEventListener("load",(function(){console.log("VRFunc.js: save done, ",a.response)})),a.send(s)};r="undefined"!=typeof window?window:self;let i=0;var a=function(){++i>3?console.log("VRFunc.js: integrateTick, integrateCount=",i,", too many times"):r.AFRAME&&r.THREE?(console.log("VRFunc.js: integrateTick, scope=",r,i),e(),window.addEventListener("keyup",(function(e){13===e.keyCode&&e.preventDefault()}))):setTimeout((function(){a(i)}),500)};"undefined"!=typeof window&&a(i),console.log("VRFunc done, window innerWH",window.innerWidth,window.innerHeight)}();